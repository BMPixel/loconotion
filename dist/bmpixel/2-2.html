<html class="notion-html"><head lang="en"><meta charset="utf-8"/><meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"/><title>2.2. 高效的优化方法</title><meta content="en_US" property="og:locale"/><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="/images/logo-ios.png" rel="apple-touch-icon"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="telephone=no" name="format-detection"/><meta content="no" name="msapplication-tap-highlight"/><link href="e218a1aef6df86309cb95b61e446888efa3b0379.css" media="print" rel="stylesheet"/><link href="e1d809d762eeca23edf0cb31bb17bf3c703085f5.css" rel="stylesheet"/><link href="ea336c780f905bf8e5199e24de64f0cf84362824.css" rel="stylesheet"/></head><body class="notion-body"><style>body{background:#fff}body.dark{background:#191919}@keyframes startup-shimmer-animation{0%{transform:translateX(-100%) translateZ(0)}100%{transform:translateX(100%) translateZ(0)}}@keyframes startup-shimmer-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes startup-spinner-rotate{0%{transform:rotate(0) translateZ(0)}100%{transform:rotate(360deg) translateZ(0)}}#initial-loading-spinner{position:fixed;height:100vh;width:100vw;z-index:-1;display:none;align-items:center;justify-content:center;opacity:.5}#initial-loading-spinner svg{height:24px;width:24px;animation:startup-spinner-rotate 1s linear infinite;transform-origin:center center;pointer-events:none}#skeleton{background:#fff;position:fixed;height:100vh;width:100vw;z-index:-1;display:none;overflow:hidden}#initial-loading-spinner.show,#skeleton.show{display:flex}body.dark #skeleton{background:#191919}.notion-front-page #skeleton,.notion-mobile #skeleton{display:none}#skeleton-sidebar{background-color:#fbfbfa;box-shadow:inset -1px 0 0 0 rgba(0,0,0,.025);display:flex;width:240px;flex-direction:column;padding:12px 14px;overflow:hidden}body.dark #skeleton-sidebar{background-color:#202020;box-shadow:inset -1px 0 0 0 rgba(255,255,255,.05)}#skeleton.isElectron #skeleton-sidebar{padding-top:46px}#skeleton .row{display:flex;margin-bottom:8px;align-items:center}#skeleton .row.fadein{animation:1s ease-in 0s 1 normal both running startup-shimmer-fade-in}#skeleton .chevron{width:12px;height:12px;display:block;margin-right:4px;fill:rgba(227,226,224,.5)}body.dark #skeleton .chevron{fill:#2f2f2f}.startup-shimmer{background:rgba(227,226,224,.5);overflow:hidden;position:relative}body.dark .startup-shimmer{background:#2f2f2f}.startup-shimmer::before{content:"";position:absolute;height:100%;width:100%;z-index:1;animation:1s linear infinite startup-shimmer-animation;background:linear-gradient(90deg,transparent 0,rgba(255,255,255,.4) 50%,transparent 100%)}body.dark .startup-shimmer::before{background:linear-gradient(90deg,transparent 0,rgba(86,86,86,.4) 50%,transparent 100%)}#skeleton .icon{width:20px;height:20px;border-radius:4px}#skeleton .text{height:10px;border-radius:10px}#skeleton .draggable{-webkit-app-region:drag;position:absolute;top:0;left:0;width:100%;height:36px;display:none}#skeleton.isElectron .draggable{display:block}</style><style id="scroll-properties">
			::-webkit-scrollbar {
				width: 10px;
				height: 10px;
			}
			::-webkit-scrollbar {
				background: transparent;
			}
			::-webkit-scrollbar-track {
				background: #EDECE9;
			}
			::-webkit-scrollbar-thumb {
				background:#D3D1CB;
			}
			::-webkit-scrollbar-thumb:hover {
				background:#AEACA6;
			}
		</style><div id="notion-app"><div class="notion-app-inner notion-light-theme" style='color: rgb(55, 53, 47); fill: currentcolor; line-height: 1.5; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; -webkit-font-smoothing: auto; background-color: white;'><div style="height: 100%;"><div class="notion-cursor-listener" style="width: 100vw; height: 100%; position: relative; display: flex; flex: 1 1 0%; background: white; cursor: text;"><div class="" style="display: flex; flex-direction: column; width: 100%; overflow: hidden;"><div style="max-width: 100vw; z-index: 100; background: white; user-select: none;"><div class="notion-topbar" style="width: 100%; max-width: 100vw; height: 45px; opacity: 1; transition: opacity 700ms ease 0s, color 700ms ease 0s; position: relative;"><div style="display: flex; justify-content: space-between; align-items: center; overflow: hidden; height: 45px; padding-left: 12px; padding-right: 10px;"><div class="notranslate shadow-cursor-breadcrumb" style="display: flex; align-items: center; line-height: 1.2; font-size: 14px; height: 100%; flex-grow: 0; margin-right: 8px; min-width: 0px;"><div class="notion-selectable notion-page-block" data-block-id="6f173729-5884-4d32-8452-4cbeea3e462c" style="display: flex; align-items: center; min-width: 0px;"><a href="index.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">BMPixel网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div class="notion-selectable notion-collection_view-block" data-block-id="27dbe900-3c41-4c13-bd5a-432418911021" style="display: flex; align-items: center; min-width: 0px;"><a href="27dbe9003c414c13bd5a432418911021.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 6px; padding-right: 6px; color: rgb(55, 53, 47);" tabindex="0"><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 240px;">2.2. 高效的优化方法</div></div></div><div style="flex-grow: 1; flex-shrink: 1;"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="searchNew" style="width: 14px; height: 14px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 17 17"><path d="M6.78027 13.6729C8.24805 13.6729 9.60156 13.1982 10.709 12.4072L14.875 16.5732C15.0684 16.7666 15.3232 16.8633 15.5957 16.8633C16.167 16.8633 16.5713 16.4238 16.5713 15.8613C16.5713 15.5977 16.4834 15.3516 16.29 15.1582L12.1504 11.0098C13.0205 9.86719 13.5391 8.45215 13.5391 6.91406C13.5391 3.19629 10.498 0.155273 6.78027 0.155273C3.0625 0.155273 0.0214844 3.19629 0.0214844 6.91406C0.0214844 10.6318 3.0625 13.6729 6.78027 13.6729ZM6.78027 12.2139C3.87988 12.2139 1.48047 9.81445 1.48047 6.91406C1.48047 4.01367 3.87988 1.61426 6.78027 1.61426C9.68066 1.61426 12.0801 4.01367 12.0801 6.91406C12.0801 9.81445 9.68066 12.2139 6.78027 12.2139Z"></path></svg>Search</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0">Duplicate</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 32px; height: 28px; border-radius: 3px;" tabindex="0"><svg class="dots" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden;" viewBox="0 0 13 3"><g><path d="M3,1.5A1.5,1.5,0,1,1,1.5,0,1.5,1.5,0,0,1,3,1.5Z"></path><path d="M8,1.5A1.5,1.5,0,1,1,6.5,0,1.5,1.5,0,0,1,8,1.5Z"></path><path d="M13,1.5A1.5,1.5,0,1,1,11.5,0,1.5,1.5,0,0,1,13,1.5Z"></path></g></svg></div><div style="flex: 0 0 auto; width: 1px; height: 16px; margin-left: 8px; margin-right: 8px; background: rgba(55, 53, 47, 0.16);"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="notionLogo" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 120 126"><path d="M 20.6927 21.9315C 24.5836 25.0924 26.0432 24.8512 33.3492 24.3638L 102.228 20.2279C 103.689 20.2279 102.474 18.7705 101.987 18.5283L 90.5477 10.2586C 88.3558 8.55699 85.4356 6.60818 79.8387 7.09563L 13.1433 11.9602C 10.711 12.2014 10.2251 13.4175 11.1939 14.3924L 20.6927 21.9315ZM 24.8281 37.9835L 24.8281 110.456C 24.8281 114.351 26.7745 115.808 31.1553 115.567L 106.853 111.187C 111.236 110.946 111.724 108.267 111.724 105.103L 111.724 33.1169C 111.724 29.958 110.509 28.2544 107.826 28.4976L 28.721 33.1169C 25.8018 33.3622 24.8281 34.8225 24.8281 37.9835ZM 99.5567 41.8711C 100.042 44.0622 99.5567 46.2512 97.3618 46.4974L 93.7143 47.2241L 93.7143 100.728C 90.5477 102.43 87.6275 103.403 85.1942 103.403C 81.2983 103.403 80.3226 102.186 77.4044 98.54L 53.5471 61.087L 53.5471 97.3239L 61.0964 99.0275C 61.0964 99.0275 61.0964 103.403 55.0057 103.403L 38.2148 104.377C 37.727 103.403 38.2148 100.973 39.9179 100.486L 44.2996 99.2717L 44.2996 51.36L 38.2158 50.8725C 37.728 48.6815 38.9431 45.5225 42.3532 45.2773L 60.3661 44.0631L 85.1942 82.0036L 85.1942 48.4402L 78.864 47.7136C 78.3781 45.0351 80.3226 43.0902 82.7569 42.849L 99.5567 41.8711ZM 7.5434 5.39404L 76.9175 0.285276C 85.4366 -0.445402 87.6285 0.0440428 92.983 3.93368L 115.128 19.4982C 118.782 22.1747 120 22.9034 120 25.8211L 120 111.187C 120 116.537 118.051 119.701 111.237 120.185L 30.6734 125.05C 25.5584 125.294 23.124 124.565 20.4453 121.158L 4.13735 99.9994C 1.21516 96.1048 0 93.191 0 89.7819L 0 13.903C 0 9.5279 1.94945 5.8785 7.5434 5.39404Z"></path></svg>Try Notion</div></div></div><div style="width: calc(100% - 0px); user-select: none;"></div></div><div class="notion-frame" style="flex-grow: 0; flex-shrink: 1; display: flex; flex-direction: column; background: white; z-index: 1; height: calc(100vh - 45px); max-height: 100%; position: relative; width: 1920px;"><div class="notion-scroller vertical" style="display: flex; flex-direction: column; z-index: 1; flex-grow: 1; position: relative; align-items: center; margin-right: 0px; margin-bottom: 0px; overflow: hidden auto;"><div style="position: absolute; top: 0px; left: 0px;"><div></div></div><div class="whenContentEditable" data-content-editable-root="true" style="caret-color: rgb(55, 53, 47); width: 100%; display: flex; flex-direction: column; position: relative; align-items: center; flex-grow: 1; --whenContentEditable--WebkitUserModify:read-write-plaintext-only;"><span style="height: 1px; width: 1px;"></span><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0; z-index: 2;"><div style="position: relative; width: 100%; display: flex; flex-direction: column; align-items: center; height: 30vh; cursor: default;"><div style="width: 100%; cursor: inherit;"><div style="display: grid; width: 100%; height: 30vh;"><div style="grid-area: 1 / 1 / auto / auto;"><img referrerpolicy="same-origin" src="f78010a16eaab77c3f8b04b9641834a3932b6c86.jpg" style="display: block; object-fit: cover; border-radius: 0px; background: white; width: 100%; height: 30vh; opacity: 1; object-position: center 32.85%;"/></div></div></div><div aria-hidden="true" style='background: rgba(0, 0, 0, 0.4); border-radius: 3px; color: white; font-size: 12px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; width: 180px; left: calc(50% - 90px); padding: 0.3em 1.5em; pointer-events: none; position: absolute; top: calc(50% - 10px); text-align: center; opacity: 0;'>Drag image to reposition</div></div></div><div style="width: 100%; display: flex; justify-content: center; z-index: 3; flex-shrink: 0;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div style="max-width: 100%; padding-left: calc(96px + env(safe-area-inset-left)); width: 100%;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; pointer-events: none;"><div class="notion-page-controls" style='display: flex; justify-content: flex-start; flex-wrap: wrap; margin-top: 16px; margin-bottom: 4px; margin-left: -1px; color: rgba(55, 53, 47, 0.5); font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; height: 24px; pointer-events: auto;'></div></div><div style="padding-right: calc(96px + env(safe-area-inset-right));"><div><div class="notion-selectable notion-page-block" data-block-id="f09de442-fcc8-4887-9133-64dac3516f06" style='color: rgb(55, 53, 47); font-weight: 700; line-height: 1.2; font-size: 40px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; cursor: text; display: flex; align-items: center;'><div contenteditable="false" data-content-editable-leaf="true" placeholder="Untitled" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">2.2. 高效的优化方法</div></div><div style="margin-left: 4px;"></div></div></div></div></div><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div contenteditable="false" data-content-editable-void="true" style="padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right)); max-width: 100%; width: 100%;"><div style="width: 100%; font-size: 14px;"><div style="width: 100%; max-width: 100%; padding: 8px 0px; margin: 0px auto;"><div style="width: 100%; max-width: 100%; padding-top: 8px; margin: 0px auto;"><div style="padding-bottom: 8px;"><div style="margin: 0px;"></div></div></div></div></div><div style="width: 100%; height: 1px; background: rgba(55, 53, 47, 0.09); margin-bottom: 8px;"></div></div></div></div></div><main style="display: flex; width: 100%; justify-content: center; padding-top: 5px;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div class="notion-page-content" style="flex-shrink: 0; flex-grow: 1; max-width: 100%; display: flex; align-items: flex-start; flex-direction: column; font-size: 16px; line-height: 1.5; width: 100%; z-index: 4; padding-bottom: 30vh; padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right));"><div class="notion-selectable notion-header-block" data-block-id="865835a0-c5c6-482d-96b5-c8e47c554839" style="width: 100%; max-width: 1718px; margin-top: 2em; margin-bottom: 4px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 1" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.875em; line-height: 1.3;">随机梯度下降（Stochastic gradient descent）</div></div></div><div class="notion-selectable notion-text-block" data-block-id="5cd104e7-9120-40ba-87c4-fda6b35450b4" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在最早期的深度学习研究中，在我们每次进行梯度下降时，我们都会将一个大小[<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">n</span>, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">m</span>]的输入喂给算法，算法根据这<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">m</span>个数据（也是训练集的所有数据），给出一个可以使整体损失函数下降的梯度进行梯度下降。但是这样做有一个很明显的特点：太慢了。虽然每次运算都可以做出综合全部数据的下降路径，但是在很多数据和问题中，综合100个数据得到的梯度下降方向和综合10000个数据的梯度下降方向是差不多的，每次少计算一些数据同样可以达到很好的效果。因此就有了<span class="notion-enable-hover" data-token-index="7" style="font-weight:600">随机梯度下降（Stochastic gradient descent简称SGD）</span>方法。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f71b9a95-f50b-4c29-8285-fb30f659e3d1" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在这样的方法下，我们每次只选择一个数据计算梯度，我们的梯度下降就变成了（epoch指定了要遍历数据多少轮）： $$
\begin{align}
For &amp; \ epoch \ from\ 1,2,3,\cdots k:\\
For&amp; \ i \ from\ 1,2,3,\cdots m:\\
&amp;w := w-\frac{\partial J(x^{(i)},y^{(i)})}{\partial w}\\
&amp;b := b-\frac{\partial J(x^{(i)},y^{(i)})}{\partial b}
\end{align}
$$</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="72677b2c-35cd-45c5-97ce-6b79be1d9c7d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">相比于每一次都综合所有数据的<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">批梯度下降（Batch graient descent）</span>，SGD的下降路径更加随机，但是由于不同数据中的噪声成分带来的那些并不适合这个问题的错误梯度会在足够多的迭代中互相抵消，因此在整体上SGD依然能向全局最小值不断挺进。而但SGD到达迭代的最优点附近后，由于每个数据都有自己的特点和噪音，使自己的损失函数最小的最优参数各自互不相同，如果算法每次迭代时都因为输入数据不同而向着着不同的参数最优点移动，那这时算法的参数值就会在几个状态之间反复横跳，这时算法代价函数表现为不断<span class="notion-enable-hover" data-token-index="3" style="font-weight:600">震荡（Oscillations）</span>。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="542876b2-a5d7-461b-b6e0-6c41a0ee5ce1" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">随机梯度下降的优点：</div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="b37dfd0e-67f4-4f5d-8a31-47e925d025a2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">速度更快；</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="3f792bf1-232c-4ea7-b111-ddbbaf90ec77" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">节省内存（当你的模型或者单个数据十分巨大时，一次计算一个数据可能是唯一的方法）；</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="ea14554b-fada-44d7-a01a-97135dd8d386" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">逃离鞍点。如图所示就是一个鞍点，鞍点的特点是两个方向上的偏导数都是0，但是显然这不是一个最小值点。由于我们的梯度下降算法只考虑了一阶导数，优化算法很难判断出这样一个鞍点和最小点的区别。不幸的是，在实践中发现这样的鞍点是非常之多的（设想一下，在所有n个偏导数都为0的个点当中，每个点在某个方向上的二阶偏导都可正可负，但是只有所有二阶导都为正的点才是我们想要的局部最优点，换句话说，2^n种的点中只有一种是我们想要的，其他的都是在某两个方向上的鞍点。）但是当我们使用随机梯度下降时，每次算法都尝试拟合不同的数据，那么在上一次梯度下降时为鞍点的点这次几乎不可能依然是鞍点，这时神经网络就可以在某个方向上迈出一小步，自然地逃离之前的鞍点了。很大程度上，也是因为这个原因，在大型的神经网络中，随机梯度下降或者接下来要说的mini-batch梯度下降几乎是唯一的选择。</div></div><div class="notion-selectable notion-image-block" data-block-id="22708885-3372-4999-b3c9-021febc81bb2" style="width: 100%; max-width: 100%; align-self: flex-start; margin-top: 4px; margin-bottom: 0px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="083509fb5a824cc617687740158540aecd86b440.jpg" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="a9169afc-ab45-48d3-85fa-502a5097e3c7" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">随机梯度下降的缺点：</div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="4c0ecace-b8ce-491e-919c-955d2d5921f0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">计算在计算矩阵计算时具有一些加速计算的技巧，使用随机梯度下降无法利用这些优势；</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="8bbcec42-62ef-4250-bf41-061ed20eb8eb" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">代价函数很可能会一直在最优点附近震荡而无法收敛，下面这个就是是随机梯度下降的可能的代价函数曲线（这张图中算法收敛了）：</div></div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="dac21143-f9bd-483e-9c96-5be3ccc112f7" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="e1fc32231c4bbc6c5c8136402dbd6f19975a677e.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="9af85774-1298-4e56-b6a6-3c568bc7466b" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.5em; line-height: 1.3;">Mini-batch梯度下降</div></div></div><div class="notion-selectable notion-text-block" data-block-id="35108a2d-06da-43bd-bdbc-5da6bb265885" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">既然一次处理一个数据会导致数据之间互相打架并且丧失向量化的加速计算优势，那为什么不一次选一小批的数据进行梯度下降呢？这就有了更加常用的方法<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">Mini-batch梯度下降</span>。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="5bd19c09-6444-497c-9bee-7875b6b2a238" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">Mini-Batch 梯度下降法每次同时处理单个的 mini-batch，其他与 batch 梯度下降法一致。假设总的训练样本个数 m=5000000，其维度为 (<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">x</span>, <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">m</span>) 。将其分成5000个子集，那么每个mini-batch含有1000个样本。我们将每个mini-batch记为 <span class="notion-enable-hover" data-token-index="6" style="font-style:italic">X</span>{<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">t</span>} ，其维度为 (<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">x</span>, 1000) 。相应的每个mini-batch的输出记为 <span class="notion-enable-hover" data-token-index="14" style="font-style:italic">Y</span>{<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">t</span>} ，其维度为 (1, 1000) ，且 <span class="notion-enable-hover" data-token-index="19" style="font-style:italic">t</span> = 1, 2, ⋯, 5000 。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8db22e15-2852-4cd1-ac8f-895dbf0f03d8" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">Mini-batch方法的计算流程可能是这样的：</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="72763f1e-36ae-4605-8c4f-cb0a602d3e5c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">先按照mini-batch size大小来划分数据集，这里mini-batch size是64（又一个要调的超参数） $$
X= \underbrace{x_1,x_2,x_3,\cdots,x_{64}}_{X^{\{1\}}},\underbrace {x_{65},x_{67},\cdots, x_{128}}_{X^{\{2\}}},\underbrace{\cdots,x_m}_{\cdots}\\
Y= \underbrace{y_1,y_2,y_3,\cdots,y_{64}}_{Y^{\{1\}}},\underbrace {y_{65},y_{67},\cdots, y_{128}}_{Y^{\{2\}}},\underbrace{\cdots,y_m}_{\cdots}\\
$$ 然后还是一步一个脚印的梯度下降环节： $$
\begin{align}
For &amp; \ epoch \ from\ 1,2,3,\cdots k:(epoch的数量指定了要遍历数据多少轮)\\
For&amp; \ i \ from\ 1,2,3,\cdots \frac{m}{N_{batch size}}:\\
&amp;w := w-\frac{\partial J(X^{\{i\}},Y^{\{i\}})}{\partial w}\\
&amp;b := b-\frac{\partial J(X^{\{i\}},Y^{\{i\}})}{\partial b}
\end{align}
$$ 相比于随机梯度下降，Mini-batch梯度下降大大加速了收敛过程。通常来说单个数据之间对应的最优参数可能差距比较大，但是每几十个数据组之间的最优参数差距就不会那么大，因此振荡的问题在mini-batch梯度下降中并不是一个大问题。所以现在Mini-batch是主流方法。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="60ff414a-5c1c-4477-885a-40f65013d625" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">下图是三种方法在只有两个参数时的迭代路线可视化，可以看见，不同算法的优化总体趋势是一样的，只是震动程度不太一样。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="e5a86daf-0aa0-4aba-9a28-4f4ac39de000" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="4fe5bebac75fef13f350ba83f6a09c700f94edf1.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="98f7aad6-ccc4-45f2-869d-8b7e5ed41ff2" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.5em; line-height: 1.3;">梯度下降中的挑战</div></div></div><div class="notion-selectable notion-text-block" data-block-id="03d00c83-43c9-41c8-87de-620be03e59d0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">要理解下面所说的要在梯度下降中引入动量的动机，我们要先了解一下梯度下降的优势和它遇到的难以克服的问题。这需要一篇新的教程：<a class="notion-link-token notion-focusable-token notion-enable-hover" data-token-index="1" href="2.1%20梯度下降的挑战.md" rel="noopener noreferrer" style="cursor:pointer;color:inherit;word-wrap:break-word;text-decoration:inherit" tabindex="0"><span class="link-annotation-03d00c83-43c9-41c8-87de-620be03e59d0-758465217" style="border-bottom:0.05em solid;border-color:rgba(55,53,47,0.4);opacity:0.7">2.1 梯度下降的挑战.md</span></a></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="c3e6dcb7-34e3-4e42-b75b-9827a32f9b36" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.5em; line-height: 1.3;">在梯度下降中引入动量</div></div></div><div class="notion-selectable notion-text-block" data-block-id="25695a44-5cf6-4f45-a42c-2f9072e50f5f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">之前提到的病态曲率问题可以很好的被带有动量方法的梯度下降解决。事实上，动量方法的贡献不只是克服卡在峡谷中振荡的问题，带有动量的梯度下降可以允许最大学习速率翻倍情况下依然收敛，可以在陡峭的方向上小心行事的同时在平坦的方向上加速算法，也可以为参数提供穿越局部最小值的动力。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="b116371c-ae86-47d9-96e0-64a259379a58" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">指数加权平均数</div></div></div><div class="notion-selectable notion-text-block" data-block-id="6b95782f-7eda-469b-a494-eff044ee7b57" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果我们的梯度下降的梯度方向在两个相反的方向上反复横跳，那么很自然的我们会想要使这些相反的方向在计算出来后相互抵消。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="fe997a76-6b78-4075-b4b0-5cdb05f86c8a" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="55bef2d093e0a602b53d2851341dfb9412b64a26.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="114f9382-d582-40f4-b912-4ada76b16f84" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们可以统计最后十个或者一百个梯度，把它们平均一下作为这一步需要的下降梯度，当然，要是能够给较新的梯度方向多一点权重就更好了。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="1029f108-b086-4b7a-a7cd-837513a52b40" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">事实上这里我们可以使用指数移动平均数来很好实现这件事：如果这一步的下降方向应该是<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">v</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">t</span>，而这一次梯度下降给出的方向是<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">θ</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">t</span>，那么： <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">v</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">t</span> = <span class="notion-enable-hover" data-token-index="10" style="font-style:italic">β</span><span class="notion-enable-hover" data-token-index="11" style="font-style:italic">v</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">t</span> − 1 + (1 − <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">β</span>)<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">θ</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">t</span> 其中<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">β</span>是一个参数，可能为0.9或者0.8这样的，说明任何一次的<span class="notion-enable-hover" data-token-index="22" style="font-style:italic">v</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">t</span>，它的值中有<span class="notion-enable-hover" data-token-index="25" style="font-style:italic">β</span>比例的大小继承过去的<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">v</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">t</span> − 1，剩下的1 − <span class="notion-enable-hover" data-token-index="31" style="font-style:italic">β</span>比例的值就是新的梯度方向。这样，我们的下降方向既包含了之前的方向值，又向着新的值的偏移。这本质上是对过去无穷多项的加权平均。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="0129ed8f-7eb3-4a5b-b5aa-3191f3d5e665" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="ec280dce9a18b1898c07cbebe5115e2f72ccef7e.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c0f25234-9b93-4f35-979e-3c8f92bc2490" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">可以看到，指数加权平均数实际上平均了过去许多点的值，因此它的增长情况将慢于实际值的变化情况。可以进入https://www.geogebra.org/m/tb88mqrm 体会一下。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d269ec77-cc02-41d6-99ad-a49dd6e6e1a9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这样我们只需要实际上的一行代码就完成了对过去梯度的加权平均，真好。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="720f311f-e698-4eeb-bd41-679389b88496" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">当然，我们发现，如果定义<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">v</span>0 = 0，那么在开始的一段迭代中，<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">v</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">t</span>都会十分靠近0，这不好。我们可以使用偏差修正，在<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">v</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">t</span>比较小的时候放大它：$v_t'=\frac{v_t}{1-\beta^t}$，这样就可以了。不过考虑到一般问题中的梯度下降实际上会有非常多步，一开始的那段不太好的时光在整个优化过程中的占比其实可以忽略不计，因此很多人并不会乘上这个偏差修正项。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="6a13ab45-eb26-407f-bed3-b13e237463c2" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">Gradient Descent with Momentum</div></div></div><div class="notion-selectable notion-text-block" data-block-id="f465c383-5dac-4e99-9ee8-c7e29a741375" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">而如果我们为梯度下降应用指数加权平均，我们就相当于让梯度下降在每次迈出一步前，都综合一下之前的运动趋势和新的梯度。我们的迭代就变成了这样： $$
V=\beta V + (1-\beta)\frac{\partial J}{\partial \theta} \\
\theta = \theta - \alpha V \\
$$ 其中<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">β</span>是对上一次方向的保留比例，<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">α</span>是学习速率。值得注意的是，实践中我们常常设置<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">β</span> = 0.9甚至<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">β</span> = 0.99。这其实是挺奇怪的一件事。似乎在动量法里，动量比当前计算出来的学习速率重要的多。因为如果我们只想要抵消相互矛盾的梯度方向，我们可能会使<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">β</span> = 0.5就能满足要求。在后面我们会从这个小疑惑出发，打开动量方法的新世界。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="ada707c9-e877-4cdb-aca0-fd5be662c695" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">RMSProp</div></div></div><div class="notion-selectable notion-text-block" data-block-id="ecfbd53e-ead1-486a-8d47-e913d555c3b2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这是RMSProp的迭代公式： $$
g_t=\frac {\partial J}{\partial \theta} \\
S = \beta S + (1-\beta)g_t^2 \\
\theta = \theta - \alpha \frac{g_t}{\sqrt{S}}\\
$$ 它想表达什么？这得从它的历史说起。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6d773072-ebff-400c-b5b7-b4bd3da9f0f5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">高原和鞍点是SGD的噩梦，但不是RMSProp的。RMSProp来源于rProp，rProp是一个无情的蒙眼杀手，为了克服在高原和鞍点上梯度过小的问题，它抛弃了梯度的大小信息，仅仅使用梯度的符号来指导优化——只要不在乎梯度的值就不会受到梯度大小的影响。rProp每次迭代都在每个参数上按照梯度的符号增加或者减少一个固定的大小，使得它的梯度长度永远是定值。这样，rProp永远以同样的速度优化，同时也给于每个参数足够的尊重，自然不会惧怕高原和鞍点，当然也不会遇到在某个方向上梯度下降缓慢的问题。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e8983c22-4cc9-488f-b971-2bde730f19ef" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">当然这样的方法的最大问题是优化过程永远不可能收敛。因此rProp引入了缩放步长的方法：</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="40843bcc-29f3-4f98-8630-f7a2edfcfa98" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">如果在某一个参数的方向上，t次的导数符号和t-1次的导数符号异号，说明在这个参数上它已经陷入了振荡——是时候在这收敛了。那么rProp就会给这个参数的更新步长乘以一个小于一的缩小系数。只要震荡还在继续，那么这个方向上的步长就会继续缩小。</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="def0ff4f-38ce-4633-9635-10bd4abd8417" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">如果在某一个参数的方向上，t次的导数符号和t-1次的导数符号同号，说明当前方向就是一个正确的方向，rProp就会给这个参数的更新步长乘上一个大于一的放大系数来加速这个过程。</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="d47cd4d1-3730-485b-8ad3-cb28eb84cc9c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">在修改了更新步长以后，还需要为步长设置一下上下限，如果步长过大就将它限制在一个最大值，如果过小就要把它提升到下限大小。</div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="9be0e93d-fd73-4c38-860a-80453e0f6594" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">rProp这个方法其实很不错，但是它的另一个问题是，它和随机梯度下降水土不服。设想如下的情况：随机梯度下降中有十次迭代，前九个训练数据都表示应该让参数<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">i</span>缩小0.1（$\frac{\partial J}{\partial W_i}=-0.1$），而第十个训练数据则认为参数<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">i</span>应该增大0.9（$\frac{\partial J}{\partial W_i}=0.9$），那么我们知道这十个数据对<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">i</span>的影响应该互相抵消。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="fa8369ad-cf11-4ba7-b5a6-f5b8f9b1bd13" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">但是rProp不这么认为。它会在前九次迭代中都加速更新<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">i</span>，只在最后一次迭代中减小更新步长。结果就是<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">i</span>向着增大的方向一路狂奔。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a6782066-5de8-4c61-abce-5f49ae8bcaea" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">RMSProp是rProp的均方根版本（Root Mean Square），因为只按照梯度的符号改变参数其实就等价于每次梯度下降时，将对应的偏导数除以自身的绝对值再进行下降，这样在任何方向上的步长都是1。RMSProp就是使用这种方式使得每个方向上的参数步长一致。而RMSProp的特点是，RMSProp为了解决随机梯度下降时各个训练数据导致对应的参数导数符号不一致的问题，在求偏导数的绝对值时，计算的是过去多次迭代时的对应偏导数的均方根大小。这样即使在连续的几次迭代中出现了导数大小相互抵消的情况，它们的平方和也依然会比较好地反应过去几次迭代里的尺度大小水平。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0f74745b-e204-429f-9cd6-9987888077d7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">还是看公式明白：<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">（平方和除法指的都是按元素计算）</span> $$
g_t=\frac {\partial J}{\partial \theta} \\
S = \beta S + (1-\beta)g_t^2 \\
\theta = \theta - \alpha \frac{g_t}{\sqrt{S}}\\
$$ 希望上面的解释可以帮助你更好的了解这个算法。RMSprop由于不再死板地缩放步长，不会再和随机梯度下降水土不服。同时不依赖梯度大小的特点得到了保存。虽然步长一定程度上还是被固定了，但实际上大多数情况下RMSprop到最后也是可以收敛的，不过这个问题就不是这个水平的笔记分析的了。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="cec312a7-3e90-4713-a14c-78411b30a2cc" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">RMSProp最有名之处实际上是RMSProp没有发表过，它是Hinton在Cousera的网课上提出的。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="560774eb-22d3-4f22-b380-d63dc4b0a0b7" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">AdaGrad</div></div></div><div class="notion-selectable notion-text-block" data-block-id="4491e976-9768-471d-ae3e-940649b6a412" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">AdaGrad是一个学习率的衰减器，先看它的公式：其中<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">η</span>是一个全局的学习率。<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">ϵ</span>是防止除以零用的，非常小。除法是点除。 $$
第t次迭代：\\g_t=\frac {\partial J}{\partial \theta}\\
G=\sum_{i=1}^t g_ig_i^T\\
\theta_t = \theta_t - \frac{\eta}{\sqrt{\epsilon+G_{ii}}}g_t
$$ 这么写比较迷，在实践中我们这样实现 $$
t = t + \left(\frac {\partial J}{\partial \theta}\right)^2 \\
\theta = \theta-\frac{\eta}{\sqrt{\epsilon+t}}\frac {\partial J}{\partial \theta}
$$ 可以看出，对于每一个参数Adagrad都施加了一个学习速率的衰减，衰减的程度由过去的梯度累积出来的大小决定，参数绝对值越大的衰减的越快。于是当Adagrad运行的时候，随着偏导数的积累不断变多，对应参数的学习率也会不断减小。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8960ff53-f2f2-4b0b-a97a-2ec2104785d4" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">Adagrad的最爱是稀疏数据，但是它爱的实际上是稀疏数据里的低耦合特征。在低耦合的特征里，Adagrad为每个特征对应的参数分配对应的学习率；对于频繁出现的特征对应的参数，优化过程比较快，对应的梯度衰减的更快，同时由于快速优化导致历史导数都比较大，Adagrad将使用更小的学习速率，每次进行的更新更小；对于比较稀疏的特征，常常需要比较大的学习率才能学习到，这时Adagrad自然就不会用过低的学习速率。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b0ee595d-6e69-472a-b437-0ccb9910cdf2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">但这一切都需要特征是低耦合的，或者说互不相干的。因为Adagrad对于学习率的衰减是不可逆的，这里暗含了某个参数只要收敛了就会一直是最优参数的假设，但是实际上这么美的事只在凸优化（或者说低耦合）中发生。而稀疏数据对应的问题本身更可能是可以凸优化的，这样才给了Adagrad一展身手的机会。换句话说，Adagrad用降低了在非凸优化中的拟合能力为代价提升了速度。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="afeb871d-89f9-41f4-8e7a-01d342d84911" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="c948004315e04687ac00e56bf651c136524983e5.gif" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d2fbc37c-c06b-4bf8-a6b6-86ad2d14353c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果你可以看动图的话（看不了就点这里https://imgur.com/a/Hqolp#NKsFHJb），你会发现Adagrad非常的快，并且伴有明显的折返现象：adagrad学习率衰减的结果。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="0c300946-3c80-4747-a05e-9bcc8d874df5" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">Adagrad和RMSProp的联系</div></div></div><div class="notion-selectable notion-text-block" data-block-id="e78e54c9-2d4c-41ad-b8a9-1da29542166d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果你把RMSProp里的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">β</span>设置成非常接近一（实践中也确实是这么设置的），那么$\lim_{\beta\rightarrow1}S=\frac{\sum_{i=1}^t g_i^2}{t}$，假设<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">ϵ</span> = 0，把迭代次数<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">t</span>分母放到学习速率里，我们的RMSProp就变成了： $$
\theta := \theta - \alpha \frac{g_t}{\sqrt{S}}=\theta-\alpha t\frac{g_t}{\sqrt{\sum_{i=1}^t g_i^2}}
$$ 把它和Adagrad一比对，我们发现<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">η</span> = <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">α</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">t</span>，这就是个学习速率不断增加的Adagrad，而且学习率的增加程度可以正好弥补Adagrad的梯度衰减水平。说明RMSProp其实也存在着向Adagrad一样的对稠密的特征进行学习率衰减的能力，不过由于<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">η</span> = <span class="notion-enable-hover" data-token-index="16" style="font-style:italic">α</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">t</span>不断抵消学习率衰减，所以于此同时RMSProp也会加强对稀疏特征的学习速率。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="dd5f1063-9cea-498d-b509-20b7accf5c1c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">还有重要的一点是，RMSProp中的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">β</span>并不严格为一，也就是只有最近的一批梯度大小被统计了，这也给了被减小速率的参数重新提高速率的机会，这就使得RMSProp更加适合非凸优化。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="b3eb931f-3530-4a8a-a2b5-538c5be84d13" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">Adam</div></div></div><div class="notion-selectable notion-text-block" data-block-id="120f1599-c584-4f39-b91b-6563192da05c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">动量方法可以很好的解决病态曲率问题，但是面对鞍点就没那么好使了；而RMSProp可以很好的应对鞍点和高原。把它们合在一起就是RMSProp with Momentum，再稍微改动一下就是现在使用最为广泛的Adam优化器了。这是Adam的迭代过程：</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="cc37f12c-8a81-49a1-b5d0-f0b4a0073a8d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">首先，<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">α</span>, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">β</span>1, <span class="notion-enable-hover" data-token-index="6" style="font-style:italic">β</span>2, <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">ϵ</span>都是超参数，Adam作者给出默认值<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">α</span> = 0.001, <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">β</span>1 = 0.9, <span class="notion-enable-hover" data-token-index="16" style="font-style:italic">β</span>2 = 0.999, <span class="notion-enable-hover" data-token-index="19" style="font-style:italic">ϵ</span> = 10 − 8，矩阵运算都是按元素运算，<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">θ</span>包括了W和b。 $$
\begin{align}
g_t&amp;:=\frac{\partial J}{\partial\theta_{t-1}} \\
m_t&amp;:=\beta_1m_{t-1}+(1-\beta_1)g_t \\
v_t&amp;:=\beta_2v_{t-1}+(1-\beta_2)g_t^2\\
\hat{m_t} &amp;:= m_t/(1-\beta_1^t)\\
\hat{v_t} &amp;:= v_t/(1-\beta_2^t)\\
\theta_t&amp;:=\theta_{t-1}-\alpha\frac{\hat{m_t}}{\sqrt{\hat{v_t}}+\epsilon}
\end{align}
$$</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="62fc3a13-ea28-4df6-ba61-70c0f22ab187" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">Adam和RMSProp with Momentum的区别在于：</div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="a3263efb-0598-435e-b508-8e2188b75ab8" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"1."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">RMSProp with Momentum是先用梯度的均方根除掉梯度来修正了梯度大小，然后对这个修正后的梯度再使用动量法。而Adam是把两个搞到一起了，其实说白了就是把RMSProp的分子换成动量，分母依然是梯度的均方根。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="95954ca6-2a43-445a-8d1d-375ede03c92f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"2."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">RMSProp没有偏置修正（1/(1 − <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">β</span>)这一项），Adam有。</div></div><div class="notion-selectable notion-text-block" data-block-id="05d82582-deb2-4494-92ab-7a0f6dbcbab5" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f6e6bc45-61fc-42ad-833e-a59830de520b" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">t</span></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="831fb44f-4dad-4740-ab46-2555b1a9d4df" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">可以把Adam完全看成是RMSProp with Momentum。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="3b7689ba-57a5-4c08-b2c9-fee6eed45eb3" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">Adam的特点</div></div></div><div class="notion-selectable notion-text-block" data-block-id="d0b37b47-dff6-4b43-a2ce-d1d0c15fb76f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果我们把Adam算法忽略<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">ϵ</span>，那么<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">θ</span>的更新步长<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">Δ</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">t</span>可以写为$\Delta t = \alpha\frac{\hat m_t}{\sqrt{\hat v_t}}$，其中$\frac{\hat m_t}{\sqrt{\hat v_t}}$在绝大多数条件下由于$|||| 1 ，<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">我</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">们</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">可</span><span class="notion-enable-hover" data-token-index="11" style="font-style:italic">以</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">知</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">道</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">步</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">长</span>t ，<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">这</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">里</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">体</span><span class="notion-enable-hover" data-token-index="20" style="font-style:italic">现</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">了</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">d</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="25" style="font-style:italic">m</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">的</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">R</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">M</span><span class="notion-enable-hover" data-token-index="29" style="font-style:italic">S</span><span class="notion-enable-hover" data-token-index="30" style="font-style:italic">P</span><span class="notion-enable-hover" data-token-index="31" style="font-style:italic">r</span><span class="notion-enable-hover" data-token-index="32" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="33" style="font-style:italic">p</span><span class="notion-enable-hover" data-token-index="34" style="font-style:italic">性</span><span class="notion-enable-hover" data-token-index="35" style="font-style:italic">质</span>——<span class="notion-enable-hover" data-token-index="37" style="font-style:italic">在</span><span class="notion-enable-hover" data-token-index="38" style="font-style:italic">梯</span><span class="notion-enable-hover" data-token-index="39" style="font-style:italic">度</span><span class="notion-enable-hover" data-token-index="40" style="font-style:italic">或</span><span class="notion-enable-hover" data-token-index="41" style="font-style:italic">大</span><span class="notion-enable-hover" data-token-index="42" style="font-style:italic">或</span><span class="notion-enable-hover" data-token-index="43" style="font-style:italic">小</span><span class="notion-enable-hover" data-token-index="44" style="font-style:italic">时</span><span class="notion-enable-hover" data-token-index="45" style="font-style:italic">都</span><span class="notion-enable-hover" data-token-index="46" style="font-style:italic">有</span><span class="notion-enable-hover" data-token-index="47" style="font-style:italic">一</span><span class="notion-enable-hover" data-token-index="48" style="font-style:italic">个</span><span class="notion-enable-hover" data-token-index="49" style="font-style:italic">相</span><span class="notion-enable-hover" data-token-index="50" style="font-style:italic">对</span><span class="notion-enable-hover" data-token-index="51" style="font-style:italic">恒</span><span class="notion-enable-hover" data-token-index="52" style="font-style:italic">定</span><span class="notion-enable-hover" data-token-index="53" style="font-style:italic">的</span><span class="notion-enable-hover" data-token-index="54" style="font-style:italic">步</span><span class="notion-enable-hover" data-token-index="55" style="font-style:italic">长</span>。<span class="notion-enable-hover" data-token-index="57" style="font-style:italic">另</span><span class="notion-enable-hover" data-token-index="58" style="font-style:italic">一</span><span class="notion-enable-hover" data-token-index="59" style="font-style:italic">方</span><span class="notion-enable-hover" data-token-index="60" style="font-style:italic">面</span>，<span class="notion-enable-hover" data-token-index="62" style="font-style:italic">稍</span><span class="notion-enable-hover" data-token-index="63" style="font-style:italic">微</span><span class="notion-enable-hover" data-token-index="64" style="font-style:italic">混</span><span class="notion-enable-hover" data-token-index="65" style="font-style:italic">淆</span><span class="notion-enable-hover" data-token-index="66" style="font-style:italic">一</span><span class="notion-enable-hover" data-token-index="67" style="font-style:italic">下</span><span class="notion-enable-hover" data-token-index="68" style="font-style:italic">术</span><span class="notion-enable-hover" data-token-index="69" style="font-style:italic">语</span><span class="notion-enable-hover" data-token-index="70" style="font-style:italic">称</span><span class="notion-enable-hover" data-token-index="71" style="font-style:italic">谓</span>，<span class="notion-enable-hover" data-token-index="73" style="font-style:italic">我</span><span class="notion-enable-hover" data-token-index="74" style="font-style:italic">们</span><span class="notion-enable-hover" data-token-index="75" style="font-style:italic">可</span><span class="notion-enable-hover" data-token-index="76" style="font-style:italic">以</span><span class="notion-enable-hover" data-token-index="77" style="font-style:italic">把</span><span class="notion-enable-hover" data-token-index="78" style="font-style:italic">称</span><span class="notion-enable-hover" data-token-index="79" style="font-style:italic">为</span><span class="notion-enable-hover" data-token-index="80" style="font-style:italic">信</span><span class="notion-enable-hover" data-token-index="81" style="font-style:italic">噪</span><span class="notion-enable-hover" data-token-index="82" style="font-style:italic">比</span>SNR$，让我们设想一下。</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="47fa53b7-54e1-462a-9406-d2f22e284024" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">当<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">S</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">N</span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic">R</span>较小（&lt;&lt; 1），说明这时在每次的步长都比较长的情况下（$\sqrt{\hat v_t}$较大），积累出来的<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">m̂</span>却比较小，这表明现在算法的前进方向可能比较扭曲（梯度相互抵消使得<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">m̂</span>比较小），这时梯度下降不能确定现在的方向是可以大步向前的，需要谨慎行事。表现出来的就是$\Delta t = \alpha\frac{\hat m_t}{\sqrt{\hat v_t}} &lt;&lt; \alpha$。这也对应了数据较为稠密的情况。</div></div><div class="notion-selectable notion-text-block" data-block-id="26e24320-0880-45a2-98bc-3716619f63e1" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">t</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d8f20259-680c-4aa1-a528-c6f3aa24a333" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">t</span></div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="e745c13c-e3ba-462c-b8fb-03f7aa2b01d5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">当<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">S</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">N</span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic">R</span>较大（≈ 1），说明梯度向量的代数平均数与模的平均数的大小差不多，这表明现在算法的前进方向类似一条直线，这时梯度确定现在的方向是可以大步向前的，需要加速。表现出来的就是$\Delta t = \alpha\frac{\hat m_t}{\sqrt{\hat v_t}}\approx \alpha$。这也对应了数据较为稀疏的情况。</div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6f64fbdd-0405-4522-85fa-e1cb18b01ee7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">详细的推导应该看论文。但是相信上面的描述将有助于你理解原论文下面这段话</div></div></div></div><div class="notion-selectable notion-quote-block" data-block-id="ef62c793-465b-49c8-bbb5-00f188a46900" style="width: 100%; max-width: 1718px; margin-top: 4px; margin-bottom: 4px;"><div style="font-size: 1em; padding: 3px 2px; color: inherit; fill: inherit; display: flex;"><div style="border-left: 3px solid currentcolor; padding-left: 14px; padding-right: 14px; width: 100%;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Empty quote" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding-left: 2px; padding-right: 2px;">Some of Adam’s advantages are that the magnitudes of parameter updates are invariant to rescaling of the gradient, its stepsizes are approximately bounded by the stepsize hyperparameter, it does not require a stationary objective, it works with sparse gradients, and it naturally performs a form of step size annealing.</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="bb7ebaea-5f4e-40a1-a773-7b309f9113f9" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.25em; line-height: 1.3;">Adam的缺点</div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="69d29ed8-45c6-4f18-882d-fbdb2dbe0a29" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">Adam可能不收敛。经过上面的讨论，rProp，RMSProp，Adam，还有没说过的AdaDelta，他们都在一定程度上无视梯度大小进行更新，自己玩自己的步长大小很可能就会在局部最优点不收敛。不过我认为问题可能没有那么大，毕竟这些算法的步长都有上确界，即使不收敛也不会发散，只会一直振荡下去。</div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="5a1931e5-6d66-4d3c-adcd-df13fdc7d5b7" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.5em; line-height: 1.3;">学习率衰减</div></div></div><div class="notion-selectable notion-text-block" data-block-id="e7e6b74b-828b-4000-b7d7-30a39a1a7910" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果设置一个固定的学习率 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">α</span>在最小值点附近，由于不同的 batch 中存在一定的噪声，因此算法有可能不会精确收敛，而是始终在最小值周围一个较大的范围内波动。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="762b29c0-0af2-42e9-b01f-81623a1fd240" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">而如果随着时间慢慢减少学习率 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">α</span> 的大小，在初期 <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">α</span> 较大时，下降的步长较大，能以较快的速度进行梯度下降；而后期逐步减小 <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">α</span> 的值，即减小步长，有助于算法的收敛，更容易接近最优解。</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="4bac994a-6495-400d-8163-964c7acc94b6" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">最常用的学习率衰减方法：$\alpha = \frac{1}{1 + vn_{epoch}} * \alpha_0$。其中，<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">v</span>为衰减率（超参数），<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">p</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="7" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">h</span>为将所有的训练样本完整过一遍的次数；</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="aec89e75-afc7-4d45-8a73-29ba75d31813" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">指数衰减：<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">α</span> = 0.95<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">p</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="7" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">h</span> * <span class="notion-enable-hover" data-token-index="10" style="font-style:italic">α</span>0；</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="4851b0cf-ea39-409d-a8df-a93bc6570c63" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">其他方法，如$\alpha = \frac{k}{\sqrt{n_{epoch}}} * \alpha_0$和手动设计学习速率下降的函数图像。</div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="7e77b7a5-fbc5-465d-b455-2a33ace23575" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-weight: 600; font-size: 1.5em; line-height: 1.3;">如何直观理解动量</div></div></div><div class="notion-selectable notion-text-block" data-block-id="3bf51001-1580-4e7b-bd49-40ddfc262ef3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这需要一篇单独的笔记，笔记内的大多数内容是来自对参考资料[1]的翻译，如有疑惑可以先移步参考资料一了解。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="95d0a0b4-618b-4311-9607-1ece0ba6143a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">翻译这篇文章的主要原因不是因为动量重要，而是因为这篇文章写得非常好。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="20d919b3-d5c4-4693-b78f-5bf5fa3ce0eb" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><a class="notion-link-token notion-focusable-token notion-enable-hover" data-token-index="0" href="2.2%20为何我们需要动量.md" rel="noopener noreferrer" style="cursor:pointer;color:inherit;word-wrap:break-word;text-decoration:inherit" tabindex="0"><span class="link-annotation-20d919b3-d5c4-4693-b78f-5bf5fa3ce0eb-1562434426" style="border-bottom:0.05em solid;border-color:rgba(55,53,47,0.4);opacity:0.7">2.2 为何我们需要动量.md</span></a></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f1e5deb4-f2a2-47f5-827d-8410fa112585" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">参考资料：</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="16c6097e-d455-4f5a-9e63-62fa25d98b2f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1] Coursera Deeplearning.AI深度学习教程：https://www.coursera.org/specializations/deep-learning</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="95861a70-cb31-495e-81c3-e9f446b5945c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[2] Why Momentum Really Works https://distill.pub/2017/momentum/</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8ace63c5-1b61-4cd3-9b75-a87f014f98c0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[3] Understanding RMSprop — faster neural network learning https://towardsdatascience.com/understanding-rmsprop-faster-neural-network-learning-62e116fcf29a</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ea28fc80-ca76-44b3-93b9-d7c51815bd53" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[4] Intro to optimization in deep learning: Momentum, RMSProp and Adam http://blog.paperspace.com/intro-to-optimization-momentum-rmsprop-adam/</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b292847f-85e8-485d-a7e5-2112059037ce" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[5] An Introduction to AdaGrad https://medium.com/konvergen/an-introduction-to-adagrad-f130ae871827</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b9d70405-f329-49f5-815c-afcc9f13a07b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[6] Adagrad https://databricks.com/glossary/adagrad</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e07c8b58-4aef-4920-b433-956c886041c7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[7] Adam: A Method for Stochastic Optimization https://arxiv.org/abs/1412.6980。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="49f84499-ecd0-45fe-9351-5b18d4978362" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[8] 一个框架看懂优化算法之异同 SGD/AdaGrad/Adam https://zhuanlan.zhihu.com/p/32230623</div></div></div></div></div></div><div contenteditable="false" data-content-editable-void="true" style="width: 0px;"><div style="display: none; flex-shrink: 0; pointer-events: none; width: 0px; position: absolute; right: 192px; opacity: 0;"><div style="display: flex; flex-direction: column; padding: 5px 16px; width: 340px; flex-shrink: 0; height: 100%; position: relative; pointer-events: none; z-index: 1;"><div style="position: absolute; pointer-events: none; width: 100%; height: 100%; top: -5px; background: linear-gradient(white 0px, rgba(255, 255, 255, 0) 15px);"></div></div></div></div></main><span style="height: 1px; width: 1px;"></span></div><div class="notion-presence-container" style="position: absolute; top: 0px; left: 0px; z-index: 89;"><div></div></div></div></div></div><div class="notion-peek-renderer" style="position: fixed; top: 0px; right: 0px; bottom: 0px; width: 960px; z-index: 109; transform: translateX(960px) translateZ(0px);"></div></div></div></div></div><script src="1172e9111a5fb396bcb8a05870b5eabf8abf221c.js" type="text/javascript"></script><div style="width: env(safe-area-inset-bottom);"></div></body></html>