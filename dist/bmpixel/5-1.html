<html class="notion-html"><head lang="en"><meta charset="utf-8"/><meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"/><title>5.1. 循环神经网络</title><meta content="en_US" property="og:locale"/><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="/images/logo-ios.png" rel="apple-touch-icon"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="telephone=no" name="format-detection"/><meta content="no" name="msapplication-tap-highlight"/><link href="e218a1aef6df86309cb95b61e446888efa3b0379.css" media="print" rel="stylesheet"/><link href="e1d809d762eeca23edf0cb31bb17bf3c703085f5.css" rel="stylesheet"/><link href="ea336c780f905bf8e5199e24de64f0cf84362824.css" rel="stylesheet"/></head><body class="notion-body"><style>body{background:#fff}body.dark{background:#191919}@keyframes startup-shimmer-animation{0%{transform:translateX(-100%) translateZ(0)}100%{transform:translateX(100%) translateZ(0)}}@keyframes startup-shimmer-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes startup-spinner-rotate{0%{transform:rotate(0) translateZ(0)}100%{transform:rotate(360deg) translateZ(0)}}#initial-loading-spinner{position:fixed;height:100vh;width:100vw;z-index:-1;display:none;align-items:center;justify-content:center;opacity:.5}#initial-loading-spinner svg{height:24px;width:24px;animation:startup-spinner-rotate 1s linear infinite;transform-origin:center center;pointer-events:none}#skeleton{background:#fff;position:fixed;height:100vh;width:100vw;z-index:-1;display:none;overflow:hidden}#initial-loading-spinner.show,#skeleton.show{display:flex}body.dark #skeleton{background:#191919}.notion-front-page #skeleton,.notion-mobile #skeleton{display:none}#skeleton-sidebar{background-color:#fbfbfa;box-shadow:inset -1px 0 0 0 rgba(0,0,0,.025);display:flex;width:240px;flex-direction:column;padding:12px 14px;overflow:hidden}body.dark #skeleton-sidebar{background-color:#202020;box-shadow:inset -1px 0 0 0 rgba(255,255,255,.05)}#skeleton.isElectron #skeleton-sidebar{padding-top:46px}#skeleton .row{display:flex;margin-bottom:8px;align-items:center}#skeleton .row.fadein{animation:1s ease-in 0s 1 normal both running startup-shimmer-fade-in}#skeleton .chevron{width:12px;height:12px;display:block;margin-right:4px;fill:rgba(227,226,224,.5)}body.dark #skeleton .chevron{fill:#2f2f2f}.startup-shimmer{background:rgba(227,226,224,.5);overflow:hidden;position:relative}body.dark .startup-shimmer{background:#2f2f2f}.startup-shimmer::before{content:"";position:absolute;height:100%;width:100%;z-index:1;animation:1s linear infinite startup-shimmer-animation;background:linear-gradient(90deg,transparent 0,rgba(255,255,255,.4) 50%,transparent 100%)}body.dark .startup-shimmer::before{background:linear-gradient(90deg,transparent 0,rgba(86,86,86,.4) 50%,transparent 100%)}#skeleton .icon{width:20px;height:20px;border-radius:4px}#skeleton .text{height:10px;border-radius:10px}#skeleton .draggable{-webkit-app-region:drag;position:absolute;top:0;left:0;width:100%;height:36px;display:none}#skeleton.isElectron .draggable{display:block}</style><style id="scroll-properties">
			::-webkit-scrollbar {
				width: 10px;
				height: 10px;
			}
			::-webkit-scrollbar {
				background: transparent;
			}
			::-webkit-scrollbar-track {
				background: #EDECE9;
			}
			::-webkit-scrollbar-thumb {
				background:#D3D1CB;
			}
			::-webkit-scrollbar-thumb:hover {
				background:#AEACA6;
			}
		</style><div id="notion-app"><div class="notion-app-inner notion-light-theme" style='color: rgb(55, 53, 47); fill: currentcolor; line-height: 1.5; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; -webkit-font-smoothing: auto; background-color: white;'><div style="height: 100%;"><div class="notion-cursor-listener" style="width: 100vw; height: 100%; position: relative; display: flex; flex: 1 1 0%; background: white; cursor: text;"><div class="" style="display: flex; flex-direction: column; width: 100%; overflow: hidden;"><div style="max-width: 100vw; z-index: 100; background: white; user-select: none;"><div class="notion-topbar" style="width: 100%; max-width: 100vw; height: 45px; opacity: 1; transition: opacity 700ms ease 0s, color 700ms ease 0s; position: relative;"><div style="display: flex; justify-content: space-between; align-items: center; overflow: hidden; height: 45px; padding-left: 12px; padding-right: 10px;"><div class="notranslate shadow-cursor-breadcrumb" style="display: flex; align-items: center; line-height: 1.2; font-size: 14px; height: 100%; flex-grow: 0; margin-right: 8px; min-width: 0px;"><div class="notion-selectable notion-page-block" data-block-id="6f173729-5884-4d32-8452-4cbeea3e462c" style="display: flex; align-items: center; min-width: 0px;"><a href="index.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">BMPixel网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div class="notion-selectable notion-collection_view-block" data-block-id="27dbe900-3c41-4c13-bd5a-432418911021" style="display: flex; align-items: center; min-width: 0px;"><a href="27dbe9003c414c13bd5a432418911021.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 6px; padding-right: 6px; color: rgb(55, 53, 47);" tabindex="0"><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 240px;">5.1. 循环神经网络</div></div></div><div style="flex-grow: 1; flex-shrink: 1;"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="searchNew" style="width: 14px; height: 14px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 17 17"><path d="M6.78027 13.6729C8.24805 13.6729 9.60156 13.1982 10.709 12.4072L14.875 16.5732C15.0684 16.7666 15.3232 16.8633 15.5957 16.8633C16.167 16.8633 16.5713 16.4238 16.5713 15.8613C16.5713 15.5977 16.4834 15.3516 16.29 15.1582L12.1504 11.0098C13.0205 9.86719 13.5391 8.45215 13.5391 6.91406C13.5391 3.19629 10.498 0.155273 6.78027 0.155273C3.0625 0.155273 0.0214844 3.19629 0.0214844 6.91406C0.0214844 10.6318 3.0625 13.6729 6.78027 13.6729ZM6.78027 12.2139C3.87988 12.2139 1.48047 9.81445 1.48047 6.91406C1.48047 4.01367 3.87988 1.61426 6.78027 1.61426C9.68066 1.61426 12.0801 4.01367 12.0801 6.91406C12.0801 9.81445 9.68066 12.2139 6.78027 12.2139Z"></path></svg>Search</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0">Duplicate</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 32px; height: 28px; border-radius: 3px;" tabindex="0"><svg class="dots" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden;" viewBox="0 0 13 3"><g><path d="M3,1.5A1.5,1.5,0,1,1,1.5,0,1.5,1.5,0,0,1,3,1.5Z"></path><path d="M8,1.5A1.5,1.5,0,1,1,6.5,0,1.5,1.5,0,0,1,8,1.5Z"></path><path d="M13,1.5A1.5,1.5,0,1,1,11.5,0,1.5,1.5,0,0,1,13,1.5Z"></path></g></svg></div><div style="flex: 0 0 auto; width: 1px; height: 16px; margin-left: 8px; margin-right: 8px; background: rgba(55, 53, 47, 0.16);"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="notionLogo" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 120 126"><path d="M 20.6927 21.9315C 24.5836 25.0924 26.0432 24.8512 33.3492 24.3638L 102.228 20.2279C 103.689 20.2279 102.474 18.7705 101.987 18.5283L 90.5477 10.2586C 88.3558 8.55699 85.4356 6.60818 79.8387 7.09563L 13.1433 11.9602C 10.711 12.2014 10.2251 13.4175 11.1939 14.3924L 20.6927 21.9315ZM 24.8281 37.9835L 24.8281 110.456C 24.8281 114.351 26.7745 115.808 31.1553 115.567L 106.853 111.187C 111.236 110.946 111.724 108.267 111.724 105.103L 111.724 33.1169C 111.724 29.958 110.509 28.2544 107.826 28.4976L 28.721 33.1169C 25.8018 33.3622 24.8281 34.8225 24.8281 37.9835ZM 99.5567 41.8711C 100.042 44.0622 99.5567 46.2512 97.3618 46.4974L 93.7143 47.2241L 93.7143 100.728C 90.5477 102.43 87.6275 103.403 85.1942 103.403C 81.2983 103.403 80.3226 102.186 77.4044 98.54L 53.5471 61.087L 53.5471 97.3239L 61.0964 99.0275C 61.0964 99.0275 61.0964 103.403 55.0057 103.403L 38.2148 104.377C 37.727 103.403 38.2148 100.973 39.9179 100.486L 44.2996 99.2717L 44.2996 51.36L 38.2158 50.8725C 37.728 48.6815 38.9431 45.5225 42.3532 45.2773L 60.3661 44.0631L 85.1942 82.0036L 85.1942 48.4402L 78.864 47.7136C 78.3781 45.0351 80.3226 43.0902 82.7569 42.849L 99.5567 41.8711ZM 7.5434 5.39404L 76.9175 0.285276C 85.4366 -0.445402 87.6285 0.0440428 92.983 3.93368L 115.128 19.4982C 118.782 22.1747 120 22.9034 120 25.8211L 120 111.187C 120 116.537 118.051 119.701 111.237 120.185L 30.6734 125.05C 25.5584 125.294 23.124 124.565 20.4453 121.158L 4.13735 99.9994C 1.21516 96.1048 0 93.191 0 89.7819L 0 13.903C 0 9.5279 1.94945 5.8785 7.5434 5.39404Z"></path></svg>Try Notion</div></div></div><div style="width: calc(100% - 0px); user-select: none;"></div></div><div class="notion-frame" style="flex-grow: 0; flex-shrink: 1; display: flex; flex-direction: column; background: white; z-index: 1; height: calc(100vh - 45px); max-height: 100%; position: relative; width: 1920px;"><div class="notion-scroller vertical" style="display: flex; flex-direction: column; z-index: 1; flex-grow: 1; position: relative; align-items: center; margin-right: 0px; margin-bottom: 0px; overflow: hidden auto;"><div style="position: absolute; top: 0px; left: 0px;"><div></div></div><div class="whenContentEditable" data-content-editable-root="true" style="caret-color: rgb(55, 53, 47); width: 100%; display: flex; flex-direction: column; position: relative; align-items: center; flex-grow: 1; --whenContentEditable--WebkitUserModify:read-write-plaintext-only;"><span style="height: 1px; width: 1px;"></span><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0; z-index: 2;"><div style="position: relative; width: 100%; display: flex; flex-direction: column; align-items: center; height: 30vh; cursor: default;"><div style="width: 100%; cursor: inherit;"><div style="display: grid; width: 100%; height: 30vh;"><div style="grid-area: 1 / 1 / auto / auto;"><img referrerpolicy="same-origin" src="553a8ac74d866e91a0f8f6da82e138ac16c8b5cf.jpg" style="display: block; object-fit: cover; border-radius: 0px; background: white; width: 100%; height: 30vh; opacity: 1; object-position: center 50%;"/></div></div></div><div aria-hidden="true" style='background: rgba(0, 0, 0, 0.4); border-radius: 3px; color: white; font-size: 12px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; width: 180px; left: calc(50% - 90px); padding: 0.3em 1.5em; pointer-events: none; position: absolute; top: calc(50% - 10px); text-align: center; opacity: 0;'>Drag image to reposition</div></div></div><div style="width: 100%; display: flex; justify-content: center; z-index: 3; flex-shrink: 0;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div style="max-width: 100%; padding-left: calc(96px + env(safe-area-inset-left)); width: 100%;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; pointer-events: none;"><div class="notion-page-controls" style='display: flex; justify-content: flex-start; flex-wrap: wrap; margin-top: 16px; margin-bottom: 4px; margin-left: -1px; color: rgba(55, 53, 47, 0.5); font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; height: 24px; pointer-events: auto;'></div></div><div style="padding-right: calc(96px + env(safe-area-inset-right));"><div><div class="notion-selectable notion-page-block" data-block-id="7d4551fa-66b6-4eb0-afc2-3bbe775fe33e" style='color: rgb(55, 53, 47); font-weight: 700; line-height: 1.2; font-size: 40px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; cursor: text; display: flex; align-items: center;'><div contenteditable="false" data-content-editable-leaf="true" placeholder="Untitled" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">5.1. 循环神经网络</div></div><div style="margin-left: 4px;"></div></div></div></div></div><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div contenteditable="false" data-content-editable-void="true" style="padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right)); max-width: 100%; width: 100%;"><div style="width: 100%; font-size: 14px;"><div style="width: 100%; max-width: 100%; padding: 8px 0px; margin: 0px auto;"><div style="width: 100%; max-width: 100%; padding-top: 8px; margin: 0px auto;"><div style="padding-bottom: 8px;"><div style="margin: 0px;"></div></div></div></div></div><div style="width: 100%; height: 1px; background: rgba(55, 53, 47, 0.09); margin-bottom: 8px;"></div></div></div></div></div><main style="display: flex; width: 100%; justify-content: center; padding-top: 5px;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div class="notion-page-content" style="flex-shrink: 0; flex-grow: 1; max-width: 100%; display: flex; align-items: flex-start; flex-direction: column; font-size: 16px; line-height: 1.5; width: 100%; z-index: 4; padding-bottom: 30vh; padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right));"><div class="notion-selectable notion-header-block" data-block-id="9082e32e-f5ef-4a6d-a725-2531e52fefb7" style="width: 100%; max-width: 1718px; margin-top: 2em; margin-bottom: 4px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 1" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.875em; line-height: 1.3;'>循环神经网络</div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="4eda975d-4d92-41ca-b703-1e367e18b8dc" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>为什么需要循环神经网络</div></div></div><div class="notion-selectable notion-text-block" data-block-id="27b265a6-e5d2-482a-bc85-95a761d8b286" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">卷积神经网络是处理2维图像的方法，那么如果我们要处理1维序列数据要怎么办呢？没错，我们可以使用1维卷积神经网络——从序列中截取不同的片段进行卷积操作。这种卷积神经网络如果被应用在文字序列上，就被称之为Text-CNN。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0095418c-9833-414b-855f-e1cfe00ff9a2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">好吧，对于绝大多数序列处理任务，1维卷积神经网络的表现并没有那么理想。我们使用的更多的是一种叫做<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">循环神经网络</span>的网络<span class="notion-enable-hover" data-token-index="3" style="font-weight:600">（Recurrent Neural Network，RNN）</span>。典型的循环神经网络的工作机制是，把一个序列拆成n个时间顺序上的单元，循环神经网络使用<span class="notion-enable-hover" data-token-index="5" style="font-weight:600">同样的网络结构</span>处理每一个单元并综合出答案。由于RNN每处理t时间刻的数据都需要一个来自t-1时间刻的网络输出，因此RNN计算不同的数据存在先后关系，我们运行网络n次来处理一个序列。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="74856b7e-1a6d-41c7-8057-aa8b60690df2" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="57b4259c5b3b4b979145ea1127609c522adc93dd.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6f2138b2-9de0-4a43-8c54-3e2e7c342bec" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-05-27 下午3.15.20</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3ee3d686-7079-42a8-b656-f5836c3831cc" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">上图就是一个循环神经网络的工作示意图。在不考虑输出的情况下，我们定义每次网络<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">f</span>都接受输入<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">t</span>⟩和状态<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">h</span>⟨<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">t</span> − 1⟩，并输出状态<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">h</span>⟨<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">t</span>⟩。 <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">h</span>⟨<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">t</span>⟩ = <span class="notion-enable-hover" data-token-index="23" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="25" style="font-style:italic">h</span>⟨<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">t</span> − 1⟩, <span class="notion-enable-hover" data-token-index="30" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="32" style="font-style:italic">t</span>⟩; <span class="notion-enable-hover" data-token-index="35" style="font-style:italic">θ</span>) 在这里之所以使用<span class="notion-enable-hover" data-token-index="38" style="font-style:italic">h</span>字母代表状态，是因为一般情况下我们直接从网络中抽取部分隐藏层（<span class="notion-enable-hover" data-token-index="40" style="font-weight:600">H</span>idden）单元值作为状态值。从这个定义可以看出，<span class="notion-enable-hover" data-token-index="42" style="font-style:italic">h</span>⟨<span class="notion-enable-hover" data-token-index="44" style="font-style:italic">t</span>⟩状态值需要尽可能地包含了网络处理过去<span class="notion-enable-hover" data-token-index="47" style="font-style:italic">t</span> − 1帧的所有信息。在这篇笔记中，我们记<span class="notion-enable-hover" data-token-index="49" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="50" style="font-style:italic">x</span>表示输入 <span class="notion-enable-hover" data-token-index="52" style="font-style:italic">x</span> 的长度，<span class="notion-enable-hover" data-token-index="54" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="55" style="font-style:italic">y</span>表示输出 <span class="notion-enable-hover" data-token-index="57" style="font-style:italic">y</span> 的长度，<span class="notion-enable-hover" data-token-index="59" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="61" style="font-style:italic">i</span>)⟨<span class="notion-enable-hover" data-token-index="63" style="font-style:italic">t</span>⟩表示第 <span class="notion-enable-hover" data-token-index="66" style="font-style:italic">i</span> 个输入样本的第 <span class="notion-enable-hover" data-token-index="68" style="font-style:italic">t</span> 个词语，其余同理。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="7dbf9621-c31f-4f74-b2bd-1ffd588f1e8a" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>循环神经网络的应用</div></div></div><div class="notion-selectable notion-text-block" data-block-id="b4eba75a-1dbe-4892-a52d-139800f351fe" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">RNN是为了处理序列数据诞生的，音频，文字，基因序列，视频流都是一种序列信息。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="aa321691-9142-4686-a56d-1862e7149f5a" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="ec8eca9078f6c5180b7fed7368b6dd3f99edb028.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="da704364-b8f6-4f42-87a8-3c5a77c539f5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">简要阐述一下上图中的任务类型。</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="8652c811-343e-4cc7-bbeb-ca3aa60d868e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">Speech recoigntion 语音识别：</span>输入的语音信号<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">X</span>，输出相应的语音文本信息<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">Y</span>。无论是语音信号还是文本信息均是序列数据。</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="dedeefae-57fc-43e6-b3ac-81b2b91beb6e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">Music generation 音乐生成：</span>生成音乐乐谱。只有输出的音乐乐谱<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">Y</span>是序列数据，输入<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">X</span>可以是空或者什么其他东西，在种情况下，我们每次<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">f</span>得到的输入就只包含状态<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">h</span>。是的，循环神经网络可以处理或者产生序列数据，而输出输入是否都要是序列，长度是否需要匹配其实都不影响我们使用循环神经网络。</div></div><div class="notion-selectable notion-text-block" data-block-id="4d03369e-402c-4f92-a087-a90b4e723a7d" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="3be0f50e-6453-4ef2-b8b3-0d3db3ac0fb5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">Sentiment classification 情感分类</span>：将输入的评论句子<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">X</span>转换为相应的等级或评分。输入是一个序列，输出则是一个单独的类别。</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="10fd5e84-0b37-4784-a3a2-feaa7bee96d8" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">DNA sequence anlysis DNA序列分析：</span>找到输入的DNA序列的蛋白质表达的子序列，输入<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">X</span>是DNA序列，输出<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">Y</span>是一样长的序列，不过序列上的某一位是一个ℝ ∈ [0, 1]，代表<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">X</span>中的对应该位有多大的可能性是用于蛋白质表达的。</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="768c7d0f-3cf9-4771-81b0-3ba631613382" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">Machine translation 机器翻译：</span>两种不同语言之间的相互转换。输入和输出均为序列数据。</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="35c3d96f-eb32-41ca-99e2-e14ed89e89aa" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">Video activity recogntion 视频行为识别：</span>识别输入的视频帧序列中的人物行为。</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="0b2d9658-3cc3-47fe-bc80-1e3f708860ea" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">Name entity recognition 命名实体识别：</span>从输入的句子中识别出实体的名字，输出输入的结构类似于DNA序列分析。</div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="dd6a520e-bdf6-4878-8e49-1a624bea18c2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">以上展示的只是循环神经网络的应用广度，而在我们最为需要的那些领域（自然语言处理等）当中，RNN也在阅读理解，对话问答等人类擅长的领域有着非常深入的应用和研究。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="243f4c3d-9542-4b92-89a1-b7f883bae288" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">## 如何表示我们的序列处理问题</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="fc1911db-72af-41bb-a494-f9dfa82a93bc" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">好了，如果我们现在想要把“I Love You.”输入一个循环神经网络，我们应该怎么办？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="9d2f0ee0-3aa9-4dc2-acf6-53eabe63bcbe" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">你可能会说把<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span> → <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">b</span>映射到1-26的数字中，每次就输入一个字母对应数字。这样做很简单，但是现在我们人眼一眼就能辨认的单词“Love”对于网络至少需要运行四次才能辨认，而且在这样情况下每次输入的数据形式和过小的数据量也不适合神经网络处理，当然如果是中文也许就还比较合适。事实上，我们常常采用构建一个<span class="notion-enable-hover" data-token-index="5" style="font-weight:600">词汇表(Vocabulary)</span> 的方式，实现把一个单词映射成一个独一无二的列向量。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="5335d02f-2801-4700-be6e-9aa0cfb7c901" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们使用One-hot编码来编码单词：设置一个长长的列向量，每一个单词都有其中的自己的位置。每个单词所映射出的列向量（<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">词向量</span>）就是一个仅有对应位为1，其余位均为零的向量。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8288f15b-b034-4a00-a0b5-0d9371485886" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">比如我们现在有一句话：“Harry Potter and Hermione Granger invented a new spell”，那么我们可能会首先构建一个大小为|<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">V</span>| × 1的词汇表： $$
Vocabulary = \begin{bmatrix}
1\rightarrow&amp;a\\
2\rightarrow&amp;aaron\\
\vdots&amp;\vdots\\
367\rightarrow&amp;and\\
\vdots&amp;\vdots\\
4075\rightarrow&amp;harry\\
\vdots&amp;\vdots\\
6830\rightarrow&amp;potter\\
\vdots&amp;\vdots\\
9999\rightarrow&amp;zulu\\
10000\rightarrow&amp;&lt;UNK&gt;\\
\end{bmatrix}
$$ 那么，我们的第一个词“Harry”的对应输入就是<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">x</span>(1) = [0, 0, ⋯, 1, ⋯, 0]<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">T</span>，其中只有第4075位是1。注意，我们的词汇表的最后一位是&lt;UNK&gt;，这代表了所有的不在这个词汇表里的词语。对于所有这些算法不认识的词语，它看到的就都是同一个单词&lt;UNK&gt;。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="72e7cdf8-1c2c-454b-b0d8-c30fcb169dee" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>运用循环神经网络模型</div></div></div><div class="notion-selectable notion-text-block" data-block-id="5a169b0a-c9fd-4ef4-986d-d2e6528c1b42" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们现在考虑一个最简单的问题：将“Harry Potter and Hermione Granger invented a new spell”中的人名词语选出来。我们可以这样定义正确的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Y</span>：[1, 1, 0, 1, 1, 0, 0, 0, 0]，<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">y</span>上的某一位对应了<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">x</span>上的对应单词，这一位是1表示<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">x</span>上的这一个单词是名字的一部分。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="9f37da45-d5c8-4dac-8900-4379d016e37f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果不使用循环神经网络，我们会想到用一个全连接神经网络解决问题。但是直接使用全连接神经网络存在着不小的问题：</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="7861e1cf-3d85-4137-8bd2-4e9d694ae492" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">一方面，全连接神经网络的输入和输出的大小尺寸是固定的，我们在处理序列问题时常常要面对各种长度的输入和输出。也许你会说我们可以预设置一个足够长的输入和输出，如果实际情况中的输入输出小于这个值我们就通过末尾补零的方式补足序列长度。这可以解决问题，但是怎么看也不是一个优雅的方法。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0fc9bdd8-018b-405e-9c87-37bfec56c0f0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">另一方面，全连接神经网络在序列的不同位置单独学习所有知识特征，这其实并不是我们想要的。正如我们希望在卷积神经网络中在图片左下角学习到的特征可以应用于图片右上角一样，如果我们在句子的开头学习到了“Harry很可能是人名”的知识，我么也希望这个知识也能够运用在句子中间。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f23a8706-641e-4adf-a569-6087df98ea98" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">而且，如果我们每次输入都需要输入一个很大的输入向量<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">X</span> ∈ <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">R</span>[Sentence Length，|<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">V</span>|]，那我们的算法也会变的完全不必要的缓慢。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="de7c4635-7fe6-4b14-b009-6be5e6b4893d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">因此我们需要把之前介绍的循环网络结构应用到这个问题中来。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="aa0a0c28-98eb-4152-8769-aa5dc94986c1" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="552d3a9bb6c9a12884c99d62aa70e237da6404ba.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="bff876ae-d223-44d9-852b-ea0a1688191c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">上图所示的就是一个最简单的循环神经网络RNN的一个单元的结构图。这代表什么意思呢？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="33302257-aa83-44b7-a6ad-74dfbe9f80ed" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们现在不妨假设我们已经处理到第<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">t</span>⟩个词语，并且我们有一个来自上一个单元的隐藏值<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">t</span> − 1⟩。现在我们把<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">t</span>⟩和<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="18" style="font-style:italic">t</span> − 1⟩各乘以一个权重值进行线性变换得到<span class="notion-enable-hover" data-token-index="21" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">x</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="26" style="font-style:italic">t</span>⟩和<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="30" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="31" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="32" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">t</span> − 1⟩，把它们相加以后带入到Tanh激活函数中去得到属于这个单元的隐藏层<span class="notion-enable-hover" data-token-index="37" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">t</span>⟩ = tanh (<span class="notion-enable-hover" data-token-index="42" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="43" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="44" style="font-style:italic">x</span><span class="notion-enable-hover" data-token-index="45" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="47" style="font-style:italic">t</span>⟩ + <span class="notion-enable-hover" data-token-index="50" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="51" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="52" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="53" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="55" style="font-style:italic">t</span> − 1⟩ + <span class="notion-enable-hover" data-token-index="58" style="font-style:italic">b</span><span class="notion-enable-hover" data-token-index="59" style="font-style:italic">a</span>)，这个隐藏层值就会被带入到下一个RNN单元中去进行运算。最后，每个单元都需要输出这个<span class="notion-enable-hover" data-token-index="61" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="63" style="font-style:italic">t</span>⟩代表人名的概率，我们还需要计算<span class="notion-enable-hover" data-token-index="66" style="font-style:italic">ŷ</span>⟨<span class="notion-enable-hover" data-token-index="68" style="font-style:italic">t</span>⟩ = SoftMax(<span class="notion-enable-hover" data-token-index="71" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="72" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="73" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="74" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="76" style="font-style:italic">t</span>⟩ + <span class="notion-enable-hover" data-token-index="79" style="font-style:italic">b</span><span class="notion-enable-hover" data-token-index="80" style="font-style:italic">y</span>)。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="53e64308-5dbb-4dd7-90c9-c8cc7ab20596" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">值得注意的几点是：</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="543a4ee4-47d1-469e-be88-1cb4b19ccdbb" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">我们的每一个单元都需要用到上一个单元的隐藏层输出，那么第一个单元使用谁的隐藏层输出呢？所以我们一般额外定义最开始的隐藏层是<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span> = <span class="notion-enable-hover" data-token-index="3" style="font-weight:600">0</span>。</div></div><div class="notion-selectable notion-text-block" data-block-id="4d55014d-3393-4dbf-ba5a-ac3b8b44f6ab" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨0⟩</div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="bd7671dc-2ade-433f-98d4-f7796d9a1eb0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">可以看到，每一个<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span>都实际上承载了<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">x</span>⋯<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">x</span>的信息，这正是网络可以综合整个序列进行处理分析的原因之一。</div></div><div class="notion-selectable notion-text-block" data-block-id="e7f3c462-32bc-40fd-813c-942b07036151" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6d0b6145-e369-46e0-9557-53c4d04ad82d" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨1⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c400cad0-0991-43f3-bde4-534d479d73b1" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="3ed1a8f5-c9c3-4653-8f22-011c64c13bb6" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">虽然执行在一句话中我们要执行非常多个单元，但是实际上我们在每个单元计算的时候使用的是同一套参数，也就是实际上我们只优化一个单元，关于处理一整句话的不同部位的所有知识都存储在这一个单元的参数里。</div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ea9d1703-2625-4551-9b19-71e677b9d6d6" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们把这个网络的每个单元计算展开，就得到了这个循环神经网络的展开计算图。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="d1baca3f-7e37-411b-99b2-cf87f4f3cf08" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="ab94c14dca74a46a6bcb28d9bb7ab5e8076a6bad.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="babca951-b709-4e01-8fe0-965492b459c9" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>RNN和CNN有什么共同特点？</div></div></div><div class="notion-selectable notion-text-block" data-block-id="cc113d88-535c-4eaf-9441-108d8b87cead" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">答案是它们都使用了参数共享的技巧。正如下面这张图片：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="a3eafb04-660c-4ece-8db7-9a3a7da848a9" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="167be4e6aad3f251e2a0aa61811a8b69b47cecdc.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8e6dada5-c179-47c8-b5a3-0b97318e6e70" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-05-31 下午7.45.21</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ce0ca224-c003-4819-96d4-fb359219a086" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">卷积神经网络通过卷积操作在不同图像区域之间共享卷积核上的参数，而循环神经网络在序列的不同区域之间共享单元内部的参数。从编码的角度来看，无论卷积还是循环神经网络其实都是对变长序列的一种“<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">局部编码</span>”：每一个组件由于只能对一小数据部分编码，于是就需要把这个组件不断地运用于数据的不同部分以实现对整体数据的编码。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c95ac953-e83c-404b-861a-78a44732042a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">出于严谨的考虑，接下来我使用<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">参数对称</span>代替<span class="notion-enable-hover" data-token-index="3" style="font-weight:600">参数共享</span>，在这个语境下它们代表同一件事。当我们在网络中发现了参数对称的现象（可以是像CNN一样手动设置的，也可以是自然产生的），我们得到了参数共享的必然结果——<span class="notion-enable-hover" data-token-index="5" style="font-weight:600">不变性Invariance</span>和<span class="notion-enable-hover" data-token-index="7" style="font-weight:600">等变性Equivariance</span>。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="943ffc2b-f5b9-4bd5-ac32-42c3e98a6979" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">不变性</span>指的是我们的网络的输出现在不会因为某些**输入的变动（*）**而改变输出结果。比如在图像识别任务中，同一只猫出现在图片的左侧和图片的右侧都不会影响我们的算法认为这张图片显示的是一只猫。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="62b11864-e463-4ae1-9ce2-6892eac19259" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">而<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">等变性</span>指的是当我们改变网络的输入以后，网络以一种可以预知的方式对应的改变了输出，那么这时我们就称该过程体现了等变性。比如我们的解决人名标记任务的循环神经网络，单词“Harry Potter”出现在句首时，我们的算法在输出<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">ŷ</span>的前端对应位置产生比较高的激活；而当单词“Harry Potter”出现在句尾时，我们的算法就在输出<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">ŷ</span>的末端对应区域产生比较高的激活。</div></div></div></div><div class="notion-selectable notion-quote-block" data-block-id="19129ad0-3996-4f7c-b775-fb08140dac08" style="width: 100%; max-width: 1718px; margin-top: 4px; margin-bottom: 4px;"><div style="font-size: 1em; padding: 3px 2px; color: inherit; fill: inherit; display: flex;"><div style="border-left: 3px solid currentcolor; padding-left: 14px; padding-right: 14px; width: 100%;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Empty quote" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding-left: 2px; padding-right: 2px;">**（*）如何定义输入的变动？这需要将我们的教程稍微提高一些理论的高度。简单来说，我们的变动是在输入上的一个对称操作，也就是这是一种等价的操作，经过这种操作，我们的操作数据依然在某种意义上不变。这些操作构成了一个对称群。说的这么复杂，实际上就CNN而言，这个对称指的就是图片平移操作**，而对于循环神经网络而言，可能就是保证语义信息不变下的语法结构变换。</div><div class="notion-selectable notion-text-block" data-block-id="9971f470-3c04-4727-9e50-12835a083d08" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这个群定义了我们的模型映射的对称性，而这个对称性本质上是由参数的对称性完全保证的；而实际上也证明了，任何模型映射的对称性都是可以通过参数共享的方式实现的。</div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="006a9df5-6a3a-41c5-a8c4-4a376a6b614c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">从实践的角度来看，除了等变性和不变性的特点以外，参数共享还带来了一个优点：<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">防止过拟合。</span>怎么理解？其实从梯度流动的角度来看就明白了。一对输入和输出就可以对途径模型上的所有参数进行监督，对于没有参数共享的模型而言，每个参数在一次迭代中只能被一对输入和输出监督；但是在使用了参数共享的CNN模型中，每一个卷积核在一次迭代中会被无数对的输入小图块和输出共同监督，在一定意义上这就是引入了更多的数据，有效地减缓了过拟合。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="89fc33ef-be8f-451d-ad3b-73f57da26924" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">当然，我们也可以把这认为这是一种正则化：正则化本质上就是将我们观察得到的先验知识注入模型来减小模型可以遍历的假设空间，而我们事实上观察到的等变性和不变性的特征暗示了我们的网络里应该存在某些参数对称的现象，因此我们显式地通过设计网络结构强制参数对称来注入我们的经验和先验知识。、</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="2296abdb-1f39-477d-ad3c-cf7d8bb4ac96" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">你可能觉得这么讲有故作玄虚的嫌疑，但是从正则化的角度理解确实可以更好的解释一些现象。这篇教程编写的时间是2021年5月，这段时间出现了一些论文表明实际上纯MLP的网络可以比有卷积层，注意力机制的复杂网络有更好的表现，具体的工作有Google的MLP-Mixer等等。如何看待这些现象，这是否意味着我们之前一直使用着最为强大的网络却一直不自知呢？怎么想也不该是这样，如果使用参数对称的正则化思想我们就可以比较深入地看待这些问题。首先，在不考虑网络的训练难度情况下，最为纯粹稠密的全连接网络（甚至有稠密的跳层连接）理论上有最好的表达能力，因为无论所谓的卷积神经网络还是循环神经网络甚至ResNet都是可以通过把一个足够庞大的全连接神经网络去掉部分连接来得到的。只要我们给出足够多的数据和足够强的数据增强，即使是全连接网络也会有一天能够学习到所有的参数对称特点，我们使用复杂的各种技巧无非是通过强制的参数共享使得网络一开始就具备参数对称的特点。那么如果我们某一天发现一个纯MLP网络可以媲美现在的这些复杂的具有参数对称特点的网络，我想原因基本上有三个：</div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="73483725-8971-4147-9f25-93fc0c02c1e7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"1."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">MLP网络达到最优的这个任务的确没有明显的对称结构，强行参数共享的网络反而无法成为最优的假设；</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="6405c6fd-ae6f-44ad-85c0-3bbc9846160e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"2."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">这个MLP网络在另一种层面上实现了潜在的参数对称，比如MLP-Mixer，实际上和现有的对称网络做的事差不多；</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="1f359552-70a6-4f6f-89b5-8b3a3dd5ee18" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"3."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">这个MLP网络在训练的过程中使用了更多的数据增强，使得网络通过学习的方式自己学习到了参数对称。</div></div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="666939b9-dfaa-4886-ab05-c64eaf8afa73" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>反向传播穿越时间</div></div></div><div class="notion-selectable notion-text-block" data-block-id="74473ed9-d7a1-443f-b6b1-23c755ff9870" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">为了通过反向传播优化循环神经网络，首先我们要定义一下在循环神经网络中的损失函数。在上面的人名标注问题中，我们对某一个时间戳上的损失采用交叉熵损失函数： <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">L</span>⟨<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">t</span>⟩(<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">ŷ</span>⟨<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">t</span>⟩, <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">y</span>⟨<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">t</span>⟩) =  − <span class="notion-enable-hover" data-token-index="16" style="font-style:italic">y</span>⟨<span class="notion-enable-hover" data-token-index="18" style="font-style:italic">t</span>⟩<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">g</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">ŷ</span>⟨<span class="notion-enable-hover" data-token-index="25" style="font-style:italic">t</span>⟩ − (1 − <span class="notion-enable-hover" data-token-index="28" style="font-style:italic">y</span>⟨<span class="notion-enable-hover" data-token-index="30" style="font-style:italic">t</span>⟩)<span class="notion-enable-hover" data-token-index="33" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="34" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="35" style="font-style:italic">g</span>(1 − <span class="notion-enable-hover" data-token-index="37" style="font-style:italic">ŷ</span>⟨<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">t</span>⟩) 那么我们在整个序列上的损失函数就可以定义为： $$
J(\theta) = L_\theta(\hat y, y) = \sum^{T_x}_{t=1} L^{⟨t⟩}(\hat y^{⟨t⟩}, y^{⟨t⟩})
$$ 我们可以用一张图演示一下循环神经网络当中的梯度流动：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="447597ef-87c5-4978-937c-21a0fe48408d" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="d2ba09bfb39505526b0e39bb52fcd72f846a61bf.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6827f7ad-bc19-41f0-84ff-29d13bbd9666" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-06-02 下午7.00.18</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="bb43c365-806a-4d86-9d82-6190a367f6e3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">循环神经网络的反向传播被称为通过<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">时间反向传播(Backpropagation through time)</span>，因为从右向左计算的过程就像是时间倒流。我们可以知道循环神经网络中的梯度大致满足如下规律，考虑最后一个时间刻的输出能够监督出来的对应梯度： $$
\frac{\partial L^{⟨T_x⟩}}{\partial W} \propto
\sum_{t=1}^{T_x} \left(\prod_{k=t+1}^{T_x} \frac{\partial a_k}{\partial a_{k-1}}\right)\frac{\partial a_t}{\partial W}
$$ 这里的$\prod_{k=t+1}^{T_x} \frac{\partial a_k}{\partial a_{k-1}}$值得引起我们注意，如果该值过小，我们的网络的较靠前单元中的参数就很难学习到最后一个输出<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">y</span>⟨<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">x</span>⟩的监督带来的任何信息，这就叫做循环神经网络中的<span class="notion-enable-hover" data-token-index="11" style="font-weight:600">梯度消失（Gradient Vanishing）</span>现象；如果这个值过大，那么算法中就有可能由于计算数字太大而使得某些梯度的值变成<span class="notion-enable-hover" data-token-index="13" style="font-weight:600">NaN（Not a Number）</span>，网络的训练都无法进行了，这就是循环神经网络中的<span class="notion-enable-hover" data-token-index="15" style="font-weight:600">梯度爆炸（Gradient Explosion）</span>现象。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="34b1949e-5915-4e1d-acbc-53d4708dc6d5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">那么如何解决梯度消失和梯度爆炸问题呢？</span>对于梯度爆炸问题，一种常见的操作是<span class="notion-enable-hover" data-token-index="2" style="font-weight:600">梯度裁剪方法（Gradient Clip）</span>：只要发现梯度的大小过大了我们就缩放梯度到一个合理的大小。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="f6ece3b1-a54c-468d-80de-f24f6647a8d3" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="4a69bdf2dc0737ee05d4cd51e0180d5c2e3dbc1d.jpeg" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6bc83077-2035-42e1-bac6-d0b30e2b8826" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">那梯度消失问题怎么办呢？这个问题会稍微复杂一些，我们需要单独的一篇笔记来介绍解决梯度消失问题的好办法——GRU和LSTM网络<a class="notion-link-token notion-focusable-token notion-enable-hover" data-token-index="1" href="1.1.%20循环神经网络结构.md" rel="noopener noreferrer" style="cursor:pointer;color:inherit;word-wrap:break-word;text-decoration:inherit" tabindex="0"><span class="link-annotation-6bc83077-2035-42e1-bac6-d0b30e2b8826-205405002" style="border-bottom:0.05em solid;border-color:rgba(55,53,47,0.4);opacity:0.7">1.1. 循环神经网络结构</span></a>。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="d15b304e-0c3d-469e-985b-1d64e5cf943b" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>不同类型的循环神经网络</div></div></div><div class="notion-selectable notion-text-block" data-block-id="17138f16-5a07-4230-8a3f-d75dff2dda06" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们之前介绍的问题中输入和输出有着一样的长度，但是在介绍循环神经网络的应用时我们就提到了，循环神经网络的输入输出的长度实际上没有严格的要求。通常来说，根据输出输入的长度划分，循环神经网络主要有以下几种：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="1b16090c-f87e-4940-a22a-f941e4af6a08" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="869c26d3a44163dfe06b5b3c3114b98dfc52ebff.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0cdd95aa-fefc-486a-b006-881644232ec8" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">简单解释一下：</div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="33d6edeb-3b9e-4526-a314-6556c7284f05" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"1."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">many-to-many (<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">T</span> = <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">T</span>)：这种情况下的输入和输出的长度相同，正如上面例子的结构；</div></div><div class="notion-selectable notion-text-block" data-block-id="7c2d9684-04ac-4909-9d2e-8977ad0d3174" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="1aa818dd-4a0d-47b4-95b7-d5dd581e463a" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">y</span></div></div></div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="cb864dc0-45d6-4c40-aefd-b2a6dea1113c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"2."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">many-to-one：如在情感分类问题中，我们要对某个序列进行正负判别或者打星操作。在这种情况下，输入是一个序列，但输出只有一个值；</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="c2a769f4-7cd3-4705-a171-8ed986e85fdf" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"3."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">one-to-many：如在音乐生成的例子中，我们只输入一个音乐的类型或者空值，直接生成一段音乐序列或者音符序列。在这种情况下，就是输入是一个值，但输出是一个序列；</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="3881e1ee-9e95-4102-89b7-86ffaeead9d6" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"4."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">many-to-many (<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">T</span> ≠ <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">T</span>)：像机器翻译这种类似的应用来说，输入和输出都是序列，但长度却不相同，这是另外一种多对多的结构，叫做Encoder-Decoder结构。</div></div><div class="notion-selectable notion-text-block" data-block-id="bc8730d2-d391-4ce1-90bc-35f20432bb34" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="396cae48-9d09-4264-aa0b-cc3c5ecc8f05" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">y</span></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="1380ec01-3f69-4289-8c78-29ace70cb4f2" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>语言模型和序列生成</div></div></div><div class="notion-selectable notion-text-block" data-block-id="3b59cb1e-37f0-4085-8d0b-d9f6d95b94a9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">要了解自然语言处理，首先离不开的就是构建语言模型。我们可以使用之前学习到的RNN来很好的构造一个语言模型。首先，什么是语言模型？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="32dfb0c2-949c-44e2-9d3a-f189b1c3b67a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">最简单来说，语言模型就是一个能够计算一个词语序列有多大的概率是一句话的模型。比如“我，吃了，梨子”就很有可能是一句话，而“抓住，卡车，西红柿”就相对而言不那么可能是一句话。在这里我们并不讨论一堆词语是一句话的概率的具体大小，我们主要关注的是不同的词语组合构成的概率的关系和相对大小。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e6bf6386-6a50-4fd3-9601-c539c8ba9dec" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">语言模型的发展，从整体来看，经历了早期的统计学习为主到逐渐转向深度学习领域的变化。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6e019b35-fa0a-408d-be16-40b4f208e19f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">统计学中常常使用的语言模型是N-gram模型。要理解这个模型，我们首先要理解如何定义语言模型。我们对于词语序列<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">n</span>，我们记<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">n</span>)为该序列是一句话的概率。条件概率的相关知识告诉我们： <span class="notion-enable-hover" data-token-index="21" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="26" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="29" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="30" style="font-style:italic">n</span>) = <span class="notion-enable-hover" data-token-index="32" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="35" style="font-style:italic">n</span>)<span class="notion-enable-hover" data-token-index="37" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="40" style="font-style:italic">n</span>|<span class="notion-enable-hover" data-token-index="42" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="45" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="48" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="49" style="font-style:italic">n</span> − 1) 显然，<span class="notion-enable-hover" data-token-index="53" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="55" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="58" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="61" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="62" style="font-style:italic">n</span>)和<span class="notion-enable-hover" data-token-index="64" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="66" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="67" style="font-style:italic">n</span>)都可以根据统计的方式得到，我们构建语言模型的核心问题其实就是设计一个可以计算条件概率<span class="notion-enable-hover" data-token-index="69" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="71" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="72" style="font-style:italic">n</span>|<span class="notion-enable-hover" data-token-index="74" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="77" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="80" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="81" style="font-style:italic">n</span> − 1)的模型，也就是一个可以预测一段话中下一个字是什么的模型。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="9f9dc422-5862-47d1-87dc-eb69838bc2cd" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>N-gram模型</div></div></div><div class="notion-selectable notion-text-block" data-block-id="ffb78899-5809-443c-8ad4-a54935839b05" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">由于我们不可能直接记录下所有条件概率<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">n</span>|<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="12" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">n</span> − 1)，设计一个支持任意的输入长度的模型在过去也是难度非常高的一件事，因此 N-gram模型假设语言模型符合<span class="notion-enable-hover" data-token-index="16" style="font-weight:600">n阶马尔可夫假设(Nth Order Markov Assumption)</span>：一句话中每个词语的概率都只由它的前<span class="notion-enable-hover" data-token-index="18" style="font-style:italic">n</span>个词语决定，和再之前的词语就无关了，也就是： $$
\begin{align}
P(w_1,w_2,\cdots,w_n)&amp;= P(w_n)P(w_n|w_1, w_2,\cdots,w_{n-1})\\
&amp;= P(w_n)P(w_n|w_{n-k},w_{n-k+1},\cdots,w_{n-1})
\end{align}
$$ 我们接下来使用二阶马尔可夫假设，这时我们的语言模型使用的方法就叫做<span class="notion-enable-hover" data-token-index="22" style="font-weight:600">3-Trigram</span>模型。 $$
\begin{align}
P(w_n|w_{n-2},w_{n-1})P(w_{n-2},w_{n-1})&amp;= P(w_{n-2},w_{n-1},w_n)\\
P(w_n|w_{n-2},w_{n-1})&amp;= \frac{P(w_{n-2},w_{n-1},w_n)}{P(w_{n-2},w_{n-1})}\\
&amp;=\frac{\text{Count}(w_{n-2},w_{n-1},w_n)}{\text{Count}(w_{n-2},w_{n-1})}
\end{align}
$$ Count( ⋅ )表示某个词序列在训练集中出现的次数。这个公式虽然看着非常简单，但是这里也是蕴涵着最大似然估计的思想呢。很显然，N-gram模型的方法还是有着不少的缺陷，需要记下大量的概率值，统计非常消耗时间都是它的缺点。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="9a76b9eb-09e1-4683-a98d-22418dd21f73" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>RNN模型</div></div></div><div class="notion-selectable notion-text-block" data-block-id="7448dad1-053b-4574-90e2-353bf3fa11f7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">人们发现RNN天然非常适合构建语言模型：网络结构很适合表达<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">n</span>|<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="12" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">n</span> − 1)，可以处理变长度的序列等等……因此我们接下来就将介绍使用循环神经网络来构建一个语言模型。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="728b7233-4c63-4ffd-8be3-cdd0c35259cc" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们具体按照以下流程构建这个模型：</div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="e51e2bc7-a81d-4251-bf7b-a7d36dbaa93e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"1."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">我们需要的训练集是一个大型的语料库(Corpus)，也就是数量众多的句子组成的文本。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="f7a9dae4-3098-4c2f-b9b7-f8b3ae678f3b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"2."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">建立过程的第一步是标记化(Tokenize)，即建立字典；</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="a0e4eba4-8342-442e-bfaf-9479cc8c3e8e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"3."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">然后将语料库中的每个词表示为对应的 one-hot 向量，同时未出现在字典库中的词使用&lt;UNK&gt;来表示。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="546535f1-1266-4d49-aa0a-a9597fd90014" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"4."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">我们需要增加一个额外的标记&lt;EOS&gt;(End of Sentence)来表示一个句子的结尾，否则我们的网络无法学习到句子应该何时结束的信息。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="acf6f55f-036a-43c5-87a4-5ef611f573e5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"5."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">标点符号可以忽略，也可以加入字典后用 one-hot 向量表示。</div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b921b859-ef6f-4024-8416-d035faa534c0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">将标志化后的训练集用于训练 RNN，过程如下图所示：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="d92d9dba-9180-4876-b9e6-cc385f3c85c5" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="ec1eb990e0162122171935c5fb02605410efc159.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="645b3255-66ff-4b00-89ba-cb4979cefad5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在第一个时间步中，输入的 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span>⟨0⟩和 <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">x</span>⟨1⟩都是零向量，通过 softmax 预测出的字典中每个词的概率<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">ŷ</span>⟨1⟩作为第一个词出现的概率，<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">w</span>1)就这样被计算出来；</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="854dc338-e39d-4c98-8ad5-60fe3f67c2f9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在第二个时间步中，输入<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">x</span>⟨2⟩（训练样本的标签中的第一个单词 <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">y</span>⟨1⟩（即“cats”））和上一层的激活项<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">a</span>⟨1⟩，输出的 <span class="notion-enable-hover" data-token-index="10" style="font-style:italic">y</span>⟨2⟩表示的是通过 softmax 预测出的单词“cats”后面出现字典中的任意一个每个词的条件概率（<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">w</span>|“<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">t</span>” )）。以此类推，最后就可以得到整个句子出现的概率。我们按照这种方式计算RNN每一个输出值，RNN中的每一步在计算时都会考虑前面得到的单词。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3faf9351-906e-4829-b6c8-97c35386ba6f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">接下来为了训练这个网络，我们要定义代价函数，在某个时间步<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>，如果真正的词是<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">y</span>⟨<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">t</span>⟩，而神经网络的softmax层预测结果值是<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">ŷ</span>⟨<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">t</span>⟩，那么我们的softmax损失函数长这样：</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c8260e7a-c87a-4d1a-b6b4-9caf27ef7819" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">$$
L(\hat y^{⟨t⟩}, y^{⟨t⟩}) = -\sum_{i=1}^{n_{output}} y_i^{⟨t⟩} log \hat y_i^{⟨t⟩}
$$ 网络训练完成以后我们就可以使用这个模型计算一个词语序列的概率了。由于t时刻的网络输出<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">ŷ</span>⟨<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">t</span>⟩ = <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">t</span>|<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">t</span> − 1)，我们最终的整句话的的概率<span class="notion-enable-hover" data-token-index="22" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">w</span>1, <span class="notion-enable-hover" data-token-index="27" style="font-style:italic">w</span>2, ⋯, <span class="notion-enable-hover" data-token-index="30" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="31" style="font-style:italic">n</span>)就可以表示为： $$
P(w_1, w_2, \cdots,w_n)=\prod_{t=0}^{n} \hat y^{⟨t⟩}_{k_t}
$$ 其中<span class="notion-enable-hover" data-token-index="35" style="font-style:italic">k</span><span class="notion-enable-hover" data-token-index="36" style="font-style:italic">t</span>代表词典中<span class="notion-enable-hover" data-token-index="38" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="39" style="font-style:italic">t</span>的对应下标。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="83bdec8c-d5f1-4b2a-80f0-9f395b6c1551" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>如何评价语言模型</div></div></div><div class="notion-selectable notion-text-block" data-block-id="88493601-a2db-4791-8408-6c81f9d52229" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在训练一个语言模型之后，要想了解到这个模型学到了什么，一种非正式的方法就是进行一次新序列的采样。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="10bf630e-faca-4200-8e16-39d92b148794" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="b7d8a6eabd7adf8b2cacb7af60b6ca0d94bffd72.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="aa1fd4d1-e637-42ec-9c67-ca3678674d9a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在第一个时间步输入 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span>⟨0⟩和 <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">x</span>⟨1⟩为零向量，输出预测出的字典中每个词作为第一个词出现的概率，根据 softmax 的分布进行随机采样，将采样得到的 <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">ŷ</span>⟨1⟩作为第二个时间步的输入 <span class="notion-enable-hover" data-token-index="10" style="font-style:italic">x</span>⟨2⟩；进而 softmax 层会预测下一个输出 <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">ŷ</span>⟨2⟩ ，依次类推；直到采样到 &lt;EOS&gt;。这样多操作几次，模型会自动生成一些句子，从这些句子中可以发现模型通过语料库学习到的知识。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="83bbf50b-ef14-4a16-bf83-d64c7d0a4714" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这里建立的是基于词汇构建的语言模型。根据需要也可以构建基于字符的语言模型，其优点是不必担心出现未知标识(UNK)，其缺点是得到的序列过多过长，并且训练成本高昂。因此，基于词汇构建的语言模型更为常用。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="749abbab-ebfd-4bdd-a52a-99d8f384ac1e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">参考资料：</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="9d2da3af-8d66-41d3-adae-6125b1f7255f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1] Coursera Deeplearning.AI深度学习教程：https://www.coursera.org/specializations/deep-learning</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a1a0b216-91ec-40c7-b869-9f32ad116f52" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[2] Siamak Ravanbakhsh et.al Equivariance Through Parameter-Sharing</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="57efe038-ab6a-4154-86f8-4f286b44cba3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[3] 深入理解语言模型 Language Model https://zhuanlan.zhihu.com/p/52061158</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ed36fcb1-b5a3-4c44-8964-5c9400aa327f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[4]The Exploding and Vanishing Gradients Problem in Time Series https://towardsdatascience.com/the-exploding-and-vanishing-gradients-problem-in-time-series-6b87d558d22</div></div></div></div></div></div><div contenteditable="false" data-content-editable-void="true" style="width: 0px;"><div style="display: none; flex-shrink: 0; pointer-events: none; width: 0px; position: absolute; right: 192px; opacity: 0;"><div style="display: flex; flex-direction: column; padding: 5px 16px; width: 340px; flex-shrink: 0; height: 100%; position: relative; pointer-events: none; z-index: 1;"><div style="position: absolute; pointer-events: none; width: 100%; height: 100%; top: -5px; background: linear-gradient(white 0px, rgba(255, 255, 255, 0) 15px);"></div></div></div></div></main><span style="height: 1px; width: 1px;"></span></div><div class="notion-presence-container" style="position: absolute; top: 0px; left: 0px; z-index: 89;"><div></div></div></div></div></div><div class="notion-peek-renderer" style="position: fixed; top: 0px; right: 0px; bottom: 0px; width: 960px; z-index: 109; transform: translateX(960px) translateZ(0px);"></div></div></div></div></div><textarea aria-hidden="true" style="opacity: 0; pointer-events: none; position: fixed; left: 0px; top: 0px;" tabindex="-1"></textarea><script src="1172e9111a5fb396bcb8a05870b5eabf8abf221c.js" type="text/javascript"></script><div style="width: env(safe-area-inset-bottom);"></div></body></html>