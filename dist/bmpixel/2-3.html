<html class="notion-html"><head lang="en"><meta charset="utf-8"/><meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"/><title>2.3. 调参技巧</title><meta content="en_US" property="og:locale"/><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="/images/logo-ios.png" rel="apple-touch-icon"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="telephone=no" name="format-detection"/><meta content="no" name="msapplication-tap-highlight"/><link href="e218a1aef6df86309cb95b61e446888efa3b0379.css" media="print" rel="stylesheet"/><link href="e1d809d762eeca23edf0cb31bb17bf3c703085f5.css" rel="stylesheet"/><link href="ea336c780f905bf8e5199e24de64f0cf84362824.css" rel="stylesheet"/></head><body class="notion-body"><style>body{background:#fff}body.dark{background:#191919}@keyframes startup-shimmer-animation{0%{transform:translateX(-100%) translateZ(0)}100%{transform:translateX(100%) translateZ(0)}}@keyframes startup-shimmer-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes startup-spinner-rotate{0%{transform:rotate(0) translateZ(0)}100%{transform:rotate(360deg) translateZ(0)}}#initial-loading-spinner{position:fixed;height:100vh;width:100vw;z-index:-1;display:none;align-items:center;justify-content:center;opacity:.5}#initial-loading-spinner svg{height:24px;width:24px;animation:startup-spinner-rotate 1s linear infinite;transform-origin:center center;pointer-events:none}#skeleton{background:#fff;position:fixed;height:100vh;width:100vw;z-index:-1;display:none;overflow:hidden}#initial-loading-spinner.show,#skeleton.show{display:flex}body.dark #skeleton{background:#191919}.notion-front-page #skeleton,.notion-mobile #skeleton{display:none}#skeleton-sidebar{background-color:#fbfbfa;box-shadow:inset -1px 0 0 0 rgba(0,0,0,.025);display:flex;width:240px;flex-direction:column;padding:12px 14px;overflow:hidden}body.dark #skeleton-sidebar{background-color:#202020;box-shadow:inset -1px 0 0 0 rgba(255,255,255,.05)}#skeleton.isElectron #skeleton-sidebar{padding-top:46px}#skeleton .row{display:flex;margin-bottom:8px;align-items:center}#skeleton .row.fadein{animation:1s ease-in 0s 1 normal both running startup-shimmer-fade-in}#skeleton .chevron{width:12px;height:12px;display:block;margin-right:4px;fill:rgba(227,226,224,.5)}body.dark #skeleton .chevron{fill:#2f2f2f}.startup-shimmer{background:rgba(227,226,224,.5);overflow:hidden;position:relative}body.dark .startup-shimmer{background:#2f2f2f}.startup-shimmer::before{content:"";position:absolute;height:100%;width:100%;z-index:1;animation:1s linear infinite startup-shimmer-animation;background:linear-gradient(90deg,transparent 0,rgba(255,255,255,.4) 50%,transparent 100%)}body.dark .startup-shimmer::before{background:linear-gradient(90deg,transparent 0,rgba(86,86,86,.4) 50%,transparent 100%)}#skeleton .icon{width:20px;height:20px;border-radius:4px}#skeleton .text{height:10px;border-radius:10px}#skeleton .draggable{-webkit-app-region:drag;position:absolute;top:0;left:0;width:100%;height:36px;display:none}#skeleton.isElectron .draggable{display:block}</style><style id="scroll-properties">
			::-webkit-scrollbar {
				width: 10px;
				height: 10px;
			}
			::-webkit-scrollbar {
				background: transparent;
			}
			::-webkit-scrollbar-track {
				background: #EDECE9;
			}
			::-webkit-scrollbar-thumb {
				background:#D3D1CB;
			}
			::-webkit-scrollbar-thumb:hover {
				background:#AEACA6;
			}
		</style><div id="notion-app"><div class="notion-app-inner notion-light-theme" style='color: rgb(55, 53, 47); fill: currentcolor; line-height: 1.5; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; -webkit-font-smoothing: auto; background-color: white;'><div style="height: 100%;"><div class="notion-cursor-listener" style="width: 100vw; height: 100%; position: relative; display: flex; flex: 1 1 0%; background: white; cursor: text;"><div class="" style="display: flex; flex-direction: column; width: 100%; overflow: hidden;"><div style="max-width: 100vw; z-index: 100; background: white; user-select: none;"><div class="notion-topbar" style="width: 100%; max-width: 100vw; height: 45px; opacity: 1; transition: opacity 700ms ease 0s, color 700ms ease 0s; position: relative;"><div style="display: flex; justify-content: space-between; align-items: center; overflow: hidden; height: 45px; padding-left: 12px; padding-right: 10px;"><div class="notranslate shadow-cursor-breadcrumb" style="display: flex; align-items: center; line-height: 1.2; font-size: 14px; height: 100%; flex-grow: 0; margin-right: 8px; min-width: 0px;"><div class="notion-selectable notion-page-block" data-block-id="6f173729-5884-4d32-8452-4cbeea3e462c" style="display: flex; align-items: center; min-width: 0px;"><a href="index.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">BMPixel网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div class="notion-selectable notion-collection_view-block" data-block-id="27dbe900-3c41-4c13-bd5a-432418911021" style="display: flex; align-items: center; min-width: 0px;"><a href="27dbe9003c414c13bd5a432418911021.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 6px; padding-right: 6px; color: rgb(55, 53, 47);" tabindex="0"><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 240px;">2.3. 调参技巧</div></div></div><div style="flex-grow: 1; flex-shrink: 1;"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="searchNew" style="width: 14px; height: 14px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 17 17"><path d="M6.78027 13.6729C8.24805 13.6729 9.60156 13.1982 10.709 12.4072L14.875 16.5732C15.0684 16.7666 15.3232 16.8633 15.5957 16.8633C16.167 16.8633 16.5713 16.4238 16.5713 15.8613C16.5713 15.5977 16.4834 15.3516 16.29 15.1582L12.1504 11.0098C13.0205 9.86719 13.5391 8.45215 13.5391 6.91406C13.5391 3.19629 10.498 0.155273 6.78027 0.155273C3.0625 0.155273 0.0214844 3.19629 0.0214844 6.91406C0.0214844 10.6318 3.0625 13.6729 6.78027 13.6729ZM6.78027 12.2139C3.87988 12.2139 1.48047 9.81445 1.48047 6.91406C1.48047 4.01367 3.87988 1.61426 6.78027 1.61426C9.68066 1.61426 12.0801 4.01367 12.0801 6.91406C12.0801 9.81445 9.68066 12.2139 6.78027 12.2139Z"></path></svg>Search</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0">Duplicate</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 32px; height: 28px; border-radius: 3px;" tabindex="0"><svg class="dots" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden;" viewBox="0 0 13 3"><g><path d="M3,1.5A1.5,1.5,0,1,1,1.5,0,1.5,1.5,0,0,1,3,1.5Z"></path><path d="M8,1.5A1.5,1.5,0,1,1,6.5,0,1.5,1.5,0,0,1,8,1.5Z"></path><path d="M13,1.5A1.5,1.5,0,1,1,11.5,0,1.5,1.5,0,0,1,13,1.5Z"></path></g></svg></div><div style="flex: 0 0 auto; width: 1px; height: 16px; margin-left: 8px; margin-right: 8px; background: rgba(55, 53, 47, 0.16);"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="notionLogo" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 120 126"><path d="M 20.6927 21.9315C 24.5836 25.0924 26.0432 24.8512 33.3492 24.3638L 102.228 20.2279C 103.689 20.2279 102.474 18.7705 101.987 18.5283L 90.5477 10.2586C 88.3558 8.55699 85.4356 6.60818 79.8387 7.09563L 13.1433 11.9602C 10.711 12.2014 10.2251 13.4175 11.1939 14.3924L 20.6927 21.9315ZM 24.8281 37.9835L 24.8281 110.456C 24.8281 114.351 26.7745 115.808 31.1553 115.567L 106.853 111.187C 111.236 110.946 111.724 108.267 111.724 105.103L 111.724 33.1169C 111.724 29.958 110.509 28.2544 107.826 28.4976L 28.721 33.1169C 25.8018 33.3622 24.8281 34.8225 24.8281 37.9835ZM 99.5567 41.8711C 100.042 44.0622 99.5567 46.2512 97.3618 46.4974L 93.7143 47.2241L 93.7143 100.728C 90.5477 102.43 87.6275 103.403 85.1942 103.403C 81.2983 103.403 80.3226 102.186 77.4044 98.54L 53.5471 61.087L 53.5471 97.3239L 61.0964 99.0275C 61.0964 99.0275 61.0964 103.403 55.0057 103.403L 38.2148 104.377C 37.727 103.403 38.2148 100.973 39.9179 100.486L 44.2996 99.2717L 44.2996 51.36L 38.2158 50.8725C 37.728 48.6815 38.9431 45.5225 42.3532 45.2773L 60.3661 44.0631L 85.1942 82.0036L 85.1942 48.4402L 78.864 47.7136C 78.3781 45.0351 80.3226 43.0902 82.7569 42.849L 99.5567 41.8711ZM 7.5434 5.39404L 76.9175 0.285276C 85.4366 -0.445402 87.6285 0.0440428 92.983 3.93368L 115.128 19.4982C 118.782 22.1747 120 22.9034 120 25.8211L 120 111.187C 120 116.537 118.051 119.701 111.237 120.185L 30.6734 125.05C 25.5584 125.294 23.124 124.565 20.4453 121.158L 4.13735 99.9994C 1.21516 96.1048 0 93.191 0 89.7819L 0 13.903C 0 9.5279 1.94945 5.8785 7.5434 5.39404Z"></path></svg>Try Notion</div></div></div><div style="width: calc(100% - 0px); user-select: none;"></div></div><div class="notion-frame" style="flex-grow: 0; flex-shrink: 1; display: flex; flex-direction: column; background: white; z-index: 1; height: calc(100vh - 45px); max-height: 100%; position: relative; width: 1920px;"><div class="notion-scroller vertical" style="display: flex; flex-direction: column; z-index: 1; flex-grow: 1; position: relative; align-items: center; margin-right: 0px; margin-bottom: 0px; overflow: hidden auto;"><div style="position: absolute; top: 0px; left: 0px;"><div></div></div><div class="whenContentEditable" data-content-editable-root="true" style="caret-color: rgb(55, 53, 47); width: 100%; display: flex; flex-direction: column; position: relative; align-items: center; flex-grow: 1; --whenContentEditable--WebkitUserModify:read-write-plaintext-only;"><span style="height: 1px; width: 1px;"></span><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0; z-index: 2;"><div style="position: relative; width: 100%; display: flex; flex-direction: column; align-items: center; height: 30vh; cursor: default;"><div style="width: 100%; cursor: inherit;"><div style="display: grid; width: 100%; height: 30vh;"><div style="grid-area: 1 / 1 / auto / auto;"><img referrerpolicy="same-origin" src="ff0735e115b49119132fe5183c20482b57e4383e.jpg" style="display: block; object-fit: cover; border-radius: 0px; background: white; width: 100%; height: 30vh; opacity: 1; object-position: center 50%;"/></div></div></div><div aria-hidden="true" style='background: rgba(0, 0, 0, 0.4); border-radius: 3px; color: white; font-size: 12px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; width: 180px; left: calc(50% - 90px); padding: 0.3em 1.5em; pointer-events: none; position: absolute; top: calc(50% - 10px); text-align: center; opacity: 0;'>Drag image to reposition</div></div></div><div style="width: 100%; display: flex; justify-content: center; z-index: 3; flex-shrink: 0;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div style="max-width: 100%; padding-left: calc(96px + env(safe-area-inset-left)); width: 100%;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; pointer-events: none;"><div class="notion-page-controls" style='display: flex; justify-content: flex-start; flex-wrap: wrap; margin-top: 16px; margin-bottom: 4px; margin-left: -1px; color: rgba(55, 53, 47, 0.5); font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; height: 24px; pointer-events: auto;'></div></div><div style="padding-right: calc(96px + env(safe-area-inset-right));"><div><div class="notion-selectable notion-page-block" data-block-id="e2a88395-6f27-456f-9e43-ef033df56e3c" style='color: rgb(55, 53, 47); font-weight: 700; line-height: 1.2; font-size: 40px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; cursor: text; display: flex; align-items: center;'><div contenteditable="false" data-content-editable-leaf="true" placeholder="Untitled" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">2.3. 调参技巧</div></div><div style="margin-left: 4px;"></div></div></div></div></div><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div contenteditable="false" data-content-editable-void="true" style="padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right)); max-width: 100%; width: 100%;"><div style="width: 100%; font-size: 14px;"><div style="width: 100%; max-width: 100%; padding: 8px 0px; margin: 0px auto;"><div style="width: 100%; max-width: 100%; padding-top: 8px; margin: 0px auto;"><div style="padding-bottom: 8px;"><div style="margin: 0px;"></div></div></div></div></div><div style="width: 100%; height: 1px; background: rgba(55, 53, 47, 0.09); margin-bottom: 8px;"></div></div></div></div></div><main style="display: flex; width: 100%; justify-content: center; padding-top: 5px;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div class="notion-page-content" style="flex-shrink: 0; flex-grow: 1; max-width: 100%; display: flex; align-items: flex-start; flex-direction: column; font-size: 16px; line-height: 1.5; width: 100%; z-index: 4; padding-bottom: 30vh; padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right));"><div class="notion-selectable notion-header-block" data-block-id="a2ffd8bc-3a27-49c8-a442-773edf7ee7ab" style="width: 100%; max-width: 1718px; margin-top: 2em; margin-bottom: 4px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 1" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.875em; line-height: 1.3;'>调节超参数的基本流程</div></div></div><div class="notion-selectable notion-text-block" data-block-id="26a827c7-eb84-4d6b-a3df-9b786cfbdf2a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">挑选合适的超参数，对于提升我们的模型的表现是非常有帮助的。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="e15f8d6e-9924-46d4-b4e7-828c079ea046" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>调节超参数的顺序</div></div></div><div class="notion-selectable notion-text-block" data-block-id="6056fd93-bf14-4b5e-a933-e6a3747f5d7b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">一个神经网络中有大量可以调节并影响算法速度的变量。它们大体上可以被分为以下两部分：</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="479dc7f1-8f78-4e98-9a11-d776800b9364" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">超参数（Hyper parameters）</span>：如学习率α、adam方法的β1和β2参数、网络层数、每层隐藏单元数、学习率衰减值、mini-batch大小等需要人工选取的参数。这些参数在算法训练的过程中不会发生变化。</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="966c858e-ebf9-4575-bf76-be12d5215a04" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">可学习参数</span>：这里所指的参数另外一种说法就是权重，需要被训练的参数。比如：<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic">X</span> + <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">b</span>，这里<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">W</span>、<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">b</span>就是参数。通常来说，虽然参数在训练过程中会自动发生变化，但是这些参数的初始值依然是需要我们指定的，不同的参数初始值也会影响到最终的参数值和算法效果。</div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="fb242dc6-fe49-4e56-acfb-8dbeedb118e6" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">而对于超参数，不同的超参数对算法的影响程度自然是不同的，原则上我们应该先调节对算法影响更大的参数，后调节对算法影响小的参数。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="af7e8e2a-56dc-4bae-a005-3040b588bd0d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果把超参数按照对于算法表现的影响大小排排序，它们大致是这样的：</div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="a38a3a04-c246-4a41-9b67-3465f0e84ad2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"1."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">学习速率</span><span class="notion-enable-hover" data-token-index="1" style="font-style:italic;font-weight:600">α</span>：初始学习率很重要，学习率的变化策略也很重要。学习速率大小不仅影响函数收敛的快慢，更影响你的参数最终会落在哪个局部最优值。通常来说可以选择的范围是0.1到0.00001。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="1922449c-425c-4e41-8c0d-f57384000451" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"2."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">隐藏层单元数量</span>：影响你的模型的复杂程度。太复杂模型有可能过拟合，太简单了模型很可能不具备充分学习数据特点的能力。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="89e6479d-9cdf-4015-8016-490f35c03a38" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"3."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">Mini-batch梯度下降时候的Batch-size</span>：我们用的随机梯度下降是建立在batch基础上的，合适的batch size对你模型的优化是比较重要的，这个参数倒不需要微调，在一个大致数量即可，常取2的n次方，太大的batch size会受GPU显存的限制，所以不能无限增大。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="7dd1a3be-88ba-43e3-9f5b-253d7763c62f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"4."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">动量方法中的</span><span class="notion-enable-hover" data-token-index="1" style="font-style:italic;font-weight:600">β</span>：如果你看过我之前关于“我们为什么需要动量”的笔记，你就会知道动量影响函数能否收敛，梯度下降时能够接受的最大学习速率等等因素。不过由于一般来说把动量设置为0.9表现都还不错，因此在重要性的榜单里它并没有那么靠前。（如果你看过之前的“我们为什么需要动量”的笔记，你会知道问题的条件数越大，我们就应该选择越大的<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">β</span>，一般来说深度学习中的问题由于复杂性和高维性条件数都不太理想，因此把<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">β</span>设置的尽量大就很好。）</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="12aabbd4-f75d-43b1-9c34-ca239df06148" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"5."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">隐藏层的层数</span>：和隐藏层的单元数量的影响是近似的。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="7ab28b77-dcad-454f-a607-29f8b282b904" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"6."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">学习速率规划的参数</span>：学习速率参数规划影响参数最终是否会落在某个局部最小值。下图显示了使用不同的学习速率规划可以影响梯度下降路径。</div></div><div class="notion-selectable notion-image-block" data-block-id="ee7bf417-23e8-481f-adbe-de3e6de1fb46" style="width: 100%; max-width: 100%; align-self: flex-start; margin-top: 4px; margin-bottom: 0px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="231361c0d17421ab872718133bb8b0509ddbf4cc.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="ff670cd9-3338-4859-b3b4-428b779e6127" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"7."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">β</span>1, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">β</span>2, <span class="notion-enable-hover" data-token-index="6" style="font-style:italic">ϵ</span>等优化算法的参数。通常来说一般使用默认值就可以达到比较好的效果。</div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="c6f9ce8c-fbb7-42e3-b402-c31b56e35afe" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>选取超参数的方法</div></div></div><div class="notion-selectable notion-text-block" data-block-id="c58c1219-6ef8-4251-b4b4-54e6f2db9cd9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">很多时候我们要同时选择多个参数，那么我们可以把选择超参数的过程，看作在一个二维或者多维的空间里取点的过程。而选择超参数是有许多方法的。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="6c252408-31d3-43b9-82a4-1c1f36a6c5df" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>避免均匀取点</div></div></div><div class="notion-selectable notion-text-block" data-block-id="678af233-d574-496c-9804-56be4ef11be8" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">有时我们同时考虑两个参数对算法的影响效果，我们可能会把两个参数在一个二维平面内均匀采样，如下图。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="d61845a9-467b-4b56-b2fe-380b7d3c3e40" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="9ab7b4dcdc28df7260471a4c212595ba1f1d33fc.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="997172c5-7c87-4874-856f-8207eb464ab9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在上图中，可能一个参数代表学习速率<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">α</span>，而另一个参数代表<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">ϵ</span>。但是我们都知道<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">α</span>对于算法的表现至关重要，但是<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">ϵ</span>就没有那么重要了。如果你在这里按照先<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">ϵ</span>后<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">α</span>的顺序选择参数，那么你可能选了9个参数，把这些点都试遍了却只尝试了不同的$$3次，而实际上有效的测试也只近似于3次，显然这样的尝试是浪费迭代测试的机会。因此我们取点时应该遵循随机选择的规则。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="19e22bbc-ea77-4170-b1a8-f5fa037015d7" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="3ac9eae4629e1c08e7e1235126d35fa86a261535.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a6c99647-708f-47d2-9aba-742aa08db2c6" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果我们使用随机的参数选择方法，那么我们在每一次尝试中都可以使用到不同的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">α</span>，选择9个测试点就选择了9个不同的<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">α</span>（代价就是不容易知道算法的效率提升是由哪个超参数导致的），测试变的更有效了，这种选择方法主要用于我们不知道哪个超参数比较重要的时候。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="ee8af67c-d10f-4154-ad73-11405347bc03" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>动态选择参数区间</div></div></div><div class="notion-selectable notion-text-block" data-block-id="6773ef9e-505f-4df2-b96b-0175f0c2d7f1" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">一种很好的方法是，在你选择了一个还不错的参数范围以后，你可以在这个参数的范围内以更高的取点密度选择新的参数点。这样你可以进一步选择到更好参数。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="a147118c-d047-48f3-8082-16f0b38af27b" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="221e79cb5ad5a49008c7da6d972a092f5ceda764.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="c050fcd2-146d-4950-9a2f-9eb34158f8c8" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>选取超参数的尺度</div></div></div><div class="notion-selectable notion-text-block" data-block-id="38ba933b-5e2f-4d60-abf9-0874b408d533" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果我们在网络的层数上作不同选择的实验，那么我们可能按照2 → 5的顺序选择不同的层数；而选择不同的隐藏层单元数时，从25 → 100均匀取值也是合理的；但是如果你在0.0001 − 1.0的范围上均匀选择<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">α</span>，这可能就不是一个明智的选择了（因为对于<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">α</span>来说，0.0001-0.001的差距对算法表现造成的影响可能比0.9-0.1还大，但是我们给0.0001-0.001分配的注意实在是太少了）。相对于原来的按照<span class="notion-enable-hover" data-token-index="5" style="font-weight:600">线型尺度</span>选择参数，这时我们可以考虑按照<span class="notion-enable-hover" data-token-index="7" style="font-weight:600">对数尺度</span>选择参数。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="4d460437-2b03-48da-a0cf-242726829807" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在具体实现中，我们会希望（以<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">α</span>为例）取值为10<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">x</span>，其中<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">x</span>的取值从 − 4.0 → 0.0均匀选取。以这种方式选取参数，我们在0.0001 → 0.001和0.01 − 0.1上将会取出一样多的点。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="10be1795-5c12-468a-938b-832590ec7630" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="2f88b7b0bce60d449582d5d771b44df84bfddad4.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="438cc730-4895-4705-87de-8bd4ad3d0042" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果在代码中实现可能就是：</div></div></div></div><div class="notion-selectable notion-code-block" data-block-id="db86561e-9ce9-4996-aa9d-2136b2b5922c" style="width: 100%; max-width: 1718px; margin-top: 4px; margin-bottom: 4px;"><div style="display: flex;"><div contenteditable="false" data-content-editable-void="true" style="flex-grow: 1; border-radius: 3px; text-align: left; position: relative; background: rgb(247, 246, 243); min-width: 0px; width: 100%;"><div style="position: absolute; top: 8px; left: 8px; z-index: 1; color: rgba(55, 53, 47, 0.65); display: flex; align-items: center; justify-content: flex-end; opacity: 0; transition: opacity 300ms ease-in 0s;"><div aria-disabled="true" role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: default; display: inline-flex; align-items: center; white-space: nowrap; height: 20px; border-radius: 3px; font-size: 12px; line-height: 1.2; padding-left: 5px; padding-right: 5px; color: rgba(55, 53, 47, 0.65); margin-right: 5px;" tabindex="-1">Python<svg class="chevronDown" style="width: 10px; height: 100%; display: block; fill: rgba(55, 53, 47, 0.35); flex-shrink: 0; backface-visibility: hidden; margin-left: 4px;" viewBox="0 0 30 30"><polygon points="15,17.4 4.8,7 2,9.8 15,23 28,9.8 25.2,7 "></polygon></svg></div></div><div style="position: absolute; top: 3px; right: 1px; z-index: 1; color: rgba(55, 53, 47, 0.65); display: flex; align-items: center; justify-content: flex-end; height: 25px; font-size: 11.5px; opacity: 0; transition: opacity 300ms ease-in 0s;"><div style="color: rgba(55, 53, 47, 0.65); display: flex; align-items: center; justify-content: center; font-size: 12px; margin-top: 4px; margin-right: 4px;"><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; white-space: nowrap; height: 25px; border-radius: 3px 0px 0px 3px; font-size: 11.5px; line-height: 1.2; padding: 4px 6px; color: rgb(55, 53, 47); background: rgb(234, 233, 229); font-weight: 400;" tabindex="0"><svg class="copy" style="width: 16px; height: 16px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; padding-right: 4px;" viewBox="0 0 14 16"><path d="M2.404 15.322h5.701c1.26 0 1.887-.662 1.887-1.927V12.38h1.154c1.254 0 1.91-.662 1.91-1.928V5.555c0-.774-.158-1.266-.626-1.74L9.512.837C9.066.387 8.545.21 7.865.21H5.463c-1.254 0-1.91.662-1.91 1.928v1.084H2.404c-1.254 0-1.91.668-1.91 1.933v8.239c0 1.265.656 1.927 1.91 1.927zm7.588-6.62c0-.792-.1-1.161-.592-1.665L6.225 3.814c-.452-.462-.844-.58-1.5-.591V2.215c0-.533.28-.832.843-.832h2.38v2.883c0 .726.386 1.113 1.107 1.113h2.83v4.998c0 .539-.276.832-.844.832H9.992V8.701zm-.79-4.29c-.206 0-.288-.088-.288-.287V1.594l2.771 2.818H9.201zM2.503 14.15c-.563 0-.844-.293-.844-.832V5.232c0-.539.281-.837.85-.837h1.91v3.187c0 .85.416 1.26 1.26 1.26h3.14v4.476c0 .54-.28.832-.843.832H2.504zM5.79 7.816c-.24 0-.346-.105-.346-.345V4.547l3.223 3.27H5.791z"></path></svg>Copy</div></div></div><div><div class="line-numbers notion-code-block" style="display: flex;"><div autocapitalize="off" autocorrect="off" contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="false" style='flex-grow: 1; flex-shrink: 1; text-align: left; font-family: SFMono-Regular, Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; font-size: 85%; tab-size: 2; padding: 34px 16px 32px 32px; min-height: 1em; color: rgb(55, 53, 47); white-space: pre-wrap; word-break: break-all; min-width: 0px;'><span class="token comment" data-token-index="0"># 按照线性尺度取点 0.0001-1.0lr = 0.0001 + np.random.rand() * (1.0 - 0.0001)# 按照对数尺度取点 0.0001-1.0r = -4 * np.random.rand()lr = 10**r</span><span>
</span></div></div></div><div style="background: white; padding-right: 105px;"></div></div>​</div></div><div class="notion-selectable notion-text-block" data-block-id="38963732-0034-4db1-955d-909897ea43c0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">选取指数移动平均数参数的尺度</span>。如果你现在需要选取一些动量法中的<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">β</span>，你希望在0.9 → 0.999上按照对数尺度选择参数，一种很好的办法是你按照选取<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">α</span>的方法选取1 − <span class="notion-enable-hover" data-token-index="6" style="font-style:italic">β</span>即可。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="b259638e-6ef9-4ef2-b82f-9ecd25163777" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>在实践过程中锤炼你的超参数</div></div></div><div class="notion-selectable notion-text-block" data-block-id="8bce2ff7-d17c-4496-bc98-a539202e2c73" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在你找到一个解决你的某个问题的非常好的超参数时，不要就此认为调节参数的任务就结束了。如果你的数据集有了改动，或者你的数据中心的服务器有了升级，那么你都应该重新调整超参数来找到一个新的完美的超参数。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="68725b85-b676-4193-a40b-910a4f0860d0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在训练模型的过程中，对于如何训练模型有两种主流方法。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="05ceab7a-44cb-4bbb-b1dd-e55d365891e3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">熊猫模式：呵护单个模型</span> 在这种方法中，你训练一个并且在较长的时间里都只训练这一个模型。通常当训练一个模型需要很多资源和比较长的时间时会使用这种方法。在这种方法下，我们的训练过程可能是这样的：我们在第一天的时候设置一个初始的参数值，然后看着它梯度下降。在第二天的时候我们发现训练的还挺顺利，我们也许会试着再调高一些学习率；第三天的时候我们发现梯度下降速率有点慢了，可能这时我们遇到病态曲率了，那我们也许就要使用动量法来避免这个情况；第四天的时候振荡了我们就减小学习率使其收敛；第五天感觉还没训练爽，我们也许就再次增大学习率，寻找新的局部最小值。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="31a67fc5-8a35-4f09-9c44-2651fae2365d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">鱼子酱模式：平行训练多个模型</span> 在这种方法中，我们会同时训练多个模型，每个模型之间的参数都有所区别，我们观察这些模型的表现并且同时选出最好的那个。这一般适用于训练一个模型不需要多少资源的时候。这就像是鱼繁殖的方式，一次生产出很多小鱼，但是并不仔细照料，寄希望于这里会诞生健康的小鱼。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="56e93c74-e5fb-434f-a9d3-b37fd6ca622e" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="6930d637422958428808d8670f11a6bf3de6ab12.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-header-block" data-block-id="bbfc6298-b118-4c52-8166-c837c9eca162" style="width: 100%; max-width: 1718px; margin-top: 2em; margin-bottom: 4px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 1" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.875em; line-height: 1.3;'>Batch Normalization</div></div></div><div class="notion-selectable notion-text-block" data-block-id="fbc9c7ef-89ee-4f28-865d-91a7b68f7244" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在训练深度神经网络时一种非常重要的方法叫做Batch Normalization（简称以下BN）。这个方法会使你的参数搜索问题变得很容易，使神经网络对超参数的选择更加稳定，也容易使你很容易地训练甚至是深层网络。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="4d010f7f-21e3-4710-ac2c-15146c1563be" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">回顾我们之前学习到标准化输入的方法，这是一种可以通过降低问题条件数，提高训练的速度的方法。具体方法是对训练数据集进行归一化的操作，即将原始数据减去其均值 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">μ</span> 后，再除以其方差 <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">σ</span>2 。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6efdf9ec-9e85-4186-96a1-eaf728ac13ee" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">但是标准化输入只是对输入进行了处理，但是如果把神经网络视为特征解藕的过程，深处的网络单元组成了一个针对解藕后的特征继续进行处理的子问题，那么我们会意识到只归一化了输入并不能保证解藕特征构成的子问题的条件数依然较低。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="70c5f6e3-d74e-4f1c-9ed1-69bfa3d95c23" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这就启发我们也可以用同样的思路处理隐藏层的激活值 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span>[<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">l</span>]，来加速<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">l</span>层以后的网络计算速度。当然在实践中，经常选择标准化 <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">z</span>[<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">l</span>]： $$
\begin{aligned}
\mu &amp;= \frac{1}{m} \sum_i z^{[l]}_i \\
\sigma^2 &amp;= \frac{1}{m} \sum_i {(z^{[l]}_i - \mu)}^2 \\
\hat z^{[l]}_i &amp;=  \frac{z^{[l]}_i - \mu}{\sqrt{\sigma^2 + \epsilon}}
\end{aligned}
$$ 其中，<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">m</span> 是单个 mini-batch 所包含的样本个数，<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">ϵ</span> 是为了防止分母为零，通常取 10 − 8。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="2d0069c3-2ae0-47d6-9727-c6cb56083215" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这样，我们使得所有的输入 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">ẑ</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">i</span>[<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">l</span>]均值为 0，方差为 1。但我们不想让隐藏层单元总是含有平均值 0 和方差 1，也许隐藏层单元有了不同的分布会更有意义。因此，我们计算： <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">z̃</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">i</span>[<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">l</span>] = <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">γ</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">ẑ</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">i</span>[<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">l</span>] + <span class="notion-enable-hover" data-token-index="20" style="font-style:italic">β</span> 其中$γ $和 <span class="notion-enable-hover" data-token-index="22" style="font-style:italic">β</span> 都是模型的学习参数，所以可以用各种梯度下降算法来更新 <span class="notion-enable-hover" data-token-index="24" style="font-style:italic">γ</span> 和 <span class="notion-enable-hover" data-token-index="26" style="font-style:italic">β</span> 的值，如同更新神经网络的权重一样。通过对<span class="notion-enable-hover" data-token-index="28" style="font-style:italic">γ</span> 和 <span class="notion-enable-hover" data-token-index="30" style="font-style:italic">β</span> 的合理设置，可以让 <span class="notion-enable-hover" data-token-index="32" style="font-style:italic">z̃</span>(<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">i</span>) 的均值和方差为任意值。这样，我们对隐藏层的 <span class="notion-enable-hover" data-token-index="37" style="font-style:italic">z</span>(<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">i</span>)进行标准化处理，用得到的 <span class="notion-enable-hover" data-token-index="42" style="font-style:italic">z̃</span>(<span class="notion-enable-hover" data-token-index="44" style="font-style:italic">i</span>)替代 <span class="notion-enable-hover" data-token-index="47" style="font-style:italic">z</span>(<span class="notion-enable-hover" data-token-index="49" style="font-style:italic">i</span>)。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="df47ac5f-00db-4830-9faf-ed76f64c8591" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">设置 </span><span class="notion-enable-hover" data-token-index="1" style="font-style:italic;font-weight:600">γ</span><span class="notion-enable-hover" data-token-index="2" style="font-weight:600"> 和 </span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic;font-weight:600">β</span><span class="notion-enable-hover" data-token-index="4" style="font-weight:600"> 的原因</span>是：如果各隐藏层的输入均值在靠近 0 的区域，即处于激活函数的线性区域，不利于训练非线性神经网络，从而得到效果较差的模型。因此，需要用 <span class="notion-enable-hover" data-token-index="6" style="font-style:italic">γ</span> 和 <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">β</span> 对标准化后的结果做进一步处理。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="2f835b43-a151-4066-ab75-47babcf30ce4" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>在神经网络中融入BN</div></div></div><div class="notion-selectable notion-text-block" data-block-id="8d177b12-8fba-45a1-880f-ff8c92dee582" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">对于 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">L</span>层神经网络，经过 BN 的作用，整体流程如下：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="61b1afc8-7ed9-446c-9f5d-26646dbc17d3" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="070b06631df6a7af4e600f599578e8a1853782fb.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="43301262-7472-4ae2-ade0-f14419ea975e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">值得注意的是，因为Batch Norm对各隐藏层 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Z</span>[<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">l</span>] = <span class="notion-enable-hover" data-token-index="6" style="font-style:italic">W</span>[<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">l</span>]<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">A</span>[<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">l</span> − 1] + <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">b</span>[<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">l</span>] 有去均值的操作，所以这里的常数项 <span class="notion-enable-hover" data-token-index="20" style="font-style:italic">b</span>[<span class="notion-enable-hover" data-token-index="22" style="font-style:italic">l</span>] 可以消去，其数值效果完全可以由 <span class="notion-enable-hover" data-token-index="25" style="font-style:italic">Z̃</span>[<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">l</span>] 中的 <span class="notion-enable-hover" data-token-index="30" style="font-style:italic">β</span> 来实现。因此，我们在使用Batch Norm的时候，可以忽略各隐藏层的常数项$ b^{[l]}$ 。在使用梯度下降算法时，分别对$ W^{[l]}$， <span class="notion-enable-hover" data-token-index="32" style="font-style:italic">β</span>[<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">l</span>] 和 <span class="notion-enable-hover" data-token-index="37" style="font-style:italic">γ</span>[<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">l</span>] 进行迭代更新。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="2a7697d0-c3bb-4e71-a165-3664bebd3d08" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">除了传统的梯度下降算法之外，还可以使用我们之前介绍过的带动量的梯度下降、RMSprop或者Adam等优化算法。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="72c79836-0b37-4b20-a386-9b9483d15ced" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>在测试数据上使用 Batch Norm</div></div></div><div class="notion-selectable notion-text-block" data-block-id="3d923aa2-4867-4e54-a7fa-a652b2446904" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">训练过程中，Batch Norm是对单个mini-batch进行操作的，但在测试过程中，我们带入的是单个样本，那么这时该如何使用Batch Norm进行处理呢？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c3a4c97c-6895-4794-b348-f725fd05a80d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">首先，回顾一下训练过程中Batch Norm的主要过程： $$
\begin{aligned}
\mu &amp;= \frac{1}{m} \sum_i z^{[l]}_i \\
\sigma^2 &amp;= \frac{1}{m} \sum_i {(z^{[l]}_i - \mu)}^2 \\
\hat z^{[l]}_i &amp;=  \frac{z^{[l]}_i - \mu}{\sqrt{\sigma^2 + \epsilon}}\\
\tilde z^{[l]}_i &amp;= \gamma \hat z^{[l]}_i + \beta
\end{aligned}
$$</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8045796d-2f90-4c69-8060-bfdd54ff59b9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">其中， <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">μ</span> 和 <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">σ</span>2 是对单个mini-batch中所有<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">m</span>个样本求得的。在测试过程中，如果只输入一个样本，求其均值和方差是没有意义的，就需要对 <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">μ</span> 和 <span class="notion-enable-hover" data-token-index="10" style="font-style:italic">σ</span>2 进行估计。这个时候一般使用<span class="notion-enable-hover" data-token-index="13" style="font-weight:600">指数加权平均（exponentially weighted average）</span>的方法来预测测试过程中单个样本的<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">μ</span> 和 <span class="notion-enable-hover" data-token-index="17" style="font-style:italic">σ</span>2</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="77df2ef3-dd83-4798-a8d7-3daf98889c2f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">指数加权平均的做法很简单，对于第 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">l</span> 层隐藏层，考虑所有mini-batch在该隐藏层下的 $^{[l]} $和 <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">σ</span>2[<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">l</span>] ，然后用指数加权平均的方式来预测得到当前单个样本的 <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">μ</span>[<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">l</span>] 和 <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">σ</span>2[<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">l</span>] 。这样就实现了对测试过程单个样本的均值和方差估计。最后，再利用训练过程得到的 <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">γ</span> 和 <span class="notion-enable-hover" data-token-index="20" style="font-style:italic">β</span> 值计算出各层的 <span class="notion-enable-hover" data-token-index="22" style="font-style:italic">z̃</span>(<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">i</span>) 值。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="9a95e64c-3b57-4a5e-b25e-a71cdda17762" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>BN解释</div></div></div><div class="notion-selectable notion-text-block" data-block-id="97137495-86c5-490f-8ab0-afcb93c9c6c8" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在我们没有使用BN的时候，随着我们的训练的进行，网络中的参数也随着梯度下降在不停更新。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8016839f-1748-4497-a692-6538c4d845e5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">一方面，当底层网络中参数发生微弱变化时，由于每一层中的线性变换与非线性激活映射，这些微弱变化随着网络层数的加深而被放大（类似蝴蝶效应）；因此在我们没有引入BN之前，一个深度神经网络的训练是非常依赖于参数的初始化设定和某些算法的结构细节的。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e0b5753f-b779-4312-9374-5e9506511a6f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">另一方面，参数的变化导致每一层的输入分布会发生改变，进而上层的网络需要不停地去适应这些分布变化，每一次迭代得到的梯度的作用都集中在如何去匹配隐藏层的输入分布变化，每一层的参数光鼓捣怎么去追逐一个移动的目标了，这自然使得我们的模型训练变得困难。上述这一现象叫做<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">Internal Covariate Shift</span>。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="cf1175dc-8b4c-465f-901a-42a9d11c5285" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">BN的应用有效地解决了这两个问题。但是这还没有解决另一个问题：为什么BN可以使得曾经不可能的深度神经网络训练成为可能？</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="ba94c50c-7d89-4583-b111-e4afbc815818" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>BN如何解决梯度消失和梯度爆炸问题？</div></div></div><div class="notion-selectable notion-text-block" data-block-id="5d4dff89-3538-40f2-ade2-ec032a812b2e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">深度神经网络难以训练，最主要的问题就是训练过程中的梯度消失和梯度爆炸问题。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c684ecac-f8d3-4c84-8bea-8f90b03d58cb" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">考虑到神经网络的结构的复杂性，这里我们取一个最为简单的神经网络来演示BN的作用效果吧——一个全线性单元的全连接网络。即 $$
\begin{align}
a^0&amp;=x,&amp;x \in \mathbb{R}^{n_x}
\\a^l&amp;=w_l^Ta^{l-1}+b_l,&amp;0&lt;i\leq n.&amp;&amp;且w_i \in \mathbb{R}^{n_{i-1}\times n_{i}},b_i\in\mathbb{R^{n_i}}\\
y &amp;= a_l 
\end{align}
$$ 这个网络不能再简单了，并且我们约定<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">l</span>代表<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">l</span>层的所以单元。让我们看看它的反向传播过程，对于∀0 &lt; <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">i</span> ≤ <span class="notion-enable-hover" data-token-index="10" style="font-style:italic">n</span>，我们都有∂<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">l</span>/∂<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">l</span> − 1 = <span class="notion-enable-hover" data-token-index="19" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="20" style="font-style:italic">l</span>，那么把所有的偏导数连成一串，就有$\partial y/\partial a^l =\prod_{i=l+1}^nw_i$，这解释了一个深度神经网络反向传播中非常简单深刻的一件事：后层梯度的传递非常依赖于网络前部分的参数。在1 → <span class="notion-enable-hover" data-token-index="22" style="font-style:italic">k</span>的过程中存在部分<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="25" style="font-style:italic">i</span>明显过大，那么很可能就会出现梯度爆炸现象；同理，如果部分<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">i</span>过小就意味着可能发生梯度消失现象。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a0c9213b-8daf-43ba-a2e0-9e9a0c638523" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">那么引入BN后会发生什么呢，我们假设BN的作用仅仅是标准化了每一层的激活值，那么BN改变了<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">i</span>和<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">i</span> − 1之间的关系就是： $$
\begin{aligned}
a^l = BN(w^T_la^{l-1})=\frac{w^T_la^{l-1} - \mu}{\sigma_{l}},&amp;&amp;\frac1\sigma=diag\left(\frac1\sigma_1,\frac1\sigma_2,\cdots,\frac1\sigma_{n_l}\right)
\end{aligned}
$$ 这个公式代表了什么意思呢，在这个式子中$\sigma_i=\sqrt{Var(a^i)}$，而我们的网络中现在存在着这样的变化关系：<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">σ</span><span class="notion-enable-hover" data-token-index="11" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">l</span> + <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">μ</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">l</span> = <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">w</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="20" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">l</span> − 1，由于BN也作用在<span class="notion-enable-hover" data-token-index="25" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">l</span> − 1上，我们认为第<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">l</span> − 1层中，∀0 &lt; <span class="notion-enable-hover" data-token-index="31" style="font-style:italic">i</span> ≤ <span class="notion-enable-hover" data-token-index="33" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="34" style="font-style:italic">l</span> − 1，<span class="notion-enable-hover" data-token-index="37" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="38" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="39" style="font-style:italic">l</span> − 1的均值<span class="notion-enable-hover" data-token-index="42" style="font-style:italic">μ</span>为0。让我们对前向传播公式使用方差公式看看吧。我们考察第<span class="notion-enable-hover" data-token-index="44" style="font-style:italic">l</span>层的第k个单元，同时假设影响这第k个单元值的<span class="notion-enable-hover" data-token-index="46" style="font-style:italic">w</span>和<span class="notion-enable-hover" data-token-index="48" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="49" style="font-style:italic">l</span> − 1在mini-batch中都是独立同分布的： $$
\begin{aligned}
\sigma^l_ka^l_k+\mu_l&amp;=(w_{k}^l)^Ta^{l-1}\\
&amp;=\sum_{i=1}^{n_{l-1}}w_{ki}^la^{l-1}_i\\
\sigma_k^lVar(a_k^l)&amp;=n_{l-1}(\mathbb{E}(a_i^{l-1})Var(w_{k}^l)+\mathbb{E}(w_{k}^l)Var(a_i^{l-1})+Var(w_{k}^l)Var(a_i^{l-1}))\\
\sigma_k^l&amp;=n_{l-1}(Var(w_{k}^l)+\mathbb{E}(w_k^l))\\
Var(w_k^l)&amp;=\frac{\sigma_k^l}{n_{l-1}}-\mathbb{E}(w_k^l)
\end{aligned}
$$ 现在我们知道了每一层的权重的方差，而在BN中，我们的梯度变成了$\nabla J(a^l)=\prod_{i=l+1}^{n}(w^l/\sigma^l)$，代入我们上面的，在我们认为参数期望都比较小的情况下，我们得到： $$
Var(\nabla J(a^l))\approx\prod_{i=l+1}^{n}Var((w^l/\sigma^l))=\prod_{i=l+1}^{n}\left(\frac{1}{n_{l-1}}-\frac{\mathbb{E}(w^l)}{\sigma^l}\right)
$$ 这个公式虽然不够严谨，但是它传达了一个非常有用的信息：Batch Normalization承担了阻断权重方差沿着反向传播作用在梯度上的角色，或者换句话说，现在任意均匀放大缩小某一层的权重都不会对梯度造成任何影响。自然就能缓解梯度消失和梯度爆炸的问题。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="263a62f3-32e6-4b6c-9371-63a4b0302e8b" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>BN的效果</div></div></div><div class="notion-selectable notion-text-block" data-block-id="a0c6bf81-5620-43af-8e8a-e2cbbe76098d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在没有使用BN时，实践表明梯度的大小尺度随着网络程度变深逐渐变大，并且我们观察到，随着训练过程，每层梯度的大小在不断缩小，并且越靠前的层梯度越小，这也就是我们常说的梯度消失现象。这一点从我们上面的公式也可以看出来。使用BN可以使得每一层的梯度大小趋于相似，事实上可以会加速训练。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="278e60ff-b720-45fc-b8f1-c83aea88a9bc" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="a0f095fec6e7436920f76de4ef3124a65f2473b3.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="93ad09ab-045e-4178-96a5-077dc85af553" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>BN的正则化效果</div></div></div><div class="notion-selectable notion-text-block" data-block-id="d21c124c-2695-4ad8-b148-3251b7120f5d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">另外，Batch Normalization 也 起到微弱的正则化效果。因为在每个 mini-batch 而非整个数据集上计算均值和方差，只由这一小部分数据估计得出的均值和方差会有一些噪声，因此最终计算出的 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">z̃</span>(<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">i</span>)也有一定噪声。类似于 dropout，这种噪声会使得神经元不会再特别依赖于任何一个输入特征。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="973308d7-9ee8-445c-a6dc-b7fd1e251719" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">但是不要将 Batch Normalization 作为正则化的手段，而是应该把它当作一种加速学习的方式。正则化只是一种非期望的副作用，Batch Normalization 解决的还是反向传播过程中的梯度问题（梯度消失和爆炸）。</div></div></div></div><div class="notion-selectable notion-header-block" data-block-id="9cac05ad-c9a9-465b-a5bf-79f2f0900c09" style="width: 100%; max-width: 1718px; margin-top: 2em; margin-bottom: 4px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 1" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.875em; line-height: 1.3;'>SoftMax回归</div></div></div><div class="notion-selectable notion-text-block" data-block-id="4cff7b41-3bc2-42a7-a57d-4964cf034755" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">目前为止，介绍的分类例子都是二分类问题：神经网络输出层只有一个神经元，表示预测输出 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">ŷ</span>是正类的概率 <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">y</span> = 1|<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">x</span>)，<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">ŷ</span> &gt; 0.5 则判断为正类，反之判断为负类。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="07dce97e-1f7e-4759-8668-d56fd42e340c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">对于 <span class="notion-enable-hover" data-token-index="1" style="font-weight:600">多分类问题</span> ，用 C 表示种类个数，则神经网络输出层，也就是第 L 层的单元数量 <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">n</span>[<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">L</span>] = <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">C</span>。每个神经元的输出依次对应属于该类的概率，即 <span class="notion-enable-hover" data-token-index="10" style="font-style:italic">P</span>(<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">y</span> = <span class="notion-enable-hover" data-token-index="14" style="font-style:italic">c</span>|<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">x</span>), <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">c</span> = 0, 1, .., <span class="notion-enable-hover" data-token-index="20" style="font-style:italic">C</span> − 1。有一种 Logistic 回归的一般形式，叫做 <span class="notion-enable-hover" data-token-index="22" style="font-weight:600">Softmax 回归</span>，可以处理多分类问题。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6b042387-d233-4887-96ee-3c7b033d0442" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">对于 Softmax 回归模型的输出层，即第 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">l</span> 层，有： $$
z^{[l]} = w^{[l]}a^{[l-1]} + b^{[l]}\\
\hat y_i=a^{[l]}_i = \frac{e^{z^{[l]}_i}}{\sum^C_{i=1}e^{z^{[l]}_i}}
$$ SoftMax的损失函数$L(\hat y, y)=-\sum_{i=1}^C y_i\log\hat y_i$，如果设标记为1的项是<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">i</span>，由于只有正确的那项对应的<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">i</span>是1，于是<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">L</span>(<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">ŷ</span>, <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">y</span>) =  − log (<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">ŷ</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">i</span>)，整体损失函数$J(x,y)=-\frac1m \log(\hat y_i)$由此可以推导出关于<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">z</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">l</span>的偏导数: $$
\begin{aligned}
dL&amp;=-y^T\log(a)\\
&amp;=-y^T(z_l-\mathbb I\log[\mathbb I^T\exp(z_l)]) \ \ \ 第一个I^{n\times1}扩张标量来实现相加，第二个I实现求和\\
&amp;=-y^Tz_l + \log[\mathbb I^T \exp(z_l)]\ \ \ 注意y^TI=1\\
&amp;=-y^Tdz_l + \frac{\mathbb I^T[\exp(z_l)\odot d(z_l)]}{\mathbb I^T\exp(z_l)} \ \ \ 由I^T(u\odot v)=u^Tv\\
&amp;=\left(-y^T+\frac{\exp(z_l)^T}{\mathbb I^T\exp(z_l)}\right)dz_l \\
&amp;=\left(\frac{\exp(z_l)}{\mathbb I^T\exp(z_l)}-y\right)^Tdz_l\\
\frac{\partial L}{\partial z}&amp;=Softmax(z_l)-y
\end{aligned}
$$</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0feb3e5c-dab5-4dfc-a76c-659115bb1dba" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">参考资料：</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8bc7a598-1ea8-452d-acbf-75e3f61ee06c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1] Coursera Deeplearning.AI深度学习教程：https://www.coursera.org/specializations/deep-learning</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ab095472-da31-4492-992e-76931b95bd56" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[2] Why is Batch Normalization useful in Deep Neural Networks? https://towardsdatascience.com/batch-normalisation-in-deep-neural-network-ce65dd9e8dbf</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c92330a9-1fef-4b26-9280-42b84e21e379" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[3] Batch Normalization原理与实战 https://zhuanlan.zhihu.com/p/34879333</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6f4f65cd-39e1-4a64-a7a1-e4f89d77f57b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[4] Batch Normalization详解和momentum参数理解 https://blog.csdn.net/ygfrancois/article/details/90382459</div></div></div></div></div></div><div contenteditable="false" data-content-editable-void="true" style="width: 0px;"><div style="display: none; flex-shrink: 0; pointer-events: none; width: 0px; position: absolute; right: 192px; opacity: 0;"><div style="display: flex; flex-direction: column; padding: 5px 16px; width: 340px; flex-shrink: 0; height: 100%; position: relative; pointer-events: none; z-index: 1;"><div style="position: absolute; pointer-events: none; width: 100%; height: 100%; top: -5px; background: linear-gradient(white 0px, rgba(255, 255, 255, 0) 15px);"></div></div></div></div></main><span style="height: 1px; width: 1px;"></span></div><div class="notion-presence-container" style="position: absolute; top: 0px; left: 0px; z-index: 89;"><div></div></div></div></div></div><div class="notion-peek-renderer" style="position: fixed; top: 0px; right: 0px; bottom: 0px; width: 960px; z-index: 109; transform: translateX(960px) translateZ(0px);"></div></div></div></div></div><script src="1172e9111a5fb396bcb8a05870b5eabf8abf221c.js" type="text/javascript"></script><div style="width: env(safe-area-inset-bottom);"></div></body></html>