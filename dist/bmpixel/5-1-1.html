<html class="notion-html"><head lang="en"><meta charset="utf-8"/><meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"/><title>5.1.1. 循环神经网络结构</title><meta content="en_US" property="og:locale"/><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="/images/logo-ios.png" rel="apple-touch-icon"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="telephone=no" name="format-detection"/><meta content="no" name="msapplication-tap-highlight"/><link href="e218a1aef6df86309cb95b61e446888efa3b0379.css" media="print" rel="stylesheet"/><link href="e1d809d762eeca23edf0cb31bb17bf3c703085f5.css" rel="stylesheet"/><link href="ea336c780f905bf8e5199e24de64f0cf84362824.css" rel="stylesheet"/></head><body class="notion-body"><style>body{background:#fff}body.dark{background:#191919}@keyframes startup-shimmer-animation{0%{transform:translateX(-100%) translateZ(0)}100%{transform:translateX(100%) translateZ(0)}}@keyframes startup-shimmer-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes startup-spinner-rotate{0%{transform:rotate(0) translateZ(0)}100%{transform:rotate(360deg) translateZ(0)}}#initial-loading-spinner{position:fixed;height:100vh;width:100vw;z-index:-1;display:none;align-items:center;justify-content:center;opacity:.5}#initial-loading-spinner svg{height:24px;width:24px;animation:startup-spinner-rotate 1s linear infinite;transform-origin:center center;pointer-events:none}#skeleton{background:#fff;position:fixed;height:100vh;width:100vw;z-index:-1;display:none;overflow:hidden}#initial-loading-spinner.show,#skeleton.show{display:flex}body.dark #skeleton{background:#191919}.notion-front-page #skeleton,.notion-mobile #skeleton{display:none}#skeleton-sidebar{background-color:#fbfbfa;box-shadow:inset -1px 0 0 0 rgba(0,0,0,.025);display:flex;width:240px;flex-direction:column;padding:12px 14px;overflow:hidden}body.dark #skeleton-sidebar{background-color:#202020;box-shadow:inset -1px 0 0 0 rgba(255,255,255,.05)}#skeleton.isElectron #skeleton-sidebar{padding-top:46px}#skeleton .row{display:flex;margin-bottom:8px;align-items:center}#skeleton .row.fadein{animation:1s ease-in 0s 1 normal both running startup-shimmer-fade-in}#skeleton .chevron{width:12px;height:12px;display:block;margin-right:4px;fill:rgba(227,226,224,.5)}body.dark #skeleton .chevron{fill:#2f2f2f}.startup-shimmer{background:rgba(227,226,224,.5);overflow:hidden;position:relative}body.dark .startup-shimmer{background:#2f2f2f}.startup-shimmer::before{content:"";position:absolute;height:100%;width:100%;z-index:1;animation:1s linear infinite startup-shimmer-animation;background:linear-gradient(90deg,transparent 0,rgba(255,255,255,.4) 50%,transparent 100%)}body.dark .startup-shimmer::before{background:linear-gradient(90deg,transparent 0,rgba(86,86,86,.4) 50%,transparent 100%)}#skeleton .icon{width:20px;height:20px;border-radius:4px}#skeleton .text{height:10px;border-radius:10px}#skeleton .draggable{-webkit-app-region:drag;position:absolute;top:0;left:0;width:100%;height:36px;display:none}#skeleton.isElectron .draggable{display:block}</style><style id="scroll-properties">
			::-webkit-scrollbar {
				width: 10px;
				height: 10px;
			}
			::-webkit-scrollbar {
				background: transparent;
			}
			::-webkit-scrollbar-track {
				background: #EDECE9;
			}
			::-webkit-scrollbar-thumb {
				background:#D3D1CB;
			}
			::-webkit-scrollbar-thumb:hover {
				background:#AEACA6;
			}
		</style><div id="notion-app"><div class="notion-app-inner notion-light-theme" style='color: rgb(55, 53, 47); fill: currentcolor; line-height: 1.5; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; -webkit-font-smoothing: auto; background-color: white;'><div style="height: 100%;"><div class="notion-cursor-listener" style="width: 100vw; height: 100%; position: relative; display: flex; flex: 1 1 0%; background: white; cursor: text;"><div class="" style="display: flex; flex-direction: column; width: 100%; overflow: hidden;"><div style="max-width: 100vw; z-index: 100; background: white; user-select: none;"><div class="notion-topbar" style="width: 100%; max-width: 100vw; height: 45px; opacity: 1; transition: opacity 700ms ease 0s, color 700ms ease 0s; position: relative;"><div style="display: flex; justify-content: space-between; align-items: center; overflow: hidden; height: 45px; padding-left: 12px; padding-right: 10px;"><div class="notranslate shadow-cursor-breadcrumb" style="display: flex; align-items: center; line-height: 1.2; font-size: 14px; height: 100%; flex-grow: 0; margin-right: 8px; min-width: 0px;"><div class="notion-selectable notion-page-block" data-block-id="6f173729-5884-4d32-8452-4cbeea3e462c" style="display: flex; align-items: center; min-width: 0px;"><a href="index.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">BMPixel网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div class="notion-selectable notion-collection_view-block" data-block-id="27dbe900-3c41-4c13-bd5a-432418911021" style="display: flex; align-items: center; min-width: 0px;"><a href="27dbe9003c414c13bd5a432418911021.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 6px; padding-right: 6px; color: rgb(55, 53, 47);" tabindex="0"><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 240px;">5.1.1. 循环神经网络结构</div></div></div><div style="flex-grow: 1; flex-shrink: 1;"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="searchNew" style="width: 14px; height: 14px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 17 17"><path d="M6.78027 13.6729C8.24805 13.6729 9.60156 13.1982 10.709 12.4072L14.875 16.5732C15.0684 16.7666 15.3232 16.8633 15.5957 16.8633C16.167 16.8633 16.5713 16.4238 16.5713 15.8613C16.5713 15.5977 16.4834 15.3516 16.29 15.1582L12.1504 11.0098C13.0205 9.86719 13.5391 8.45215 13.5391 6.91406C13.5391 3.19629 10.498 0.155273 6.78027 0.155273C3.0625 0.155273 0.0214844 3.19629 0.0214844 6.91406C0.0214844 10.6318 3.0625 13.6729 6.78027 13.6729ZM6.78027 12.2139C3.87988 12.2139 1.48047 9.81445 1.48047 6.91406C1.48047 4.01367 3.87988 1.61426 6.78027 1.61426C9.68066 1.61426 12.0801 4.01367 12.0801 6.91406C12.0801 9.81445 9.68066 12.2139 6.78027 12.2139Z"></path></svg>Search</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0">Duplicate</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 32px; height: 28px; border-radius: 3px;" tabindex="0"><svg class="dots" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden;" viewBox="0 0 13 3"><g><path d="M3,1.5A1.5,1.5,0,1,1,1.5,0,1.5,1.5,0,0,1,3,1.5Z"></path><path d="M8,1.5A1.5,1.5,0,1,1,6.5,0,1.5,1.5,0,0,1,8,1.5Z"></path><path d="M13,1.5A1.5,1.5,0,1,1,11.5,0,1.5,1.5,0,0,1,13,1.5Z"></path></g></svg></div><div style="flex: 0 0 auto; width: 1px; height: 16px; margin-left: 8px; margin-right: 8px; background: rgba(55, 53, 47, 0.16);"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="notionLogo" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 120 126"><path d="M 20.6927 21.9315C 24.5836 25.0924 26.0432 24.8512 33.3492 24.3638L 102.228 20.2279C 103.689 20.2279 102.474 18.7705 101.987 18.5283L 90.5477 10.2586C 88.3558 8.55699 85.4356 6.60818 79.8387 7.09563L 13.1433 11.9602C 10.711 12.2014 10.2251 13.4175 11.1939 14.3924L 20.6927 21.9315ZM 24.8281 37.9835L 24.8281 110.456C 24.8281 114.351 26.7745 115.808 31.1553 115.567L 106.853 111.187C 111.236 110.946 111.724 108.267 111.724 105.103L 111.724 33.1169C 111.724 29.958 110.509 28.2544 107.826 28.4976L 28.721 33.1169C 25.8018 33.3622 24.8281 34.8225 24.8281 37.9835ZM 99.5567 41.8711C 100.042 44.0622 99.5567 46.2512 97.3618 46.4974L 93.7143 47.2241L 93.7143 100.728C 90.5477 102.43 87.6275 103.403 85.1942 103.403C 81.2983 103.403 80.3226 102.186 77.4044 98.54L 53.5471 61.087L 53.5471 97.3239L 61.0964 99.0275C 61.0964 99.0275 61.0964 103.403 55.0057 103.403L 38.2148 104.377C 37.727 103.403 38.2148 100.973 39.9179 100.486L 44.2996 99.2717L 44.2996 51.36L 38.2158 50.8725C 37.728 48.6815 38.9431 45.5225 42.3532 45.2773L 60.3661 44.0631L 85.1942 82.0036L 85.1942 48.4402L 78.864 47.7136C 78.3781 45.0351 80.3226 43.0902 82.7569 42.849L 99.5567 41.8711ZM 7.5434 5.39404L 76.9175 0.285276C 85.4366 -0.445402 87.6285 0.0440428 92.983 3.93368L 115.128 19.4982C 118.782 22.1747 120 22.9034 120 25.8211L 120 111.187C 120 116.537 118.051 119.701 111.237 120.185L 30.6734 125.05C 25.5584 125.294 23.124 124.565 20.4453 121.158L 4.13735 99.9994C 1.21516 96.1048 0 93.191 0 89.7819L 0 13.903C 0 9.5279 1.94945 5.8785 7.5434 5.39404Z"></path></svg>Try Notion</div></div></div><div style="width: calc(100% - 0px); user-select: none;"></div></div><div class="notion-frame" style="flex-grow: 0; flex-shrink: 1; display: flex; flex-direction: column; background: white; z-index: 1; height: calc(100vh - 45px); max-height: 100%; position: relative; width: 1920px;"><div class="notion-scroller vertical" style="display: flex; flex-direction: column; z-index: 1; flex-grow: 1; position: relative; align-items: center; margin-right: 0px; margin-bottom: 0px; overflow: hidden auto;"><div style="position: absolute; top: 0px; left: 0px;"><div></div></div><div class="whenContentEditable" data-content-editable-root="true" style="caret-color: rgb(55, 53, 47); width: 100%; display: flex; flex-direction: column; position: relative; align-items: center; flex-grow: 1; --whenContentEditable--WebkitUserModify:read-write-plaintext-only;"><span style="height: 1px; width: 1px;"></span><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0; z-index: 2;"><div style="position: relative; width: 100%; display: flex; flex-direction: column; align-items: center; height: 30vh; cursor: default;"><div style="width: 100%; cursor: inherit;"><div style="display: grid; width: 100%; height: 30vh;"><div style="grid-area: 1 / 1 / auto / auto; width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="26bba396360daa076062e0b17fc87ed253194649.jpg" style="display: block; object-fit: cover; border-radius: 0px; width: 100%; height: 30vh; opacity: 1; object-position: center 50%;"/></div></div></div><div aria-hidden="true" style='background: rgba(0, 0, 0, 0.4); border-radius: 3px; color: white; font-size: 12px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; width: 180px; left: calc(50% - 90px); padding: 0.3em 1.5em; pointer-events: none; position: absolute; top: calc(50% - 10px); text-align: center; opacity: 0;'>Drag image to reposition</div></div></div><div style="width: 100%; display: flex; justify-content: center; z-index: 3; flex-shrink: 0;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div style="max-width: 100%; padding-left: calc(96px + env(safe-area-inset-left)); width: 100%;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; pointer-events: none;"><div class="notion-page-controls" style='display: flex; justify-content: flex-start; flex-wrap: wrap; margin-top: 16px; margin-bottom: 4px; margin-left: -1px; color: rgba(55, 53, 47, 0.5); font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; height: 24px; pointer-events: auto;'></div></div><div style="padding-right: calc(96px + env(safe-area-inset-right));"><div><div class="notion-selectable notion-page-block" data-block-id="63beddf3-1683-4a44-9199-b9bbc540cc8c" style='color: rgb(55, 53, 47); font-weight: 700; line-height: 1.2; font-size: 40px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; cursor: text; display: flex; align-items: center;'><div contenteditable="false" data-content-editable-leaf="true" placeholder="Untitled" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">5.1.1. 循环神经网络结构</div></div><div style="margin-left: 4px;"></div></div></div></div></div><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div contenteditable="false" data-content-editable-void="true" style="padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right)); max-width: 100%; width: 100%;"><div style="width: 100%; font-size: 14px;"><div style="width: 100%; max-width: 100%; padding: 8px 0px; margin: 0px auto;"><div style="width: 100%; max-width: 100%; padding-top: 8px; margin: 0px auto;"><div style="padding-bottom: 8px;"><div style="margin: 0px;"></div></div></div></div></div><div style="width: 100%; height: 1px; background: rgba(55, 53, 47, 0.09); margin-bottom: 8px;"></div></div></div></div></div><main style="display: flex; width: 100%; justify-content: center; padding-top: 5px;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div class="notion-page-content" style="flex-shrink: 0; flex-grow: 1; max-width: 100%; display: flex; align-items: flex-start; flex-direction: column; font-size: 16px; line-height: 1.5; width: 100%; z-index: 4; padding-bottom: 30vh; padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right));"><div class="notion-selectable notion-header-block" data-block-id="c96be8c7-bb48-4b33-8970-4896b2373ed0" style="width: 100%; max-width: 1718px; margin-top: 2em; margin-bottom: 4px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 1" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.875em; line-height: 1.3;'>循环神经网络结构</div></div></div><div class="notion-selectable notion-text-block" data-block-id="20da866c-4f6a-4bf1-99a4-7f407d25add3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们之前了解到，循环神经网络尤其适合长序列处理任务，在每一个时间刻的隐藏层单元中都储藏着之前所有时间的输入信息。理论上我们的隐藏层是由所有的时刻的输入信息共同决定的，应该能够代表过去的所有信息，但是很明显的是隐藏层的大小是固定的，不能储存无限多的信息。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a06d7898-c039-4186-807e-ca61325aa071" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">当我们处理的序列十分长的时候，在序列后段的隐藏层一定会被迫丢弃某些信息。实践显示，这种信息的丢失主要体现于对较早片段信息的遗忘，这种遗忘会使我们的网络在处理<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">长期依赖</span>问题时表现变的不理想。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3bda9eb0-8d9d-4d05-97d6-ad188d882ae3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">什么是长期依赖呢，下面两句话可以直观的表现这一点：</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a8bb086a-2d52-4138-a6c8-c2122e59320e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">The cat, which already ate a bunch of food, was full.</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3a04a90e-2eec-48cc-863e-7d3f7cf53aa9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">The cat, which already ate a bunch of food, were full.</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c32fd201-2111-4d92-8081-ec5103465838" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">对于上面两句话，中学的英语老师告诉我们第二句是错误的，因为“cat”作为单数主语应该使用系动词“was”而不是“were”。人类想要解决这一类问题非常的容易，但是对于一个RNN而言，想要它在看到句子最末尾的谓语时还记得前面的主语形式着实有一点难度。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="7eb2d877-4f36-4c8d-b0c4-02b934a78ddd" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">和长期依赖难题一起出现的还有之前我们了解的循环神经网络中的梯度消失现象。这两个问题都是由于序列前端和序列后段之间的沟通不够顺畅造成的，那么很自然我们会想到在序列之间相隔较远的地方可以通过架起一个无损的沟通捷径来解决这个问题，因此接下来让我们了解一下使用<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">门控循环单元</span>的循环神经网络。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="8118f31b-1dbb-4ae3-a92d-7a6c9f74d863" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>门控循环单元（Gated Recurrent Unit，GRU）</div></div></div><div class="notion-selectable notion-text-block" data-block-id="9a8a244d-9226-418a-bc0c-77a55804d392" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们先回顾一下标准RNN的隐藏层单元的运行方式：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="e41f944e-1a5b-4a2c-983e-2dd0a19eadf7" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="ad42a8549d4024b01f7b8c666702e39837374e0c.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6623a01b-2877-4f71-8484-6c13255d1d27" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们之前说希望可以让序列的前端和后端更好的沟通，而我们现在使用的隐藏层<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">t</span>⟩显然太过繁重，重重变换以后很难再依然承载最开始的信息。因此我们添加一个<span class="notion-enable-hover" data-token-index="6" style="font-weight:600">记忆单元（Memory Cell）</span><span class="notion-enable-hover" data-token-index="7" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">t</span>⟩来储存长距离沟通需要的信息，我们先令这个单元像<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">t</span>⟩一样工作： <span class="notion-enable-hover" data-token-index="17" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="19" style="font-style:italic">t</span>⟩ = tanh (<span class="notion-enable-hover" data-token-index="22" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">c</span>[<span class="notion-enable-hover" data-token-index="25" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">t</span> − 1⟩, <span class="notion-enable-hover" data-token-index="30" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="32" style="font-style:italic">t</span>⟩] + <span class="notion-enable-hover" data-token-index="35" style="font-style:italic">b</span><span class="notion-enable-hover" data-token-index="36" style="font-style:italic">c</span>) 这里的<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="40" style="font-style:italic">c</span>[<span class="notion-enable-hover" data-token-index="42" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="44" style="font-style:italic">t</span> − 1⟩, <span class="notion-enable-hover" data-token-index="47" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="49" style="font-style:italic">t</span>⟩]表示将<span class="notion-enable-hover" data-token-index="52" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="54" style="font-style:italic">t</span> − 1⟩, <span class="notion-enable-hover" data-token-index="57" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="59" style="font-style:italic">t</span>⟩拼接以后运用矩阵乘法，这和分开写<span class="notion-enable-hover" data-token-index="62" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="63" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="64" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="65" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="67" style="font-style:italic">t</span> − 1⟩ + <span class="notion-enable-hover" data-token-index="70" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="71" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="72" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="73" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="75" style="font-style:italic">t</span>⟩是完全等价的。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0dfcbeb6-3209-4460-ba32-2e150fcca32f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这个单元可是被我们给予厚望，我们不希望每经过一个单元都要像改变<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">t</span>⟩一样改变它，于是我们希望给算法一个是否要更新<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">t</span> − 1⟩的选择，这个“选择”我们就通过引入一个<span class="notion-enable-hover" data-token-index="11" style="font-weight:600">更新门</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic;font-weight:600">Γ</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic;font-weight:600">u</span>来使得网络可以实现自主选择的能力，最终我们这样设计： $$
\begin{align}
\tilde c^{⟨t⟩} &amp;= \tanh(W_c[c^{⟨t-1⟩}, x^{⟨t⟩}] + b_c)\\
\Gamma_u &amp;= \sigma(W_u[c^{⟨t-1⟩}, x^{⟨t⟩}] + b_u)\\
c^{⟨t⟩} &amp;= \Gamma_u \odot \tilde c^{⟨t⟩} + (1 - \Gamma_u) \odot c^{⟨t-1⟩}
\end{align}
$$ 可以看到，我们不急着更新<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="19" style="font-style:italic">t</span> − 1⟩，我们记新得到的<span class="notion-enable-hover" data-token-index="22" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">t</span>⟩为<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">c̃</span>⟨<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">t</span>⟩，通过我们的更新门的大小来选择要让多少的<span class="notion-enable-hover" data-token-index="32" style="font-style:italic">c̃</span>⟨<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">t</span>⟩进入<span class="notion-enable-hover" data-token-index="37" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">t</span>⟩。当然，由于我们只需要令更新门中的几个元素始终为1，这部分元素就可以起到和原先<span class="notion-enable-hover" data-token-index="42" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="44" style="font-style:italic">t</span>⟩一样的作用，于是在GRU网络中我们实际上并没有设置<span class="notion-enable-hover" data-token-index="47" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="49" style="font-style:italic">t</span>⟩，我们令<span class="notion-enable-hover" data-token-index="52" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="54" style="font-style:italic">t</span>⟩ = <span class="notion-enable-hover" data-token-index="57" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="59" style="font-style:italic">t</span>⟩。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="55000edc-df17-4450-808c-f250467889b2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在GRU的最终实现中，我们还引入了一个<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">重置门（Reset Gate）</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">Γ</span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic">r</span>。有时候我们的决策只需根据现有的输入就可以完成，这时掺和事的<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">t</span> − 1⟩就很烦人，于是我们希望网络可以在某些时间刻计算<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">c̃</span>⟨<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">t</span>⟩的时候忘记<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">t</span> − 1⟩，仅依靠<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="22" style="font-style:italic">t</span>⟩进行计算。我们这样赋予网络这个能力： $$  $$ 最终我们的GRU网络单元就是下图这个样子：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="8f9cf9f2-83c8-4f9e-a157-6b54e14167cc" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="069bbba8e6990ccb280b4a5bc26d605b152098ec.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f49d98e7-0902-4089-887e-0d8a921c2976" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1a0ea6ee-84f5-4e7a-8d8f-d9a8deaf2e10</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="fe1777c0-dbc9-4e21-9b4e-152f5048f68b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">字母有些不同，不过差不多得了。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="99ebb3d4-1379-4b40-b4a2-c565df6a1748" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>LSTM（Long Short Term Memory）网络</div></div></div><div class="notion-selectable notion-text-block" data-block-id="f108f766-9f52-4c40-9343-4b61487afb4e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">LSTM（Long Short Term Memory，长短期记忆）</span> 网络比 GRU 更加灵活和强大。先要注意的是，虽然它更加强大，但是它提出的时间远早于GRU网络（2014），甚至早于我们之前教程中讲的大多数算法（它提出于1997年！）</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="acc269c8-42ec-425c-83fd-aea5ab96ed71" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">相对于GRU网络，它额外引入了<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">遗忘门（Forget Gate）</span>和<span class="notion-enable-hover" data-token-index="3" style="font-weight:600">输出门（Output Gate）</span>。具体迭代如下： $$
\begin{align}
\tilde c ^{⟨t⟩}&amp;=\tanh(W_c[a^{⟨t-1⟩},x^{⟨t⟩}]+b_c)\\
\Gamma_u &amp;= \sigma(W_u[a^{⟨t-1⟩}, x^{⟨t⟩}]+b_u)\\
\Gamma_f &amp;= \sigma(W_f[a^{⟨t-1⟩}, x^{⟨t⟩}]+b_f)\\
\Gamma_o&amp;=\sigma(W_o[a^{⟨t-1⟩},x^{⟨t⟩}]+b_o)\\
c^{⟨t⟩} &amp;= \Gamma_u \odot\tilde c^{⟨t⟩}+\Gamma_f\odot c^{⟨t-1⟩}\\
a^{⟨t⟩} &amp;= \Gamma_o \odot \tanh(c^{⟨t⟩})
\end{align}
$$ 其中，<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">Γ</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">u</span>决定有哪些<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">t</span>⟩将要被更新，<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">Γ</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">f</span>决定有哪些<span class="notion-enable-hover" data-token-index="18" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">t</span>⟩将要被遗忘，<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">Γ</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">o</span>决定有哪些<span class="notion-enable-hover" data-token-index="26" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="28" style="font-style:italic">t</span>⟩将要被输入<span class="notion-enable-hover" data-token-index="31" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="33" style="font-style:italic">t</span>⟩进入下一单元，一个完整的隐藏层单元就如下图所示：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="300ea0dc-91cf-4cc3-bc23-b09542b21bd7" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="5e9050aa63ff267af5083b25445d9f0b950ba50e.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a548c168-383f-4c0d-a0ac-b28c86ea92b3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们注意到，LSTM和我们之前了解到GRU有着一些差异：</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="4d0af910-524a-4265-9dcf-8d25fb0f06a9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">LSTM中<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">c</span>被遗忘的强度是由一个遗忘门单独控制的，而在GRU中我们使用1 − <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">Γ</span>。</div></div><div class="notion-selectable notion-text-block" data-block-id="849c426b-ecba-4c13-9f71-311037ebbcf4" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span> − 1⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="cfd727f3-9f51-4291-ad9d-eba06a651e99" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">u</span></div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="89fdb361-6617-44a8-8b16-ae5655218e43" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">LSTM中没有把<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">a</span>和<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">c</span>合并在一起，它们通过<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">a</span> = <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">Γ</span> ⊙ tanh (<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">c</span>)区分开。</div></div><div class="notion-selectable notion-text-block" data-block-id="9195113d-8fe5-4788-8d26-537ea3a68505" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="30160eae-3d11-4f14-9197-bf2dea7c39a8" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f87eb0d6-8a9b-4d4e-862e-0bf83131c454" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="300ea87b-d829-4840-a19d-43bb7b9549ee" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">o</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="5a0f6730-8624-48df-9803-02d35ef57049" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a4977b10-0fa7-4fb1-b480-34000b433ff9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">把使用LSTM单元或者说GRU单元，我们之前遇到的梯度消失问题和长期依赖问题就可以很好的解决了。我们希望信息可以传递很长距离的时候，网络就可以通过调整遗忘门和记忆门的大小来实现把<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">t</span>⟩原封不动的传递到远方去；那我们如何解决梯度消失问题呢？首先看我们在不引入<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">t</span>⟩时的梯度计算，这里只考虑<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">L</span>⟨<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">x</span>⟩对$\frac{\partial a^{⟨1⟩}}{\partial W}$，的影响，并且请不要太在乎$\frac{\partial a}{\partial W}$的具体含义： $$
\frac{\partial L^{⟨T_x⟩}}{\partial W} = \frac{\partial L^{⟨T_x⟩}}{\partial a^{⟨T_x⟩}}\left(\prod_{t=2}^{T_x}\frac{\partial a^{⟨t⟩} }{\partial a^{⟨t-1⟩}}\right)\frac{\partial a^{⟨1⟩}}{\partial W}
$$ 我们知道<span class="notion-enable-hover" data-token-index="19" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="21" style="font-style:italic">t</span>⟩ = tanh (<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="25" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">t</span> − 1⟩ + <span class="notion-enable-hover" data-token-index="32" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="33" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="34" style="font-style:italic">x</span><span class="notion-enable-hover" data-token-index="35" style="font-style:italic">x</span>⟨<span class="notion-enable-hover" data-token-index="37" style="font-style:italic">t</span> − 1⟩ + <span class="notion-enable-hover" data-token-index="40" style="font-style:italic">b</span><span class="notion-enable-hover" data-token-index="41" style="font-style:italic">a</span>)，可以得到偏导数： $$
\frac{\partial a^{⟨t⟩} }{\partial a^{⟨t-1⟩}}=(\tanh'(W_{aa}a^{⟨t-1⟩}+W_{ax}x^{⟨t-1⟩}+b_a)\odot W_{aa})^T
$$ 于是我们知道梯度消失和梯度爆炸取决于$\frac{\partial a^{⟨t⟩} }{\partial a^{⟨t-1⟩}}$的大小，由于tanh ′(<span class="notion-enable-hover" data-token-index="45" style="font-style:italic">x</span>) &lt; 1，我们的网络天然有梯度消失的倾向，实践中梯度消失通常相对于梯度爆炸是更为严重的问题。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="4838f1c1-fdb4-4b5b-814e-54c9f9cce22d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">而引入了LSTM后我们的梯度消失问题得到了怎样的缓解呢？首先看我们的偏导数： $$
\frac{\partial L^{⟨T_x⟩}}{\partial W} = \frac{\partial L^{⟨T_x⟩}}{\partial a^{⟨T_x⟩}}\frac{\partial a^{⟨T_x⟩}}{\partial c^{⟨T_x⟩}}\left(\prod_{t=2}^{T_x}\frac{\partial c^{⟨t⟩} }{\partial c^{⟨t-1⟩}}\right)\frac{\partial c^{⟨1⟩}}{\partial W}
$$ 同样的，由于<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">t</span>⟩ = <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">Γ</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">f</span> ⊙ <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">c</span>⟨<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">t</span> − 1⟩ + <span class="notion-enable-hover" data-token-index="16" style="font-style:italic">Γ</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">u</span> ⊙ <span class="notion-enable-hover" data-token-index="19" style="font-style:italic">c̃</span>⟨<span class="notion-enable-hover" data-token-index="21" style="font-style:italic">t</span>⟩，我们可以计算出对应的偏导数： $$
\begin{align}
\frac{\partial c^{⟨t⟩}}{\partial c^{⟨t-1⟩}}=&amp;\sigma'(W_f[a^{⟨t-1⟩},x^{⟨t⟩}])W_f\odot \Gamma_o \tanh'(c^{⟨t-1⟩})c^{⟨t-1⟩}\\
&amp;+F_f\\
&amp;+\sigma'(W_u[a^{⟨t-1⟩},x^{⟨t⟩}])W_u\odot\Gamma_o \tanh'(c^{⟨t-1⟩})\tilde c^{⟨t⟩}\\
&amp;+\sigma'(W_c[a^{⟨t-1⟩},x^{⟨t⟩}])W_c\odot\Gamma_o \tanh'(c^{⟨t-1⟩})\Gamma_u
\end{align}
$$ 第二项揭示了阻止梯度消失的秘密。当我们希望能够一直保留信息时网络会设置<span class="notion-enable-hover" data-token-index="26" style="font-style:italic">F</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">f</span> = <span class="notion-enable-hover" data-token-index="29" style="font-weight:600">1</span>，这时我们的$\frac{\partial c^{⟨t⟩}}{\partial c^{⟨t-1⟩}}\approx1$，则$\prod_{t=2}^{T_x}\frac{\partial c^{⟨t⟩} }{\partial c^{⟨t-1⟩}}\approx 1$。梯度消失的问题就解决了。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="54cd533f-8faf-46b7-9f56-7d6960d564b1" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>双向循环神经网络</div></div></div><div class="notion-selectable notion-text-block" data-block-id="729e4bb3-6c32-4e98-bcba-f2d4a841e434" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">单向的循环神经网络在某一时刻的预测结果只能利用到之前输入的序列信息。<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">双向循环神经网络(Bidirectional RNN，BRNN)</span> 则可以在序列的任意位置使用之前和之后的数据。我们只需要简单修改原有的普通RNN就可以得到一个双向RNN。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="110261aa-8b65-4b44-a6b7-358593685c16" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="2697552aa5ae5d80ea0fa8446a72edce2e841bcd.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a2f11817-b96f-4c7d-ba34-05b14dc259b8" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1*6QnPUSv_t9BY9Fv8_aLb-Q</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="00923f22-d9e8-466c-a0f3-4e1dc192f246" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们在不输出<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">ŷ</span>的情况下先正向反向均运行一次，得到两个<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">a</span>⟨<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">t</span>⟩向量的序列<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">a</span> → ⟨<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">t</span>⟩, <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">a</span> ← ⟨<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">t</span>⟩。之后我们在计算<span class="notion-enable-hover" data-token-index="18" style="font-style:italic">ŷ</span>⟨<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">t</span>⟩时综合两个方向的隐藏层在该单元上的值即可。 <span class="notion-enable-hover" data-token-index="23" style="font-style:italic">ŷ</span>⟨<span class="notion-enable-hover" data-token-index="25" style="font-style:italic">t</span>⟩ = <span class="notion-enable-hover" data-token-index="28" style="font-style:italic">g</span>(<span class="notion-enable-hover" data-token-index="30" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="31" style="font-style:italic">y</span>[<span class="notion-enable-hover" data-token-index="33" style="font-style:italic">a</span> → ⟨<span class="notion-enable-hover" data-token-index="35" style="font-style:italic">t</span>⟩, <span class="notion-enable-hover" data-token-index="38" style="font-style:italic">a</span> ← ⟨<span class="notion-enable-hover" data-token-index="40" style="font-style:italic">t</span>⟩] + <span class="notion-enable-hover" data-token-index="43" style="font-style:italic">b</span><span class="notion-enable-hover" data-token-index="44" style="font-style:italic">y</span>)</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c7052916-0c75-4b9a-a85a-5b8b10d1df77" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这就是双向循环神经网络，这些基本单元不一定得是标准RNN单元，也可以是GRU单元或者LSTM单元。事实上，很多的NLP问题，尤其是对于大量有自然语言文本段落的问题，使用LSTM单元的双向RNN模型是用的最多的。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="dbcd2474-ac17-482f-864d-619151d89a81" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">参考资料：</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e9e3c7c9-164a-4de4-805d-303b7ccedf05" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1] Coursera Deeplearning.AI深度学习教程：https://www.coursera.org/specializations/deep-learning</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a969bd55-2b30-434e-a763-a1642d98e58e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[2] Junyoung Chung et.al Empirical Evaluation of Gated Recurrent Neural Networks on Sequence Modeling</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="2dea8eaf-c73a-4958-983a-f6075f52e572" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[3] The Exploding and Vanishing Gradients Problem in Time Series https://towardsdatascience.com/the-exploding-and-vanishing-gradients-problem-in-time-series-6b87d558d22</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3852cfab-5496-4d51-a3e7-4bb6532bc08a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[4] How LSTM networks solve the problem of vanishing gradients https://medium.datadriveninvestor.com/how-do-lstm-networks-solve-the-problem-of-vanishing-gradients-a6784971a577</div></div></div></div></div></div><div contenteditable="false" data-content-editable-void="true" style="width: 0px;"><div style="display: none; flex-shrink: 0; pointer-events: none; width: 0px; position: absolute; right: 192px; opacity: 0;"><div style="display: flex; flex-direction: column; padding: 5px 16px; width: 340px; flex-shrink: 0; height: 100%; position: relative; pointer-events: none; z-index: 1;"><div style="position: absolute; pointer-events: none; width: 100%; height: 100%; top: -5px; background: linear-gradient(white 0px, rgba(255, 255, 255, 0) 15px);"></div></div></div></div></main><span style="height: 1px; width: 1px;"></span></div><div class="notion-presence-container" style="position: absolute; top: 0px; left: 0px; z-index: 89;"><div></div></div></div></div></div><div class="notion-peek-renderer" style="position: fixed; top: 0px; right: 0px; bottom: 0px; width: 960px; z-index: 109; transform: translateX(960px) translateZ(0px);"></div></div></div></div></div><script src="1172e9111a5fb396bcb8a05870b5eabf8abf221c.js" type="text/javascript"></script><div style="width: env(safe-area-inset-bottom);"></div></body></html>