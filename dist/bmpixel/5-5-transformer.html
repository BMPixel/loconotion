<html class="notion-html"><head lang="en"><meta charset="utf-8"/><meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"/><title>5.5.Transformer网络</title><meta content="en_US" property="og:locale"/><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="/images/logo-ios.png" rel="apple-touch-icon"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="telephone=no" name="format-detection"/><meta content="no" name="msapplication-tap-highlight"/><link href="e218a1aef6df86309cb95b61e446888efa3b0379.css" media="print" rel="stylesheet"/><link href="e1d809d762eeca23edf0cb31bb17bf3c703085f5.css" rel="stylesheet"/><link href="87cb8054003093194fca9e8b417296018cbffb68.css" rel="stylesheet"/></head><body class="notion-body"><style>body{background:#fff}body.dark{background:#191919}@keyframes startup-shimmer-animation{0%{transform:translateX(-100%) translateZ(0)}100%{transform:translateX(100%) translateZ(0)}}@keyframes startup-shimmer-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes startup-spinner-rotate{0%{transform:rotate(0) translateZ(0)}100%{transform:rotate(360deg) translateZ(0)}}#initial-loading-spinner{position:fixed;height:100vh;width:100vw;z-index:-1;display:none;align-items:center;justify-content:center;opacity:.5}#initial-loading-spinner svg{height:24px;width:24px;animation:startup-spinner-rotate 1s linear infinite;transform-origin:center center;pointer-events:none}#skeleton{background:#fff;position:fixed;height:100vh;width:100vw;z-index:-1;display:none;overflow:hidden}#initial-loading-spinner.show,#skeleton.show{display:flex}body.dark #skeleton{background:#191919}.notion-front-page #skeleton,.notion-mobile #skeleton{display:none}#skeleton-sidebar{background-color:#fbfbfa;box-shadow:inset -1px 0 0 0 rgba(0,0,0,.025);display:flex;width:240px;flex-direction:column;padding:12px 14px;overflow:hidden}body.dark #skeleton-sidebar{background-color:#202020;box-shadow:inset -1px 0 0 0 rgba(255,255,255,.05)}#skeleton.isElectron #skeleton-sidebar{padding-top:46px}#skeleton .row{display:flex;margin-bottom:8px;align-items:center}#skeleton .row.fadein{animation:1s ease-in 0s 1 normal both running startup-shimmer-fade-in}#skeleton .chevron{width:12px;height:12px;display:block;margin-right:4px;fill:rgba(227,226,224,.5)}body.dark #skeleton .chevron{fill:#2f2f2f}.startup-shimmer{background:rgba(227,226,224,.5);overflow:hidden;position:relative}body.dark .startup-shimmer{background:#2f2f2f}.startup-shimmer::before{content:"";position:absolute;height:100%;width:100%;z-index:1;animation:1s linear infinite startup-shimmer-animation;background:linear-gradient(90deg,transparent 0,rgba(255,255,255,.4) 50%,transparent 100%)}body.dark .startup-shimmer::before{background:linear-gradient(90deg,transparent 0,rgba(86,86,86,.4) 50%,transparent 100%)}#skeleton .icon{width:20px;height:20px;border-radius:4px}#skeleton .text{height:10px;border-radius:10px}#skeleton .draggable{-webkit-app-region:drag;position:absolute;top:0;left:0;width:100%;height:36px;display:none}#skeleton.isElectron .draggable{display:block}</style><style id="scroll-properties">
			::-webkit-scrollbar {
				width: 10px;
				height: 10px;
			}
			::-webkit-scrollbar {
				background: transparent;
			}
			::-webkit-scrollbar-track {
				background: #EDECE9;
			}
			::-webkit-scrollbar-thumb {
				background:#D3D1CB;
			}
			::-webkit-scrollbar-thumb:hover {
				background:#AEACA6;
			}
		</style><div id="notion-app"><div class="notion-app-inner notion-light-theme" style='color: rgb(55, 53, 47); fill: currentcolor; line-height: 1.5; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; -webkit-font-smoothing: auto; background-color: white;'><div style="height: 100%;"><div class="notion-cursor-listener" style="width: 100vw; height: 100%; position: relative; display: flex; flex: 1 1 0%; background: white; cursor: text;"><div class="" style="display: flex; flex-direction: column; width: 100%; overflow: hidden;"><div style="max-width: 100vw; z-index: 100; background: white; user-select: none;"><div class="notion-topbar" style="width: 100%; max-width: 100vw; height: 45px; opacity: 1; transition: opacity 700ms ease 0s, color 700ms ease 0s; position: relative;"><div style="display: flex; justify-content: space-between; align-items: center; overflow: hidden; height: 45px; padding-left: 12px; padding-right: 10px;"><div class="notranslate shadow-cursor-breadcrumb" style="display: flex; align-items: center; line-height: 1.2; font-size: 14px; height: 100%; flex-grow: 0; margin-right: 8px; min-width: 0px;"><div class="notion-selectable notion-page-block" data-block-id="6f173729-5884-4d32-8452-4cbeea3e462c" style="display: flex; align-items: center; min-width: 0px;"><a href="index.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">BMPixel网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div class="notion-selectable notion-collection_view-block" data-block-id="27dbe900-3c41-4c13-bd5a-432418911021" style="display: flex; align-items: center; min-width: 0px;"><a href="27dbe9003c414c13bd5a432418911021.html" rel="noopener noreferrer" style="display: flex; color: rgb(55, 53, 47); text-decoration: none; user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: inherit; line-height: 1.2; min-width: 0px; padding: 2px;"><div style="display: flex; align-items: center; min-width: 0px;"><div class="notion-record-icon notranslate" style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px; border-radius: 0.25em; flex-shrink: 0; margin-right: 6px; font-weight: 500;"><div style="display: flex; align-items: center; justify-content: center; height: 20px; width: 20px;"><div style="height: 14px; width: 14px; font-size: 14px; line-height: 1; margin-left: 0px; color: black;"><img alt="🌃" aria-label="🌃" class="notion-emoji" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="width: 100%;
height: 100%;
background: url(f87457017f44d1d87f6d662556796277387c1c28.png) 8.47458% 11.8644%/6000% 6000%"/></div></div></div><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px;">网络日志</div></div></a></div><span style="margin-left: 2px; margin-right: 2px; color: rgba(55, 53, 47, 0.5);">/</span><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 1; white-space: nowrap; height: 24px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 6px; padding-right: 6px; color: rgb(55, 53, 47);" tabindex="0"><div class="notranslate" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 240px;">5.5.Transformer网络</div></div></div><div style="flex-grow: 1; flex-shrink: 1;"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="searchNew" style="width: 14px; height: 14px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 17 17"><path d="M6.78027 13.6729C8.24805 13.6729 9.60156 13.1982 10.709 12.4072L14.875 16.5732C15.0684 16.7666 15.3232 16.8633 15.5957 16.8633C16.167 16.8633 16.5713 16.4238 16.5713 15.8613C16.5713 15.5977 16.4834 15.3516 16.29 15.1582L12.1504 11.0098C13.0205 9.86719 13.5391 8.45215 13.5391 6.91406C13.5391 3.19629 10.498 0.155273 6.78027 0.155273C3.0625 0.155273 0.0214844 3.19629 0.0214844 6.91406C0.0214844 10.6318 3.0625 13.6729 6.78027 13.6729ZM6.78027 12.2139C3.87988 12.2139 1.48047 9.81445 1.48047 6.91406C1.48047 4.01367 3.87988 1.61426 6.78027 1.61426C9.68066 1.61426 12.0801 4.01367 12.0801 6.91406C12.0801 9.81445 9.68066 12.2139 6.78027 12.2139Z"></path></svg>Search</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0">Duplicate</div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 32px; height: 28px; border-radius: 3px;" tabindex="0"><svg class="dots" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden;" viewBox="0 0 13 3"><g><path d="M3,1.5A1.5,1.5,0,1,1,1.5,0,1.5,1.5,0,0,1,3,1.5Z"></path><path d="M8,1.5A1.5,1.5,0,1,1,6.5,0,1.5,1.5,0,0,1,8,1.5Z"></path><path d="M13,1.5A1.5,1.5,0,1,1,11.5,0,1.5,1.5,0,0,1,13,1.5Z"></path></g></svg></div><div style="flex: 0 0 auto; width: 1px; height: 16px; margin-left: 8px; margin-right: 8px; background: rgba(55, 53, 47, 0.16);"></div><div role="button" style="user-select: none; transition: background 20ms ease-in 0s; cursor: pointer; display: inline-flex; align-items: center; flex-shrink: 0; white-space: nowrap; height: 28px; border-radius: 4px; font-size: 14px; line-height: 1.2; min-width: 0px; padding-left: 8px; padding-right: 8px; color: rgb(55, 53, 47);" tabindex="0"><svg class="notionLogo" style="width: 18px; height: 18px; display: block; fill: inherit; flex-shrink: 0; backface-visibility: hidden; margin-right: 6px;" viewBox="0 0 120 126"><path d="M 20.6927 21.9315C 24.5836 25.0924 26.0432 24.8512 33.3492 24.3638L 102.228 20.2279C 103.689 20.2279 102.474 18.7705 101.987 18.5283L 90.5477 10.2586C 88.3558 8.55699 85.4356 6.60818 79.8387 7.09563L 13.1433 11.9602C 10.711 12.2014 10.2251 13.4175 11.1939 14.3924L 20.6927 21.9315ZM 24.8281 37.9835L 24.8281 110.456C 24.8281 114.351 26.7745 115.808 31.1553 115.567L 106.853 111.187C 111.236 110.946 111.724 108.267 111.724 105.103L 111.724 33.1169C 111.724 29.958 110.509 28.2544 107.826 28.4976L 28.721 33.1169C 25.8018 33.3622 24.8281 34.8225 24.8281 37.9835ZM 99.5567 41.8711C 100.042 44.0622 99.5567 46.2512 97.3618 46.4974L 93.7143 47.2241L 93.7143 100.728C 90.5477 102.43 87.6275 103.403 85.1942 103.403C 81.2983 103.403 80.3226 102.186 77.4044 98.54L 53.5471 61.087L 53.5471 97.3239L 61.0964 99.0275C 61.0964 99.0275 61.0964 103.403 55.0057 103.403L 38.2148 104.377C 37.727 103.403 38.2148 100.973 39.9179 100.486L 44.2996 99.2717L 44.2996 51.36L 38.2158 50.8725C 37.728 48.6815 38.9431 45.5225 42.3532 45.2773L 60.3661 44.0631L 85.1942 82.0036L 85.1942 48.4402L 78.864 47.7136C 78.3781 45.0351 80.3226 43.0902 82.7569 42.849L 99.5567 41.8711ZM 7.5434 5.39404L 76.9175 0.285276C 85.4366 -0.445402 87.6285 0.0440428 92.983 3.93368L 115.128 19.4982C 118.782 22.1747 120 22.9034 120 25.8211L 120 111.187C 120 116.537 118.051 119.701 111.237 120.185L 30.6734 125.05C 25.5584 125.294 23.124 124.565 20.4453 121.158L 4.13735 99.9994C 1.21516 96.1048 0 93.191 0 89.7819L 0 13.903C 0 9.5279 1.94945 5.8785 7.5434 5.39404Z"></path></svg>Try Notion</div></div></div><div style="width: calc(100% - 0px); user-select: none;"></div></div><div class="notion-frame" style="flex-grow: 0; flex-shrink: 1; display: flex; flex-direction: column; background: white; z-index: 1; height: calc(100vh - 45px); max-height: 100%; position: relative; width: 1920px;"><div class="notion-scroller vertical" style="display: flex; flex-direction: column; z-index: 1; flex-grow: 1; position: relative; align-items: center; margin-right: 0px; margin-bottom: 0px; overflow: hidden auto;"><div style="position: absolute; top: 0px; left: 0px;"><div></div></div><div class="whenContentEditable" data-content-editable-root="true" style="caret-color: rgb(55, 53, 47); width: 100%; display: flex; flex-direction: column; position: relative; align-items: center; flex-grow: 1; --whenContentEditable--WebkitUserModify:read-write-plaintext-only;"><span style="height: 1px; width: 1px;"></span><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0; z-index: 2;"><div style="position: relative; width: 100%; display: flex; flex-direction: column; align-items: center; height: 30vh; cursor: default;"><div style="width: 100%; cursor: inherit;"><div style="display: grid; width: 100%; height: 30vh;"><div style="grid-area: 1 / 1 / auto / auto; width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="baddfcd55c654599a2a8f2264bbfb2dfa901f5ed.jpg" style="display: block; object-fit: cover; border-radius: 0px; width: 100%; height: 30vh; opacity: 1; object-position: center 50%;"/></div></div></div><div aria-hidden="true" style='background: rgba(0, 0, 0, 0.4); border-radius: 3px; color: white; font-size: 12px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; width: 180px; left: calc(50% - 90px); padding: 0.3em 1.5em; pointer-events: none; position: absolute; top: calc(50% - 10px); text-align: center; opacity: 0;'>Drag image to reposition</div></div></div><div style="width: 100%; display: flex; justify-content: center; z-index: 3; flex-shrink: 0;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div style="max-width: 100%; padding-left: calc(96px + env(safe-area-inset-left)); width: 100%;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; pointer-events: none;"><div class="notion-page-controls" style='display: flex; justify-content: flex-start; flex-wrap: wrap; margin-top: 16px; margin-bottom: 4px; margin-left: -1px; color: rgba(55, 53, 47, 0.5); font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; height: 24px; pointer-events: auto;'></div></div><div style="padding-right: calc(96px + env(safe-area-inset-right));"><div><div class="notion-selectable notion-page-block" data-block-id="39894ef4-4208-4da4-983d-5197b48c4833" style='color: rgb(55, 53, 47); font-weight: 700; line-height: 1.2; font-size: 40px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; cursor: text; display: flex; align-items: center;'><div contenteditable="false" data-content-editable-leaf="true" placeholder="Untitled" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">5.5.Transformer网络</div></div><div style="margin-left: 4px;"></div></div></div></div></div><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div contenteditable="false" data-content-editable-void="true" style="padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right)); max-width: 100%; width: 100%;"><div style="width: 100%; font-size: 14px;"><div style="width: 100%; max-width: 100%; padding: 8px 0px; margin: 0px auto;"><div style="width: 100%; max-width: 100%; padding-top: 8px; margin: 0px auto;"><div style="padding-bottom: 8px;"><div style="margin: 0px;"></div></div></div></div></div><div style="width: 100%; height: 1px; background: rgba(55, 53, 47, 0.09); margin-bottom: 8px;"></div></div></div></div></div><main style="display: flex; width: 100%; justify-content: center; padding-top: 5px;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div class="notion-page-content" style="flex-shrink: 0; flex-grow: 1; max-width: 100%; display: flex; align-items: flex-start; flex-direction: column; font-size: 16px; line-height: 1.5; width: 100%; z-index: 4; padding-bottom: 30vh; padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right));"><div class="notion-selectable notion-header-block" data-block-id="18706dbc-de0c-4c4a-90d3-4372a2c1fd2e" style="width: 100%; max-width: 1718px; margin-top: 2em; margin-bottom: 4px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 1" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.875em; line-height: 1.3;'>什么是Transformer</div></div></div><div class="notion-selectable notion-text-block" data-block-id="c28ec047-fb99-4a31-8e42-18564ca99642" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">Transformer网络提出于2017年，它处理的任务类型是和RNN所擅长的内容相似的序列信息，但是Transformer却更快更强。短短三年间依托于这个网络模型诞生了非常多的强大算法，这些算法是如此强大，以至于这个模型和大规模预训练的潮流一起让很多人第一次开始想象思考通用人工智能的到来。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6de4495e-b1d4-4248-9f32-8944b2760b38" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">Transformer类似一个CNN，可以在同一时间计算所有输入单词，并得到这些单词各自的表征向量。重要的是，这一次性的处理中得到的每一个表征向量都是在考虑到整句话语境信息以后的结果！这使得Transformer不再需要像RNN一样按照序列顺序处理信息，一来解决了<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">长期依赖问题</span>，而来也使得训练速度加快。而这一切的基础正是之前提到的Self-Attention。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="ebaf9a08-8745-4139-a54c-0932de65ddfa" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>理解Self-Attention</div></div></div><div class="notion-selectable notion-text-block" data-block-id="2fe49764-928c-4ea2-88ee-5c71bd3e27cf" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们先回顾一下之前了解的Self-Attention：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="80fef8e9-8888-4971-9207-9e981a65b30a" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="81027c7d3e89c6a6441488101a7c339bb3dd24d8.png" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="1d425b95-b097-497a-bcbd-ed7c55fbdbe3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">它的核心公式就是： $$
\alpha_{ij}=SoftMax(\frac{Q_iK_j^T}{\sqrt{d_k}})\\\\
A_i=\textbf{Attention}(Q_i,(K,V))= \sum_{j=1}^{d_k} \alpha_{ij}V_j
$$ 其中<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">j</span>代表了在第<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">i</span>个单词的眼中，应该给第<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">j</span>个单词的<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">j</span>分配多少权重，这个分数是<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">j</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">T</span>计算的；$1/{\sqrt{d_k}}$把计算出来的分数缩小一定倍数，防止SoftMax产生的梯度过小，<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">d</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">k</span>是Key向量的长度；最后还有一个SoftMax激活函数让计算出来的分数变到一个合理的大小范围内。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="fba89f26-3ea3-429f-8086-39e8b21c27d0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">最后的最后，我们把所有单词对应的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">V</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">j</span>按照计算出来的权重<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">α</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">j</span>加权求和得到了第i个词的Attention值<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">i</span>。在此之前，要注意我们的<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">i</span>, <span class="notion-enable-hover" data-token-index="14" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">i</span>, <span class="notion-enable-hover" data-token-index="17" style="font-style:italic">V</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">i</span>都是把输入词向量本身<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">X</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">i</span>进行矩阵乘法得到的向量，而这些参数矩阵<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">Q</span>, <span class="notion-enable-hover" data-token-index="26" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">K</span>, <span class="notion-enable-hover" data-token-index="29" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="30" style="font-style:italic">V</span>都是可学习参数。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a44206a4-d8e9-4afd-be85-efcab8f4b226" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">但是这些<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Q</span>, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">K</span>, <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">V</span>之类的向量到底都在干什么呢？我们可以设想一个情况来更好的理解这件事。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="9525df9c-86d4-4793-a6de-2d9b0e2da063" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="bb409a277e222cccd1e1f891b33cee4a7054e267.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="823d467d-da04-4914-b44f-a6c51764d408" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-06-03 下午8.18.26</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="1c04a83e-53bc-4328-a612-8197a2bd32fd" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在我画的这个图中，我们对对第五个输入词“Orange”计算所有的其他词对它的权重，这时“Orange”可能会产生疑问“发生了什么？我是谁？我是代表橙色还是代表橘子？”，这个疑问以<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Q</span>5向量的形式存在。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="07027095-545c-4b9f-b866-fb99c6510eb5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">而其他每个词产生的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">j</span>向量就可能暗含着这个问题的答案，于是我们使用<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">Q</span>5点乘每一个<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">j</span>。也许“ate”单词里的<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">K</span>2含有的“吃”的信息特别能和<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">Q</span>5贴贴，当然同时橘子本身的键<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">K</span>5应该也能和自己贴贴，这两个向量对应的全局对齐权重就有着比较高的值。最终我们得到的Attention值就同时包含了“吃”和“橙色/橘子”的信息，下一层的网络一看到就明白了：这是代表一个被吃的橘子。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a88b8b7a-7ebf-47ab-b02f-ffc02287980f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">事实证明，这种Self-Attention机制非常有助于Transformer理解句子中某些代词和多义词的含义。下图中，为了理解“The animal didn’t cross the street because it was too tired.”中的“it”到底指代什么，我们可以看到自注意力层给了“The animal”非常高的权重，显然，句首的名词对应的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">K</span>显然可以很好的解答“it”关于“认识我自己”的疑问。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="6bbcc1ff-2655-4654-b6cf-8e966546e6ce" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="f7571607fe28edaa0cfe3f1ffcb935f77979934f.png" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="66592b85-c5f1-43a5-977f-40b07e81ee7d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">transformer_self-attention_visualization</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="d60b0433-5b9e-48c7-ac7e-ea5bffe9bdb4" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>多头（Multi-Head）Attention</div></div></div><div class="notion-selectable notion-text-block" data-block-id="ba172530-461a-4078-ac17-9f12effc8a22" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">但是人生的疑问不仅仅只有“我是谁”，对于这句话：”XiaoMing ate an orange yesterday“，Orange的疑问可能不止一个，它也许不仅会好奇“我是谁”，还会好奇“现在是什么时候”，也许还会想知道“我和谁有关”。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d276c72e-b8eb-4211-b0e7-5499fb69f1fa" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">那么为了尽可能满足Orange的疑问，我们需要引入多头Attention，简单来说多头Attention就是把Attention使用不一样的参数算了很多次，准确来说在原文中计算了8次，最后把它们加起来就是多头Attention。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="31c148e7-f6b3-45c9-889b-95d7d9faebdb" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">下图精彩地展示了Multi-Head Attention的计算过程：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="e9f0b3c5-6b6c-4564-81e9-b568d835e65e" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="29a36781c38e1df45d7e66d1d5ea7a2cf939fd97.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c041cbcd-634f-4d25-ae92-ae465deab983" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们现在有了不只一层的Attention层，注意，上面这张图展示的是第一个词语对应的几个<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Q</span>1最终得到的输出，我们还需要把这个模型在每一个词语上都运行一遍来得到<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">x</span>个输出！</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b38ac76c-83d7-408f-8599-6110a52a4c32" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">还是需要用文字来具体讲解一下比较清楚。我们计算这样一个Multi-Head Attention模块的具体流程如下，以下内容可能没有图片让人看着难受，但是请相信把每个参数和隐藏层值的大小搞清楚了有助于真正理解这个模型：</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="64a1763b-03ed-43f3-ba06-853ba6ca9d57" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">我们现在有一个句子有<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">T</span>个单词，每个单词<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">w</span>的大小都是[1, 10000]的One-Hot向量。</div></div><div class="notion-selectable notion-text-block" data-block-id="a0ebb479-2ca4-4e8a-befb-2d0467a25bf1" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="5124a553-230e-49b7-9b13-123e8361af41" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">i</span></div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="22c9051c-047c-4d2a-afe7-600bd1422eb7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">我们把每个词带入<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">词嵌入模型</span>计算出对应的词向量，每个词向量<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">x</span>的大小为[1, 512]，512是由词嵌入模型决定的，我们把所有词向量叠在一起得到我们的句子矩阵<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">X</span>，大小就是[<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">T</span>, 512]。</div></div><div class="notion-selectable notion-text-block" data-block-id="499f6c81-8abc-4c39-88ba-a021ca73c0a8" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">i</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e03e5ddf-c7ed-4e0d-9fc8-4e69769d297b" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="562d98aa-53f5-442a-9b5a-65ed765a23b4" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">接下来开始第一层的自注意力计算，对于第一层我们有参数矩阵<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">W</span>, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">W</span>, <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">W</span> ∈ <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">R</span>用于构建第一层的所有<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">Q</span>, <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">K</span>, <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">V</span>。</div></div><div class="notion-selectable notion-text-block" data-block-id="2544ba7b-7aff-4d60-844e-7e7238ec50cb" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8598deb3-e6bc-4cf8-8478-2550ae4536dc" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">Q</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a6a0b4bd-8615-4a92-8172-27a669d8dd9d" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="cab02e71-3381-4094-bc7e-281f81008941" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">K</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c8353c25-4768-48c0-8e78-5dd767336bb4" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="23efd8bf-a784-4c2d-a01f-3bf148234670" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">V</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="045e31b4-846c-47b0-bcb5-e3b02d3a457d" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[512, 64]</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="ef25243e-04ae-4439-9b2b-7db9e741fac7" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"◦";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">现在我们把句子向量<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">X</span>左乘以查询<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">Q</span>的权重矩阵<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">W</span>，得到<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">Q</span> = <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">X</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">W</span>，我们的<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">Q</span>的大小就是[<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">T</span>, 64]，每一行的<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">Q</span> ∈ <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">R</span>就代表了第t个词语对应的查询Query。</div></div><div class="notion-selectable notion-text-block" data-block-id="ecebe9d7-3c56-427b-9f36-557ebec76664" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="52ce7a64-bc71-4973-88ea-7cd615a3a084" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">Q</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="28713266-8a55-47a4-82fe-fe25d21247a1" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a1e468f3-3961-4e4e-b897-fe57e4731bc7" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="251b4dcc-19eb-4faf-8530-12e627cd1416" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">Q</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ee73973d-e3cb-4a56-88f1-e08bcd920f63" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8afa40c8-438f-4eb5-9b44-e8fd57f91042" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="9fd8d761-d3ce-46c7-b942-0522767a081c" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6e98cbdc-d464-4609-98cf-816fb3ce47ab" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="593ecdfa-df8b-4ff7-958c-eac1a0fa8562" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1, 64]</div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="5502b070-c229-4e9e-82b7-a4ddbbbd5ede" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"◦";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">现在我们把句子向量<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">X</span>左乘以键<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">K</span>的权重矩阵<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">W</span>，得到<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">K</span> = <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">X</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">W</span>，我们的<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">K</span>的大小就是[<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">T</span>, 64]，每一行的<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">K</span> ∈ <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">R</span>就代表了第t个词语对应的Key。</div></div><div class="notion-selectable notion-text-block" data-block-id="908e9171-d8a3-4ab6-b6bf-4b90d3017c31" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="bc4a0cef-7b0e-4e59-a88e-e5a523786809" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">K</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d0a66da9-09bd-48aa-939f-f0cfe12dad42" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8f7268cc-fbb9-4a87-ac22-ea8d0559e24a" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0b516d4e-3640-444b-aaab-6838e2d5d278" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">K</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3476aa87-9e5c-4372-a6a9-88c5c376e8bf" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="315ee7be-2f5b-4385-b98b-1c65bee4a290" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="043b287d-b037-4e80-95bc-1c92d8412059" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="85ed04f1-2e46-4ffe-b28a-bb6aaeac048d" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="db3c0522-cd17-4968-81d9-d29ed22aebbe" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1, 64]</div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="d8af2ad0-ff7a-44da-9b1b-175a6bcef408" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"◦";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">现在我们把句子向量<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">X</span>左乘以值<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">V</span>的权重矩阵<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">W</span>，得到<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">V</span> = <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">X</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">W</span>，我们的<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">V</span>的大小就是[<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">T</span>, 64]，每一行的<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">V</span> ∈ <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">R</span>就代表了第t个词语对应的Value。</div></div><div class="notion-selectable notion-text-block" data-block-id="76cd0351-5b04-4c27-a6b8-5e616e9b3010" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="68eb5daf-bb56-4c04-970e-531f63941685" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">V</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="dfd7cf6c-14db-46e6-b53e-6c045947ea93" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="4086fe6b-c6e5-4bfc-a4c3-f8ecac71ef81" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="db030a04-f8c1-41a2-91a9-d28e15c4bd3a" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">V</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="914e0ca4-9311-4477-8250-c435bd39d569" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e56e81a3-b544-4cff-a952-6222ff810cad" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a290c2e1-86e0-404e-b602-79d32819b24f" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b751b483-d545-4fbb-a488-2ae8d2c11676" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="697fca61-0cab-4b55-912f-3c8ac6865714" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1, 64]</div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="cb377b30-9743-4a8d-bdb5-4417bd02db0d" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"◦";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">我们计算对齐权重$\alpha_1 = SoftMax(\frac{Q_1K^T_1}{\sqrt{d_k}})$，由于<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Q</span>, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">K</span> ∈ <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">R</span>，那么<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">α</span> ∈ <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">R</span>，现在我们<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">α</span>的第t行就代表着在第t个词的眼中，所有的词向量的权重应该是怎样的，这个权重大小当然是[1, <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">T</span>]。</div></div><div class="notion-selectable notion-text-block" data-block-id="25c683e8-3d6e-43e4-a61b-a28973a8b636" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="2059eb43-34c9-485f-bb9f-6307752ddd6f" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="405b0ae2-8311-48a9-9e09-bae3970ed8fe" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">x</span>, 64]</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a191ed07-5093-4f87-817e-368e893bbd56" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">x</span>, <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">x</span>]</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8e8ad667-a26f-4be9-bd9c-d2515a3dad56" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="8361650c-6d71-46e6-b7dd-c18ac6260b85" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"◦";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">接下来，我们计算<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span> = <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">α</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">V</span>，一次性得到了<span class="notion-enable-hover" data-token-index="6" style="font-weight:600">所有的词向量在第一层自注意力中的Attention值</span>。我们的<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">A</span>的大小是[<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">T</span>, 64]，每一行的<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">A</span> ∈ <span class="notion-enable-hover" data-token-index="14" style="font-style:italic">R</span>就代表了第t个词语对应的注意力值。</div></div><div class="notion-selectable notion-text-block" data-block-id="146446f8-c738-4d8e-aaed-36c93d3fbac8" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ad5c877b-224e-4272-8efe-1ede7d84ee41" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0f884101-4486-473d-9d6b-dcacebc033da" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="1b2d5154-15ce-4859-8fbf-fc5752dc3d15" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="fda62431-b967-411a-8402-db1440f1f4ea" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="476605b9-4b60-43b6-94c1-dc353c743a8c" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="06148ce5-12e1-4ea2-9120-37fcf55b4887" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1, 64]</div></div></div></div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="331bf863-fc21-4ac0-ba9e-fdbf99219af2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">我们把<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">W</span>, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">W</span>, <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">W</span>换成<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">W</span>, <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">W</span>, <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">W</span>，计算出<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">A</span> ∈ <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">R</span>，同理计算出<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="19" style="font-style:italic">A</span>, ⋯, <span class="notion-enable-hover" data-token-index="21" style="font-style:italic">A</span>。</div></div><div class="notion-selectable notion-text-block" data-block-id="b170ad68-99f6-4c8f-9159-fa090e9d41eb" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="cbb9eb81-9355-4d63-94f6-6484dddab6e0" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">Q</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e7fc8116-a5b1-4c41-943b-682a2b7efe7b" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="89f599f7-73a4-4419-8615-6e78ae60a0c3" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">K</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ffae882d-1b4e-439d-8e8a-c09312d5e5af" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="10618786-d126-4152-acb9-1d1ffa1b456e" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">V</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="2300b82c-1428-4b04-bbb9-3765b22693bd" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">2</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="89664389-18d0-497c-92d5-c41fb258e779" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">Q</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="246ea1a8-e211-4122-93ec-7998c4b97c41" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">2</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="448140e4-6138-4d41-85f9-174cbc8cee5f" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">K</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="27e0ba20-9cda-4a9e-a519-5dc75612f1d7" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">2</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b7c1910c-dbe7-476d-a1f9-d19a6b2991aa" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">V</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="453e1eef-5d95-4908-8683-64cf7c3c6e62" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">2</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="dde41f72-c800-40bd-9f65-1eba78da6508" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">x</span>, 64]</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="874dfd57-ec9e-454d-8953-327d8900f153" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="20ddf7b6-a485-480a-9843-a13911024b9b" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">2</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f58fc0da-224b-4384-a0bb-85399a92f381" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">8</div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="98fcf86d-37e2-4490-aa96-7b1d15164d8c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">现在我们需要把<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">A</span>, ⋯, <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">A</span>，横向堆叠得到<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">A</span> ∈ <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">R</span>。其中每一行的<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">A</span> ∈ <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">R</span>就代表了第t个词语对应的所有层的注意力值叠加在一起的结果。最终我们的模块就是这样的——输入一个大小[<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">T</span>, 512]的输入句子，输出一样大小的<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">A</span>。</div></div><div class="notion-selectable notion-text-block" data-block-id="504dbea0-1ffb-4b56-abd3-d7e994087b36" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6ee4d702-8a3a-4d52-bb5d-0ac3c9c64f43" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">2</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="68f60f33-814f-479c-9348-b688abd447ab" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">8</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d35bab91-d46e-4933-b76e-18ff58f97a13" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">x</span>, 512]</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="71a9b1d5-db26-4b34-82c0-28d4ececb562" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">⟨<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span>⟩</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6a98d45d-e864-40e7-bffc-afa68735c3ce" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1, 512]</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d1b97662-a0c4-4333-9bf1-0453f3238f37" style="width: 100%; max-width: 100%; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">x</span></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="095c63f2-9266-41b3-b8b8-435323d437c8" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>构建一个Transformer Encoder层</div></div></div><div class="notion-selectable notion-text-block" data-block-id="3ce8704a-6a12-4fab-a33b-db900f81bf5b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">经过Muilt-Head Attention，我们的输出<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span>和<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">X</span>有着一样的大小。太好了，快把它再送入新的一层Multi-Head注意力层实现网络的堆叠吧。别急，Transformer中的一个Encoder层比这还要更加复杂一点。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6ca4da28-f11a-4c2f-b42d-e49b70de32d7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">上述过程距离Transformer里的一个Encoder Layer已经非常接近了，我们还差最后两样东西就可以造出一个Encoder了——残差连接和Layer Norm。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="11cafcce-2451-431a-bcaa-501794af1fc8" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>Layer Normalization</div></div></div><div class="notion-selectable notion-text-block" data-block-id="de57e79f-e1ee-477d-a9c2-ed27ea8a442f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">考虑到Transformer的深度，我们希望能够使用Batch Normalization来减少梯度爆炸和梯度消失问题。但是对于循环网络而言（虽然Transformer并不循环），使用一种类似的叫做Layer Normalization的方法也可以有效的促进网络学习。 一张图可以很好的解释Layer Norm到底Norm了啥：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="edbde53d-602f-4066-8180-44d87461a8b7" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="7b4fc20568e3ba3ddc69fab5cb91ad90946f3407.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="7258dcae-d8be-4caf-bfc3-85ff99297d03" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-06-03 下午11.15.22</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ac6d746a-c556-49e7-a9fb-5d8b9e98d302" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">相对于Batch Normalization在mini-batch的不同训练数据之间计算方差和均值，Layer Norm在一个隐藏层的内部的不同值之间进行这个过程。对于层<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">l</span>，记这一层的隐藏单元数为<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">H</span>，我们的Layer Normalization可以描述为： $$
\mu^l=\frac 1H\sum_{i=1}^H a_i^l \ \ \ \ \ \ 
\ \sigma^l =\sqrt{\frac 1H\sum_{i=1}^H(a^l_i-\mu^l)^2}
$$ 当然，和Batch Normalization一样，我们不能缩放平移一下隐藏层就完事了，我们还得设置两个可学习参数<span class="notion-enable-hover" data-token-index="7" style="font-weight:600">g</span>和<span class="notion-enable-hover" data-token-index="9" style="font-weight:600">b</span>来允许网络重新设计隐藏层的方差和均值，在一个循环神经网络中，我们的加入了Layer Normalization的隐藏层变换就是下面这样。 $$
h^t=f\left[\frac {\textbf{g}}{\sigma^t}\odot(a^t-\mu^t)+\textbf{b}\right]
$$ 而我们在Transformer中对我们的隐藏层$ AR^{[T/_x,512]}，<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">也</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">使</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">用</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">了</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">L</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="20" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">r</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">N</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">r</span><span class="notion-enable-hover" data-token-index="25" style="font-style:italic">m</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="29" style="font-style:italic">z</span><span class="notion-enable-hover" data-token-index="30" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="31" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="32" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="33" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="34" style="font-style:italic">n</span>，<span class="notion-enable-hover" data-token-index="36" style="font-style:italic">记</span><span class="notion-enable-hover" data-token-index="37" style="font-style:italic">这</span><span class="notion-enable-hover" data-token-index="38" style="font-style:italic">一</span><span class="notion-enable-hover" data-token-index="39" style="font-style:italic">层</span><span class="notion-enable-hover" data-token-index="40" style="font-style:italic">为</span>LayerNorm(A)$： $$
\begin{align}
\mu &amp;= \frac 1{T_x}\sum_{i=1}^{T_x} A_i,\ \ \ A_i\in R^{[1,512]} \\\\
\sigma &amp;=\sqrt{\frac 1{T_x}\sum_{i=1}^{T_x}(A_i-\mu)^2}\\\\
LayerNorm(A)&amp;=\frac {\textbf{g}}{\sigma}\odot(A-\mu)+\textbf{b}
\end{align}
$$ ## 全连接层</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e610e2bd-414a-4007-b725-ef6f4a41a242" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">Transformer中的一个Encoder结构可不只一层多头Attention层，在从多头Attention层输出以后，Encoder模块还要对它进行最后的加工——输入一个全连接层。这个全连接层并不复杂，它先把<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">i</span> ∈ <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">R</span>[1, 512]进行一次使用ReLU激活函数的全连接运算得到一个长为2048的隐藏层向量： <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">i</span>[1] = <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">R</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">L</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">U</span>(<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">W</span>1 + <span class="notion-enable-hover" data-token-index="21" style="font-style:italic">b</span>1) = max {0, <span class="notion-enable-hover" data-token-index="24" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="25" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">W</span>1 + <span class="notion-enable-hover" data-token-index="29" style="font-style:italic">b</span>1} 显然上式子中<span class="notion-enable-hover" data-token-index="33" style="font-style:italic">W</span>1 ∈ <span class="notion-enable-hover" data-token-index="36" style="font-style:italic">R</span>[512, 2048]。注意了，我们把每一个<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="40" style="font-style:italic">i</span> ∈ <span class="notion-enable-hover" data-token-index="42" style="font-style:italic">R</span>[1, 512]都带入运算得到对应的输出，因此在这里，不同的<span class="notion-enable-hover" data-token-index="45" style="font-style:italic">A</span>1, <span class="notion-enable-hover" data-token-index="48" style="font-style:italic">A</span>2, ⋯, <span class="notion-enable-hover" data-token-index="51" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="52" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="53" style="font-style:italic">x</span>就相当于一次性输入网络的mini-batch中的不同数据，尽管它们严格来说并不是不同的训练集数据，只是同一句话中的不同单词对印的向量。因此我们的输出<span class="notion-enable-hover" data-token-index="55" style="font-style:italic">A</span>[1]的大小就是[<span class="notion-enable-hover" data-token-index="58" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="59" style="font-style:italic">x</span>, 2048]。这也就是原文称该全连接层为Position-wise Feed-Forward Networks的原因。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="62148f21-a421-4207-9e3a-392fdfffe18c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">之后我们再使用一层线性层（不带激活函数）把向量大小变回[<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">x</span>, 512]即可，因此我们的这个全连接层<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">F</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">F</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">N</span>就写作： <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">F</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">F</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">N</span>(<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">A</span>) = max {0, <span class="notion-enable-hover" data-token-index="14" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">W</span>1 + <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">b</span>}<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">W</span>2 + <span class="notion-enable-hover" data-token-index="23" style="font-style:italic">b</span>2 上式子中<span class="notion-enable-hover" data-token-index="26" style="font-style:italic">W</span>2 ∈ <span class="notion-enable-hover" data-token-index="29" style="font-style:italic">R</span>[2048, 512]。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="b29cdd41-9c20-4798-b304-07d70af8b0c8" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>残差连接</div></div></div><div class="notion-selectable notion-text-block" data-block-id="12d7cee9-e94a-40a3-a227-c11198dde21b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们的Encoder模块因此有两个子模块，Multi-Head Self-Attention层和FFN层。这两个模块之间得到的输出还夹着残差连接和LayerNorm层，一张图很好的表明了这个模块是如何构建的。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="fb760f1f-b14b-4381-b27d-5db8f125c6af" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="912e5957d59f1ca1e4b4c9c40994f35a44c4652e.png" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e32f7a62-853a-45af-aef8-3b0ec4da2890" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-06-05 上午10.11.26</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3a1854e4-7671-47aa-8f14-757d97b622aa" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">上图中，我们在每个子模块的首位两段都添加了跳层连接和LayerNorm，两个这样的子模块相拼接，就得到了我们的一个Encoder模块。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="587e3da5-1ff9-405b-a1fd-ff0394924789" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">X</span>（经过词嵌入的）, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">Z</span>, <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">F</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">F</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">N</span>(<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">Z</span>), <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">O</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">u</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">p</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">u</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">t</span>大小全都为[<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">x</span>, 512]。这样的网络我们把它一层叠一层，总共叠加了6层。当然，这六层之间<span class="notion-enable-hover" data-token-index="23" style="font-weight:600">没有任何的参数共享</span>，它们是各自被训练的6层。这6层就共同构成了一个Transformer结构中的Encoder部分，可以很好的解离出文本中的特征和理解文本。接下来我们就要开始设计Transformer的“嘴巴”——Decoder Transformer部分。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="220f8f4a-b904-4b4c-8a30-2d5cdcb90535" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>构建Decoder Transformer</div></div></div><div class="notion-selectable notion-text-block" data-block-id="fb27f030-e53e-4e46-9aa9-d29bc076b044" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">加入Transformer的Decoder部分以后的整个结构就是下图这样的：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="14ff9f7b-7b33-4d6f-ad6b-885314fe7488" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="ed55f0dffeac93fbefb6977ebddafc88c4ecf1df.png" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6b4e64ff-93b1-4211-8a4f-c098d72bb837" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-06-05 上午10.47.13</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="38795da8-dc48-4d60-90e2-67349505a9cd" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">让我们仔细找找不同：看看上图右边的Decoder结构，熟悉的LayerNorm，熟悉的跳层连接，熟悉的叠加……这个Encoder-decoder Attention是什么？还有为什么Encoder 6输出的是<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">K</span>和<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">V</span>？让我们来细细了解。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a5298b78-5104-4ad2-a114-3b909cc75c45" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">当我们对输入序列经过6层Self-Attention的洗礼以后，第六层Encoder模块的输出<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span> ∈ <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">R</span>[<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">x</span>, 512]中的每一个Attention值现在都对这句话有着相当高屋建瓴的理解，可能<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">A</span>1的意思是“这句话开头含有着一个雄性哺乳纲灵长目人科人属智人种的单数主语”，而<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">A</span>2的意思是“这句话中暗含着事件主体和事件客体之间微妙的互相包含关系”……总之如果现在Decoder Transformer想要知道译文的第<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">i</span>个词语该输出什么，去问问Encoder 6再好不过了。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b24a23d5-5a13-41d5-a28f-249b77d1c26b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">于是我们首先把Encoder 6输出的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span> ∈ <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">R</span>[<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">x</span>, 512]乘以<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">K</span>和<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">V</span>得到<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">K</span>, <span class="notion-enable-hover" data-token-index="17" style="font-style:italic">V</span> ∈ <span class="notion-enable-hover" data-token-index="19" style="font-style:italic">R</span>[<span class="notion-enable-hover" data-token-index="21" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">x</span>, 64]，当然这里的<span class="notion-enable-hover" data-token-index="25" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">K</span>, <span class="notion-enable-hover" data-token-index="28" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="29" style="font-style:italic">V</span>在<span class="notion-enable-hover" data-token-index="31" style="font-style:italic">A</span>输入不同层的decoder时是不一样的。而我们的Encoder-decoder Attention发出的问题<span class="notion-enable-hover" data-token-index="33" style="font-style:italic">Q</span>则来自其本身Decoder模块中上一层的输出。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ba47218b-855f-41a1-bb57-79443131e982" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">当然，Encoder-decoder Attention本身也是一个MultiHead-Attention。简单来说，这个模块就是一个MultiHead Attention，只不过它的<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Q</span>是来自于上一层Multi-Head Attention的输出，<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">K</span>, <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">V</span>则来自Encoder 6的输出。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="2216ffc2-26d2-4a4a-b762-74fb279c7fc3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">最后的最后，我们把Decoder 6的输出全部输入进一个全连接神经网络中，并使用SoftMax激活函数输出当前这句话（比如“我爱吃香？？？”）的下一个词应该是应该是什么，这里的概率通过一个<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">ŷ</span> ∈ <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">R</span>[10000]表示，10000是我们的词汇表的大小。（如果这是个训练良好的网络，它可能会在“蕉”这个字对应的位置上输出最大的概率）。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0fe864f5-87bd-44e6-b5aa-4880f1c4ec92" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">相信你现在就可以毫不费力地看懂原文中的这个复杂的模型示意图了，你可能会发现，实际上我画的图比论文原图更加难懂，这里我替我画的图向各位道歉了。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="c9ad482c-ab2b-41f8-8434-001bee9ef06f" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="a8c20291615ffd824bf48403d208421701991a82.png" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e2c7fe0d-4e77-421b-b423-b18fd0f2fff7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-06-05 上午11.20.29</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="6d26c10c-1ca9-49ef-80d2-0f2d21f94cfc" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>各种技术细节</div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="d2aca883-7829-4b93-8982-cd31e305055a" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>Decoder输入遮罩</div></div></div><div class="notion-selectable notion-text-block" data-block-id="4d21e9ca-f64f-496c-a0a0-6da687a22aba" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们已经知道了所有的模块是如何工作的，但是一个尚未解决的问题是：在最开始的时候，我们要往Decoder Transformer里输入什么？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6a01369c-60b2-4809-aed7-60fadb1ba25b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">答案是？？？？？？？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="63d6dec2-c0ef-4c92-80dd-093ceed12809" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">更准确来说，是&lt;SOS&gt;？？？？？？？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d1a44fda-9615-4542-a916-84be6b06d20f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们的网络还什么都不知道呢，输入任何东西都没什么意义，所以我们一开始就只能输入一个表示句子开始的Token&lt;SOS&gt;让网络进行计算，网络这时候就需要输出第一个词的概率分布，也许它会输出一个“我”有着最大概率的概率分布。那么好，我们现在的输入就变成“&lt;SOS&gt;我？？？？？”了。（当然，你也可以使用Beam Search，这个方法在之前的教程中有讲到，这里为了简单就不使用这个方法）</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b95e334d-1262-4fc0-af8f-9bd4719d65df" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">接下来我们就把“&lt;SOS&gt;我？？？？？”再输入Decoder网络，得到新的下一个词的概率分布，也许“是”这个词此时有着最大的概率，那么我们的下一次输入给Decoder网络的内容就是“&lt;SOS&gt;我是？？？？”了。我们就一直这样循环下去，直到某一次输出中<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">“&lt;EOS&gt;”（End of Sentence）</span>有了最大的概率，我们就认为这段输出算是到头了。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f8732f41-c755-459f-8c34-26f05690e426" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">值得注意的是，在不断向decoder网络输入句子时，我们的Encoder网络就不需要再运行了，在处理一句话的过程中，Encoder网络只需要在最开始运行一次。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a1d0e296-91b6-4d9a-b9c8-cc2cc5c1a964" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果你有心，你可能会问：我们为什么不只输入“&lt;SOS&gt;我是”到网络中，而输入“&lt;SOS&gt;我是？？？？”到网络中呢？很遗憾，我们的Transformer不能处理任意长度的输入，对于Decoder网络和Encoder网络，我们都只能输入一个固定长度的句子，不同的句子长短不一，我们就向短的句子的末尾加入无意义的占位符延长到统一长度。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="cb09b746-7cca-4142-b9c5-d8d2a139a9a8" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这就带来一个重大问题，如果我们输入“&lt;SOS&gt;我是？？？？”到Decoder网络中，我们的某一个Self-Attention的值就是<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span> = <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">α</span>1<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">V</span>1 + <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">α</span>2<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">V</span>2 + ⋯ + <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">α</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">x</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">V</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">x</span>，其中<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">V</span>4⋯<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">V</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="25" style="font-style:italic">x</span>全都是从单词“?”中计算出来的！而且计算<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">A</span>4, ⋯<span class="notion-enable-hover" data-token-index="30" style="font-style:italic">A</span><span class="notion-enable-hover" data-token-index="31" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="32" style="font-style:italic">x</span>所使用的<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">Q</span>也全都来自“？”！这绝对不是我们想要的，于是我们就要用个“罩子”遮住“？”，具体的方法就是，在计算<span class="notion-enable-hover" data-token-index="36" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="37" style="font-style:italic">i</span><span class="notion-enable-hover" data-token-index="38" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="39" style="font-style:italic">j</span><span class="notion-enable-hover" data-token-index="40" style="font-style:italic">T</span>时，如果这个<span class="notion-enable-hover" data-token-index="42" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="43" style="font-style:italic">j</span>来自“?”，我们就把这个结果乘上$-\infin$，使得它对应的<span class="notion-enable-hover" data-token-index="45" style="font-style:italic">α</span><span class="notion-enable-hover" data-token-index="46" style="font-style:italic">j</span> = 0。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="2461d029-67e0-46e3-9589-0665e3609e58" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>导师驱动（Teacher forcing）训练</div></div></div><div class="notion-selectable notion-text-block" data-block-id="39c86898-503d-4441-8f51-b10b28468fa7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">太好了，我们现在已经学会了如何使用Transformer输出一段文字，赶快带入交叉熵损失函数训练吧： $$
J(\hat y, y)=\sum_{i=1}^{n_y}L(\hat y_i,y_i)
$$ Transformer的作者看到这个公式估计会气晕过去。Transformer的最大亮点之一便是无论输入序列多长，它输出一个单词的时间复杂度都是常数，但是上面这个式子中想要计算第<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">i</span>个词，需要先计算前<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">i</span> − 1个词，这彻抹去了网络在训练时的速度优势。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="9fbe3a1b-44d1-4b55-9802-f6aa349880c0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">相比于在传统的循环神经网络中输出一个单词需要上一次输出的隐藏层值，Transformer的每一个输出都只依赖于已经输出的序列和Encoder网络的隐藏层输出。如果想加速传统循环网络的训练，我们没什么好办法——因为上一个单元的隐藏层值可没什么投机取巧的算法，只能乖乖一个个算。但是Transformer不一样，我们可以不使用Decoder网络输出的前几个词语，而直接使用正确答案<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">y</span>中的对应词语，来计算第<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">i</span>个输出词。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8db49f74-fdcc-4098-bc78-d2cd98f0c6b2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这个正确答案就像老师一样，在网络考虑如何输出第<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">i</span>个词时，老师保证前<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">i</span> − 1个词全都是完美的正确答案，这样网络就可以更好的学习如何输出这第<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">i</span>个词，而不用担心之前犯下的错误。当然，更重要的是，我们现在可以同时计算网络的每一个输出词，大大提高了训练速度，事实证明，这种导师驱动训练可以达到很好的效果。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="ced5e0ee-29aa-4c05-837f-314283ed0c29" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>位置编码</div></div></div><div class="notion-selectable notion-text-block" data-block-id="48f618c7-2b68-4aa8-8657-69c377c5e28d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们计算Self Attention的式子是：<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span> = <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">α</span>1<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">V</span>1 + <span class="notion-enable-hover" data-token-index="8" style="font-style:italic">α</span>2<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">V</span>2 + ⋯ + <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">α</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">x</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">V</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">x</span>。在<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">A</span>的眼里，<span class="notion-enable-hover" data-token-index="22" style="font-style:italic">V</span>1, <span class="notion-enable-hover" data-token-index="25" style="font-style:italic">V</span>10的地位是完全一样的，先后顺序无法体现在Transformer中。但是在自然语言处理任务中，词语在句子中的位置是含有非常丰富的信息的。因此Transformer需要想个办法向模型中输入词语的位置信息。这里使用的方法就叫做位置编码（Positional Encoding）。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="45c45eec-9633-46ef-969e-54b97cedf7af" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们首先要知道位置编码往哪里输入，在transformer的实现中，如果我们的输入向量<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">X</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">p</span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">s</span>的大小为[1, 512]，那么我们会根据这个<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">X</span>在句子中所处的位置计算出一个位置编码向量<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">P</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">p</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="11" style="font-style:italic">s</span> ∈ <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">R</span>[1, 512]，然后把它们直接相加，代替原来的<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">X</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">i</span>输入网络。接下来我们要了解一下如何计算<span class="notion-enable-hover" data-token-index="19" style="font-style:italic">P</span><span class="notion-enable-hover" data-token-index="20" style="font-style:italic">p</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">s</span>。现在假设我们的<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">X</span>是输入句子中的第<span class="notion-enable-hover" data-token-index="26" style="font-style:italic">p</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">s</span>个词语，而<span class="notion-enable-hover" data-token-index="30" style="font-style:italic">k</span>表示向量$ P_{pos}$的第k个元素，那么我们的位置编码就是按照如下规则产生的： $$
P_{(pos,2i)}=\sin\left(\frac{pos}{10000^{2i/d}}\right)\\\\
P_{(pos,2i+1)}=\cos\left(\frac{pos}{10000^{2i/d}}\right)
$$ 其中d代表<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">P</span>的总长度，在这个教程中为512。这个公式在干什么？我们可以看到的是，对于一个单词的<span class="notion-enable-hover" data-token-index="36" style="font-style:italic">P</span>，它的每一位的值就是在不同的周期的三角函数上取到的函数值，我们可以这样取出每一个单词的位置编码：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="73c2be3b-3d95-4f23-bdbe-bf726bd7d28b" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="cc1cd7fda9a31dd2945953dd944b60feb7af4290.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="25fbb13a-bda1-47bb-ace7-7a3bc75243c0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">截屏2021-06-05 下午1.42.52</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d16ada8c-9376-41f3-ab67-8b8da8bd56c4" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这张图可能没有那么好理解，但它确实很好的反映了我们的位置编码的取值方式。如果我们把所有的位置编码都放在一张图上我们可以看到如下效果：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="1a5b0a8f-b514-4f0c-af4d-fcaa54c43268" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="18230343912b1c587f87519704b1e5d8a10504dc.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="92abc3c4-f54d-4253-ab02-801f5374247d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">attention-is-all-you-need-positional-encoding</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="f24a9064-e2ec-4633-824a-5bff23285b1c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这里的每一行都代表着某一个词语的位置编码的可视化结果。可以看到，不同位置的词语有着独特的编码纹理规律，这使得网络能够区分出不同的词语位置。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="3ee872ee-c43b-4c7b-b2ab-e8ed3f55759d" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>为什么Positional Encoding好使？</div></div></div><div class="notion-selectable notion-text-block" data-block-id="483376dd-cdf7-46e6-8424-f8257baf302e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">最后我们还有一个问题：为什么Positional Encoding好使？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3678b9e1-5404-4e6b-9d0d-e54b5e25e007" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">最简单的定义往往蕴涵着最深刻的思想。接下来主要是我自己的想法。最简单来说，由于我们的位置编码和词向量直接相加，我们不能够使得位置编码值过大以至于掩盖了词向量信息。这种三角函数的定义方式在不会破坏太多词向量信息的同时尽可能使得每个不同位置的词语有着不同的位置编码，赋予了网络区分不同位置的能力。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c7f16b0a-8c18-4d92-ba03-7389204c4736" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这个解释挺好的，但它不能给我们足够多的直觉，想要理解位置编码中到底发生了什么，我们需要想象我们就是Transformer，接下来这个小故事就作为这篇教程的结尾吧。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="4daa0db8-0530-4e62-969b-7d1fdcec06de" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">你是一个正在阅读“The animal didn’t cross the street because it was too tired”的第一层Self-Attention层。现在你读到了“it”，你很好奇这个“it”指代什么，于是你生成了一个<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Q</span>，尝试去找到答案。丰富的经验告诉你，你现在需要使这个<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">Q</span>和名词性的<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">K</span>更加相似，因为这样你的<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">Q</span>才更可能和正确答案<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">K</span>产生更大的乘积<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">T</span>。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="9fc8bfd7-8ef1-4b01-aac8-667ab7ab45cd" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">结果“Street”和“Animal”都找上你了，你很困惑，到底哪个才是“it”所代表的呢？丰富的经验再次告诉你：一般来说句首的那个名词会有更大的概率在后面的内容中以“it”指代。于是你翻开了一本“PE”字典：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="57c00443-6c00-4f1e-93cb-35c1447c450f" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="8fd0fc9f6f7403fcc1da80901ff923fb039e5cb8.png" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="bdebf19f-d217-4bc5-8484-9c1a61676c11" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1*hkSFqvF_NhCN-JxGxRD1qg</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="c2211f72-49ec-448c-b3c0-d53c45968472" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="ef7640ccc8305390171729c6b59d07a6b3bd6a05.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a5665228-5792-4bbc-bff8-89227a9b41b6" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1*MtRjAmNl8uBcLQdGGHLuJw</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="d9653ac8-40d5-445b-8772-6344bd43d8fa" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="da25f1fc1b56e89c71fe41a39bfa6430d4fcd001.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0c936b90-3810-4b9f-8447-66b477700e2a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1*k8P5eNl88uACGgDtzg3lgQ</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="3040760b-5ac5-441e-8ef7-920dcee7233f" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="62a7d7a76726904fe280ac31104fecc6e97d029a.png" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="9a6b626f-a7c4-48a5-82e6-49bc3cde463b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1*xw0hea_RDkjSlmKqnJQxQQ</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="511050c2-5d7a-4d8f-b207-b753451ffc80" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">这本字典上很清楚写着句子中的第一个词有着怎样的激活规律，于是你把<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">Q</span>根据第一条PE的纹理移动了一些，由于： <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">T</span> = <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">T</span>(<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">X</span> + <span class="notion-enable-hover" data-token-index="14" style="font-style:italic">P</span>)<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">T</span> = <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="20" style="font-style:italic">k</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">X</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">T</span> + <span class="notion-enable-hover" data-token-index="25" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="29" style="font-style:italic">P</span><span class="notion-enable-hover" data-token-index="30" style="font-style:italic">T</span> 于是句首词语现在能够有更大的<span class="notion-enable-hover" data-token-index="32" style="font-style:italic">Q</span><span class="notion-enable-hover" data-token-index="33" style="font-style:italic">W</span><span class="notion-enable-hover" data-token-index="34" style="font-style:italic">K</span><span class="notion-enable-hover" data-token-index="35" style="font-style:italic">T</span><span class="notion-enable-hover" data-token-index="36" style="font-style:italic">P</span><span class="notion-enable-hover" data-token-index="37" style="font-style:italic">T</span>，你再次询问所有的<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">K</span>，现在只有“The Animal”脱颖而出了。你非常的快乐，把“Animal”赋予一个较高的权重上交给FFN了。你松了一口气，还好你认真地学习过了Transformer的相关知识，才没有给你的其他几个头拖后腿（因为你是Multi-Head Attention）。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="8cd9578c-a257-4670-8d1e-07a52c46cdb0" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="c87bdaef89257981693dfefba98bb8e43618cd67.png" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="fab6e729-6a75-465a-8997-e969a0f9e935" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">transformer_self-attention_visualization</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8ca62f24-12ee-4993-a7d8-5609ade59247" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">（后记：你的位置编码大法非常的好，但是后来又遇到了这句话“The animal didn’t cross the street because it was too <span class="notion-enable-hover" data-token-index="1" style="font-weight:600">wide</span>”的时候你还是没绷住。好在5楼的一位兄弟的某一个头最后把这事儿解决了）</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="a8d17f0f-682e-470d-94d9-9b2060eddeac" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="036e307c837cc83ab3b75b4e7b96f21d2fb631b4.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8a831b2f-025b-4367-ae6d-ed5308fdbb40" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">image2</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c81fb365-6d1c-4104-af44-f808cc5c6cc7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">参考资料：</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b7995c1d-9840-4020-9c8c-a300a098e0aa" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1] Layer Normalization https://arxiv.org/pdf/1607.06450.pdf</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="5f4e7392-8496-459b-aea2-1e03c6a26c48" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[2] Attention is all you need https://arxiv.org/pdf/1706.03762.pdf</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="a709fe57-a697-4839-a38c-d100f30cf76e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[3] The Illustrated Transformer https://jalammar.github.io/illustrated-transformer/</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="431fc84c-72e7-4cc8-8771-f7be40f165d4" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[4] Deeplearning.ai Specialization-Transformer https://www.coursera.org/learn/nlp-sequence-models/home/week/4</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="4cf3d1dd-9e64-46a9-ae5f-c4d0605b4a13" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[5] Key Intuition Behind Positional Encodings https://medium.com/swlh/elegant-intuitions-behind-positional-encodings-dc48b4a4a5d1</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="94c389fd-5ff7-42aa-af41-6b71848fc8e2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[6] Why add positional embedding instead of concatenate https://github.com/tensorflow/tensor2tensor/issues/1591</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="cae6c5b4-b369-447f-93f7-a2af019be554" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[7] Transformer: A Novel Neural Network Architecture for Language Understanding https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html</div></div></div></div></div></div><div contenteditable="false" data-content-editable-void="true" style="width: 0px;"><div style="display: none; flex-shrink: 0; pointer-events: none; width: 0px; position: absolute; right: 192px; opacity: 0;"><div style="display: flex; flex-direction: column; padding: 5px 16px; width: 340px; flex-shrink: 0; height: 100%; position: relative; pointer-events: none; z-index: 1;"><div style="position: absolute; pointer-events: none; width: 100%; height: 100%; top: -5px; background: linear-gradient(white 0px, rgba(255, 255, 255, 0) 15px);"></div></div></div></div></main><span style="height: 1px; width: 1px;"></span></div><div class="notion-presence-container" style="position: absolute; top: 0px; left: 0px; z-index: 89;"><div></div></div></div></div></div><div class="notion-peek-renderer" style="position: fixed; top: 0px; right: 0px; bottom: 0px; width: 960px; z-index: 109; transform: translateX(960px) translateZ(0px);"></div></div></div></div></div><script src="1172e9111a5fb396bcb8a05870b5eabf8abf221c.js" type="text/javascript"></script><div style="width: env(safe-area-inset-bottom);"></div></body></html>