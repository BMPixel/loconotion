<html class="notion-html"><head lang="en"><meta charset="utf-8"/><meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"/><title>4.4.人脸识别和神经风格迁移</title><meta content="en_US" property="og:locale"/><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="/images/logo-ios.png" rel="apple-touch-icon"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="telephone=no" name="format-detection"/><meta content="no" name="msapplication-tap-highlight"/><link href="e218a1aef6df86309cb95b61e446888efa3b0379.css" media="print" rel="stylesheet"/><link href="e1d809d762eeca23edf0cb31bb17bf3c703085f5.css" rel="stylesheet"/><link href="019e696da19f5dba12f9b7fffaa163689299d4c7.css" rel="stylesheet"/></head><body class="notion-body"><style>body{background:#fff}body.dark{background:#191919}@keyframes startup-shimmer-animation{0%{transform:translateX(-100%) translateZ(0)}100%{transform:translateX(100%) translateZ(0)}}@keyframes startup-shimmer-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes startup-spinner-rotate{0%{transform:rotate(0) translateZ(0)}100%{transform:rotate(360deg) translateZ(0)}}#initial-loading-spinner{position:fixed;height:100vh;width:100vw;z-index:-1;display:none;align-items:center;justify-content:center;opacity:.5}#initial-loading-spinner svg{height:24px;width:24px;animation:startup-spinner-rotate 1s linear infinite;transform-origin:center center;pointer-events:none}#skeleton{background:#fff;position:fixed;height:100vh;width:100vw;z-index:-1;display:none;overflow:hidden}#initial-loading-spinner.show,#skeleton.show{display:flex}body.dark #skeleton{background:#191919}.notion-front-page #skeleton,.notion-mobile #skeleton{display:none}#skeleton-sidebar{background-color:#fbfbfa;box-shadow:inset -1px 0 0 0 rgba(0,0,0,.025);display:flex;width:240px;flex-direction:column;padding:12px 14px;overflow:hidden}body.dark #skeleton-sidebar{background-color:#202020;box-shadow:inset -1px 0 0 0 rgba(255,255,255,.05)}#skeleton.isElectron #skeleton-sidebar{padding-top:46px}#skeleton .row{display:flex;margin-bottom:8px;align-items:center}#skeleton .row.fadein{animation:1s ease-in 0s 1 normal both running startup-shimmer-fade-in}#skeleton .chevron{width:12px;height:12px;display:block;margin-right:4px;fill:rgba(227,226,224,.5)}body.dark #skeleton .chevron{fill:#2f2f2f}.startup-shimmer{background:rgba(227,226,224,.5);overflow:hidden;position:relative}body.dark .startup-shimmer{background:#2f2f2f}.startup-shimmer::before{content:"";position:absolute;height:100%;width:100%;z-index:1;animation:1s linear infinite startup-shimmer-animation;background:linear-gradient(90deg,transparent 0,rgba(255,255,255,.4) 50%,transparent 100%)}body.dark .startup-shimmer::before{background:linear-gradient(90deg,transparent 0,rgba(86,86,86,.4) 50%,transparent 100%)}#skeleton .icon{width:20px;height:20px;border-radius:4px}#skeleton .text{height:10px;border-radius:10px}#skeleton .draggable{-webkit-app-region:drag;position:absolute;top:0;left:0;width:100%;height:36px;display:none}#skeleton.isElectron .draggable{display:block}</style><style id="scroll-properties">
			::-webkit-scrollbar {
				width: 10px;
				height: 10px;
			}
			::-webkit-scrollbar {
				background: transparent;
			}
			::-webkit-scrollbar-track {
				background: #EDECE9;
			}
			::-webkit-scrollbar-thumb {
				background:#D3D1CB;
			}
			::-webkit-scrollbar-thumb:hover {
				background:#AEACA6;
			}
		</style><div id="notion-app"><div class="notion-app-inner notion-light-theme" style='color: rgb(55, 53, 47); fill: currentcolor; line-height: 1.5; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; -webkit-font-smoothing: auto; background-color: white;'><div style="height: 100%;"><div class="notion-cursor-listener" style="width: 100vw; height: 100%; position: relative; display: flex; flex: 1 1 0%; background: white; cursor: text;"><div class="" style="display: flex; flex-direction: column; width: 100%; overflow: hidden;"><div style="max-width: 100vw; z-index: 100; background: white; user-select: none;"><div class="notion-topbar" style="width: 100%; max-width: 100vw; height: 45px; opacity: 1; transition: opacity 700ms ease 0s, color 700ms ease 0s; position: relative;"></div><div style="width: calc(100% - 0px); user-select: none;"></div></div><div class="notion-frame" style="flex-grow: 0; flex-shrink: 1; display: flex; flex-direction: column; background: white; z-index: 1; height: calc(100vh - 45px); max-height: 100%; position: relative; width: 1920px;"><div class="notion-scroller vertical" style="display: flex; flex-direction: column; z-index: 1; flex-grow: 1; position: relative; align-items: center; margin-right: 0px; margin-bottom: 0px; overflow: hidden auto;"><div style="position: absolute; top: 0px; left: 0px;"><div></div></div><div class="whenContentEditable" data-content-editable-root="true" style="caret-color: rgb(55, 53, 47); width: 100%; display: flex; flex-direction: column; position: relative; align-items: center; flex-grow: 1; --whenContentEditable--WebkitUserModify:read-write-plaintext-only;"><span style="height: 1px; width: 1px;"></span><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0; z-index: 2;"><div style="position: relative; width: 100%; display: flex; flex-direction: column; align-items: center; height: 30vh; cursor: default;"><div style="width: 100%; cursor: inherit;"><div style="display: grid; width: 100%; height: 30vh;"><div style="grid-area: 1 / 1 / auto / auto; width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="3a6bea64708629223ed5e3954ebb8603012582b5.jpg" style="display: block; object-fit: cover; border-radius: 0px; width: 100%; height: 30vh; opacity: 1; object-position: center 50%;"/></div></div></div><div aria-hidden="true" style='background: rgba(0, 0, 0, 0.4); border-radius: 3px; color: white; font-size: 12px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; width: 180px; left: calc(50% - 90px); padding: 0.3em 1.5em; pointer-events: none; position: absolute; top: calc(50% - 10px); text-align: center; opacity: 0;'>Drag image to reposition</div></div></div><div style="width: 100%; display: flex; justify-content: center; z-index: 3; flex-shrink: 0;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div style="max-width: 100%; padding-left: calc(96px + env(safe-area-inset-left)); width: 100%;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" style="user-select: none; --pseudoSelection--background:transparent; pointer-events: none;"><div class="notion-page-controls" style='display: flex; justify-content: flex-start; flex-wrap: wrap; margin-top: 16px; margin-bottom: 4px; margin-left: -1px; color: rgba(55, 53, 47, 0.5); font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; height: 24px; pointer-events: auto;'></div></div><div style="padding-right: calc(96px + env(safe-area-inset-right));"><div><div class="notion-selectable notion-page-block" data-block-id="dbf88280-bcdb-4070-8371-33324aa27c33" style='color: rgb(55, 53, 47); font-weight: 700; line-height: 1.2; font-size: 40px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; cursor: text; display: flex; align-items: center;'><div contenteditable="false" data-content-editable-leaf="true" placeholder="Untitled" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">4.4.人脸识别和神经风格迁移</div></div><div style="margin-left: 4px;"></div></div></div></div></div><div style="width: 100%; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; flex-grow: 0;"><div contenteditable="false" data-content-editable-void="true" style="padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right)); max-width: 100%; width: 100%;"><div style="width: 100%; font-size: 14px;"><div style="width: 100%; max-width: 100%; padding: 8px 0px; margin: 0px auto;"><div style="width: 100%; max-width: 100%; padding-top: 8px; margin: 0px auto;"><div style="padding-bottom: 8px;"><div style="margin: 0px;"><div><div style="display: flex; padding-bottom: 4px; width: 100%;"><div style="display: flex; align-items: center; height: 34px; width: 160px; flex: 0 0 auto; color: rgba(55, 53, 47, 0.65);"><div aria-disabled="true" role="button" style="user-select: none; transition: background 20ms ease-in 0s; display: flex; align-items: center; height: 100%; width: 100%; border-radius: 3px; padding: 0px 6px;" tabindex="-1"><div style="display: flex; align-items: center; line-height: 120%; min-width: 0px; font-size: 14px;"><div style="margin-right: 6px;"><svg class="typesMultipleSelect" style="width: 16px; height: 16px; display: block; fill: rgba(55, 53, 47, 0.45); flex-shrink: 0; backface-visibility: hidden;" viewBox="0 0 16 16"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></div><div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Tags</div></div></div></div><div style="display: flex; margin-left: 4px; height: 100%; flex: 1 1 auto; flex-direction: column; min-width: 0px;"><div style="display: flex; align-items: center; margin-left: 4px; height: 100%; flex: 1 1 auto; min-width: 0px;"><div aria-disabled="true" role="button" style="user-select: none; transition: background 20ms ease-in 0s; display: inline-block; align-items: center; border-radius: 3px; width: 100%; min-height: 34px; padding: 6px 8px 7px; font-size: 14px; overflow: hidden; color: rgba(55, 53, 47, 0.5);" tabindex="-1"><div>Empty</div></div></div></div></div></div></div></div></div></div></div><div style="width: 100%; height: 1px; background: rgba(55, 53, 47, 0.09); margin-bottom: 8px;"></div></div></div></div></div><main style="display: flex; width: 100%; justify-content: center; padding-top: 5px;"><div style="max-width: 100%; min-width: 0px; width: 900px;"><div class="notion-page-content" style="flex-shrink: 0; flex-grow: 1; max-width: 100%; display: flex; align-items: flex-start; flex-direction: column; font-size: 16px; line-height: 1.5; width: 100%; z-index: 4; padding-bottom: 30vh; padding-left: calc(96px + env(safe-area-inset-left)); padding-right: calc(96px + env(safe-area-inset-right));"><div class="notion-selectable notion-header-block" data-block-id="b06ff8b8-33d3-4b1a-a32e-646bb1afac04" style="width: 100%; max-width: 1718px; margin-top: 2em; margin-bottom: 4px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 1" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.875em; line-height: 1.3;'>人脸识别和神经风格迁移</div></div></div><div class="notion-selectable notion-text-block" data-block-id="c8864fa8-580f-4538-86b3-ab9f3c00a3ef" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果我们曾经阅读过人脸识别的相关论文，我们会经常见到两个比较相似的概念：<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">人脸验证（Face Verification）</span>和<span class="notion-enable-hover" data-token-index="3" style="font-weight:600">人脸识别（Face Recognition）</span>。它们之间有什么区别呢？</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="1da62ea9-523d-4f79-9a7c-6292a53106e7" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">具体来说，人脸验证指的是输入一张含有人脸的图片和一个名字或者是ID，要求算法输出图片中的人脸是否是那个名字或者是ID对应的人脸。而人脸识别问题是当算法已经用有一个具有K个人脸的数据库时，向算法输入一张人脸图片，要求算法认出图片中的人脸是否是这K个人中的某一个，如果是的话，还需要确认出这个人到底是其中的哪一个人。显然人脸识别是相对于人脸验证来说更加困难的一个算法。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="f417671e-bb28-4fbc-ac6d-555ef0d1cd03" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>One-shot学习</div></div></div><div class="notion-selectable notion-text-block" data-block-id="a0d1f1bf-82fc-48d3-817e-eac27887da0b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">人脸识别系统面对的一个重要问题就是人脸识别系统需要具有One-shot学习的能力。即数据库中每个人可供网络学习的照片只有一张，网络需要仅凭这一张照片学习足够多的知识使得能够准确的从人群中认出这个人。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6d84e7aa-5da2-43b4-94c7-b484b200b33c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果我们直接使用一个有着K-SoftMax输出的网络来进行训练，这样得到的效果显然是不够好的。首先每个人的训练数据只有一张，这样训练出来的网络显然是不够稳健的。其次，当数据库每次新增加一个人脸数据时，输出层SoftMax的维度就要发生改变，我们就要重新训练这个网络，这显然也是很耗费人力财力的。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="61fce065-d2cc-4cc8-ab3e-1b14b97a8983" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>Similarity函数</div></div></div><div class="notion-selectable notion-text-block" data-block-id="e3a53286-14b9-468a-ac48-1f84deec6362" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">为解决这个问题，我们要改变思路：预期让网络去识别两个人是否相等，我们可以让网络去学习如何把一张人脸映射成一个特征值，在根据特征值来区分两个人是否是同一个人。为了使得网络能够产生这样的一个映射，我们首先定义相似度函数：<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">d</span>(img1, img2)表示两幅图片之间的差异度。网络每次计算两幅图片的差异度，定义<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">τ</span>为判断的阈值，如果<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">d</span>(img1, img2) ≤ <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">τ</span>，那么网络就判定这两张图片描述的是同一个人，如果<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">d</span>(img1, img2) &gt; <span class="notion-enable-hover" data-token-index="23" style="font-style:italic">τ</span>，那么网络就认为这两张图片对应的不是同一个人。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b60b08e5-5fe8-45e5-bd6f-eebcfddf3213" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在运行人脸识别系统时，每面对陌生的一张人脸，算法就把这张人脸依次和数据库中的人脸进行计算差异度函数，两两对比判断出这张脸的主人。如果还有新人加入数据库，只需要他/她上传一张照片到数据库中即可。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="f7ebde6e-35d3-48e4-bf63-dca2f73a5286" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="027abf7ee3ad33d4aec18844b7913dc8bdda16af.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="332162b4-3a80-41e0-ac4d-39669a36eb5e" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>Siamese 网络</div></div></div><div class="notion-selectable notion-text-block" data-block-id="7e6f2569-63b1-4024-a2f1-602884ab391c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们可以利用Siamese网络来实现基于Similarity函数的人脸识别。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="10378ed3-32aa-4db2-bccc-680551a7c8b1" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在一般的图像识别任务中，我们会把一张图片输入到卷积神经网络中计算，图像的信息一般会在经历了几层卷积层，池化层的交错之后进入到全连接层，这个全连接层中的激活值在一定程度上就是对原始图像关键数据表征和编码，Siamese网络的基本思想就是把全连接层的信息作为人脸数据的特征值。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="b4717527-37fe-435d-8223-b7d49623b359" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="b9f62bb2fc80eab924b908660b8b321654e57de6.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="fbe8f87c-a541-4d52-b20d-2c8a72ab4baf" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">上图其实就是两个去除了最后SoftMax输出层的物体识别网络，我们称这个网络在全连接层最末端得到的隐藏层向量记作<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">i</span>))，表示我们把第i张图片输入网络得到的特征值。上图中两人的人脸数据之间的差异度就可以简单的计算<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">i</span>))和<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="19" style="font-style:italic">j</span>))之间的范数来得到： <span class="notion-enable-hover" data-token-index="22" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="26" style="font-style:italic">i</span>), <span class="notion-enable-hover" data-token-index="29" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="31" style="font-style:italic">j</span>)) = ||<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="36" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="38" style="font-style:italic">i</span>)) − <span class="notion-enable-hover" data-token-index="41" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="43" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="45" style="font-style:italic">j</span>))||2 因此这个算法需要实现的任务就很清楚了：我们希望，当<span class="notion-enable-hover" data-token-index="50" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="52" style="font-style:italic">i</span>), <span class="notion-enable-hover" data-token-index="55" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="57" style="font-style:italic">j</span>)是代表同一个人的两张图片时，<span class="notion-enable-hover" data-token-index="60" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="62" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="64" style="font-style:italic">i</span>), <span class="notion-enable-hover" data-token-index="67" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="69" style="font-style:italic">j</span>)) = ||<span class="notion-enable-hover" data-token-index="72" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="74" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="76" style="font-style:italic">i</span>)) − <span class="notion-enable-hover" data-token-index="79" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="81" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="83" style="font-style:italic">j</span>))||2可以尽可能的大；而当<span class="notion-enable-hover" data-token-index="88" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="90" style="font-style:italic">i</span>), <span class="notion-enable-hover" data-token-index="93" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="95" style="font-style:italic">j</span>)代表的不是同一个人时，<span class="notion-enable-hover" data-token-index="98" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="100" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="102" style="font-style:italic">i</span>), <span class="notion-enable-hover" data-token-index="105" style="font-style:italic">x</span>(<span class="notion-enable-hover" data-token-index="107" style="font-style:italic">j</span>))可以尽可能的小。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ba68bb2a-7f14-4c44-9e10-b27494b94740" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">值得注意的是，我们对于一次迭代时计算不同的人脸照片，使用的是同一套网络参数，因为最终我们只想得到一个对于所有人都能够很好计算特征的网络。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="43a08470-613d-438f-b595-a301acd0c476" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>Triplet 损失</div></div></div><div class="notion-selectable notion-text-block" data-block-id="193f3816-1d5c-4023-985d-ce8ab0bd8a3a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">Siamese网络有了需要实现的目标，接下来就应该要定义设置的损失函数了。那么我们要怎么设置损失函数才能促使网络学习到最好的编码人脸图片的方法呢？一个很常用的方法就是定义Triplet损失函数，并且使用这个损失函数执行梯度下降。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3e344af4-4f7e-4b6c-8dc4-c240918c664e" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">为了使用Triplet损失函数，我们的一个训练数据需要包含三张图片——靶目标（Anchor），正例（Positive）和反例（Negative）。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="8a2aeb4c-d9d8-47da-adcc-2a40a1e42182" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们把目标图片Anchor记为A，代表我们想要识别的人；而正例图片Positive就是P，代表了一张和A是同一个人的图片；最后我们的反例图片Negative就记为N，代表一张和A不属于同一个人的图片。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="38586b3e-41fc-4b5c-bb63-012315217b9b" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们希望我们的A图片对应的特征值接近于P图片所对应的特征值，毕竟它们是代表同一个人；而我们希望A和N对应的特征值差距尽可能大一些，因此，我们的目标就可以用范数的差来表示： <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">P</span>) ≤ <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">N</span>) ⇔ ||<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="17" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="19" style="font-style:italic">P</span>)||2 ≤ ||<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="25" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="27" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">N</span>)||2 也就是： ||<span class="notion-enable-hover" data-token-index="34" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="36" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="38" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="40" style="font-style:italic">P</span>)||2 − ||<span class="notion-enable-hover" data-token-index="44" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="46" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="48" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="50" style="font-style:italic">N</span>)||2 ≤ 0 但是上述函数有一个问题，如果<span class="notion-enable-hover" data-token-index="55" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="57" style="font-style:italic">A</span>) = <span class="notion-enable-hover" data-token-index="59" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="61" style="font-style:italic">P</span>) = <span class="notion-enable-hover" data-token-index="63" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="65" style="font-style:italic">N</span>) = 0，神经网络只要一直输出0，上面的公式就可以被轻易的满足。这可不是我们想要的结果。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e5918562-d22f-4cf9-9700-8ce0ee7b4507" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">为了防止这种情况出现，我们要修改一下上式，使得两者的差小于一个较小的负数： ||<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="6" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">P</span>)||2 − ||<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="16" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="18" style="font-style:italic">N</span>)||2 ≤  − <span class="notion-enable-hover" data-token-index="22" style="font-style:italic">α</span> 我们称呼这个<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">α</span>为margin，说明它和支持向量机中的margin的相似地位，我们最终的目标就是： ||<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="31" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="33" style="font-style:italic">P</span>)||2 − ||<span class="notion-enable-hover" data-token-index="37" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="39" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="41" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="43" style="font-style:italic">N</span>)||2 + <span class="notion-enable-hover" data-token-index="47" style="font-style:italic">α</span> ≤ 0 我们的损失函数就可以定义为： <span class="notion-enable-hover" data-token-index="50" style="font-style:italic">L</span>(<span class="notion-enable-hover" data-token-index="52" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="54" style="font-style:italic">P</span>, <span class="notion-enable-hover" data-token-index="56" style="font-style:italic">N</span>) = max {||<span class="notion-enable-hover" data-token-index="58" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="60" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="62" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="64" style="font-style:italic">P</span>)||2 − ||<span class="notion-enable-hover" data-token-index="68" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="70" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="72" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="74" style="font-style:italic">P</span>)||2 + <span class="notion-enable-hover" data-token-index="78" style="font-style:italic">α</span>, 0} 这个损失函数的特点是，只要||<span class="notion-enable-hover" data-token-index="81" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="83" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="85" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="87" style="font-style:italic">P</span>)||2 − ||<span class="notion-enable-hover" data-token-index="91" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="93" style="font-style:italic">A</span>) − <span class="notion-enable-hover" data-token-index="95" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="97" style="font-style:italic">P</span>)||2 + <span class="notion-enable-hover" data-token-index="101" style="font-style:italic">α</span> ≤ 0，说明算法在这个数据上的表现令人满意，于是损失函数就为零，算法也就不再对这一对图片进行优化了。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="4f240bbd-06fe-41bc-8e63-d9b2acf28cb3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">Triplet损失函数中值得注意的几点</span></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="ff890e94-8c5c-4115-8778-8a1e2c951a22" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"1."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">对于m组的训练样本，我们有$J=\sum_{i=1}^m L(A^{(i)},P^{(i)},N^{(i)})$，我们需要保证，同一人应该含有多张照片。比如我们数据集中有10000张照片，一共包含了1000个人，那么这个数据集是满足要求的，因为平均一个人含有10张不同的照片。</div></div></div></div></div><div class="notion-selectable notion-numbered_list-block" data-block-id="cdf30a19-f1f0-4c96-912f-0a00555ff4ed" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: unset; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><span class="pseudoBefore" style='--pseudoBefore--content:"2."; text-align: center; white-space: nowrap; width: 24px;'></span></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">选择三元组的技巧：如果我们总是随机的选择三元组，当算法训练到一定水平后，我们的随机选择出的(<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="3" style="font-style:italic">P</span>, <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">N</span>)很容易就满足了<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">P</span>) + <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">α</span> ≤ <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="19" style="font-style:italic">N</span>)，那么这样我们的算法就难以得到训练。于是我们可以有意的选择那些比较难以解决的三元组，也就是<span class="notion-enable-hover" data-token-index="21" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="25" style="font-style:italic">P</span>) ≈ <span class="notion-enable-hover" data-token-index="27" style="font-style:italic">d</span>(<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">A</span>, <span class="notion-enable-hover" data-token-index="31" style="font-style:italic">N</span>)，这样以来有助于我们构建一个更加强大的算法，另一方面也可以避免掉没有意义的数据，加快训练。</div></div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="2e9bb07e-9109-45d4-9e8a-09b438e6ed33" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>Triplet损失函数的替代品：二分类方法</div></div></div><div class="notion-selectable notion-text-block" data-block-id="44f8c0c0-e1f0-4a69-895d-adc78814307c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">除了构造triplet loss来解决人脸识别问题之外，我们还可以使用二分类结构来监督训练特征值计算网络。做法是将两个siamese网络组合在一起（当然还是共用一套参数），将各自的编码层输出经过一个逻辑输出单元，该神经元使用sigmoid函数，输出 1 则表示识别为同一人，输出 0 则表示识别为不同人。结构如下：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="e1d389db-48cc-4326-866c-c4234223c7e5" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="7eb4cf822f59a0628fd3bad5edf65dfa296f1012.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="2dde929e-b754-4ef2-aeb2-cee5717d2432" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">对于这样的二分类网络，我们每次输入两张图片，通过完全一样的解码网络，最终把两个网络的特征值输入到一起。这样就把人脸</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="dd7a66ba-e046-4d7f-83a0-f0671a40f988" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">识别问题转化成为了一个二分类问题。在最后一层中，我们按照如下方式计算输出<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">ŷ</span>： $$
\hat y = \sigma(\sum_{k=1}^{K}w_k|f(x^{(i)})_k-f(x^{(j)})_k|+b_k)
$$ 其中下标<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">k</span>代表了编码出的K维特征值向量中的第<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">k</span>个元素。当然我们计算如下公式并进行监督也可以达到不错的效果： $$
\hat y = \sigma\left(\sum_{k=1}^K w_k\frac{(f(x^{(i)})_k-f(x^{(j)})_k)^2}{f(x^{(i)})_k+f(x^{(j)})_k} + b_k\right)
$$ 上式被称为 <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">χ</span> 方公式，也叫 <span class="notion-enable-hover" data-token-index="13" style="font-style:italic">χ</span> 方相似度。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="42939a65-5890-4188-bce0-3ce819514b7d" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">在应用Siamese网络时，非常重要的一点是，我们不必在每次对比两张图片的时候都计算两张图片各自的特征值。对于已经存在于数据库中的图片我们可以预先计算出它们的特征值，这样在遇到一张新的图片的时候，我们一共只需要计算出输入图片的一个特征值并把它带入数据库和其他预计算出来的特征值进行比对即可。</div></div></div></div><div class="notion-selectable notion-sub_header-block" data-block-id="020a1daa-7d96-415e-a2ba-610879682574" style="width: 100%; max-width: 1718px; margin-top: 1.4em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 2" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.5em; line-height: 1.3;'>神经风格迁移（Neural Style Transfer）</div></div></div><div class="notion-selectable notion-text-block" data-block-id="ce94327e-ba59-4df3-8d44-dd8ab3f5cda9" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们也许在之前的文章和新闻中已经看到像下图一样的风格迁移图片，人们使用了一个人工智能程序绘制了一幅画面，而这幅画的风格和图片内都来自两张不同的图片：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="65bed80f-78c9-41d3-8dd4-c920085e99df" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="6e2728b4ce27bd6a661011b11278f744b929214f.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="0e179e0f-a6d2-4378-ba24-6241e34b7e26" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">新闻报道常常使用AI绘画这样的博眼球词汇来吸引人们的注意，但实际上当我们了解了其中的相关技术以后，我们会知道这里面其实没有什么AI画画的过程。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="e1989380-5ca9-49d1-8c20-b3f01382eca5" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>深度卷积网络的卷积层解释性</div></div></div><div class="notion-selectable notion-text-block" data-block-id="54fd65ac-f9cb-45f8-919c-dd56356cbbae" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">下图显示了一个典型的CNN模型：</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="7a387c85-6a3e-41b0-b5c3-1cdee8eb6a47" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="fecb3376084f6ff927e75edd167066058be08e19.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="182a290b-0726-4cc2-a559-f22eadca9347" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们使用了大量的卷积层来进行所谓的特征抽取过程，但是不免让人好奇的是，这些卷积层到底都对哪些特征进行了提取呢？人们想出了一个可以可视化卷积层特征提取细节的好办法：</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="1ec648ae-168b-4dd9-b1ae-20189fb29c14" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">首先，我们先在卷积神经网络中随便挑选一个卷积核，然后在训练过程中我们持续关注这个卷积核，我们观察所有输入到这个卷积核中的图块，把那些能够引起这个卷积核产生最高激活的那一些图块单独列出来，观察这些图块的特点，我们就知道这个卷积核最偏爱的图块有着怎样的特点了。下图是卷积层第一层的某9个卷积核的激活特点，每个卷积核对应地列出了9个能够使它们产生最高激活的图块。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="9241b3fa-a328-47db-882d-ae4743a9d591" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div><img referrerpolicy="same-origin" src="6fdbbd79ffe1189223351770f871905fb827fcbc.png" style="display: block; object-fit: cover; border-radius: 1px; background: white; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="3c1e4cdc-7df9-4ecd-b02f-5e78bef0f8f0" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">可以看出，第一层隐藏层一般检测的是原始图像的边缘和颜色阴影等简单信息。如果继续看CNN的更深隐藏层，我们会发现随着层数的增加，捕捉的区域更大，特征更加复杂，从边缘到纹理再到具体物体.</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="8cc2baf9-07f3-4f66-aed8-7ecab63b6c35" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="3b621676b0786f14e33ec0ff65a4926b040621cd.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="28a72aae-41da-4479-bc7f-7e0d423b5521" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>神经风格迁移的代价函数</div></div></div><div class="notion-selectable notion-text-block" data-block-id="cf0af9e5-81d8-4e5a-8608-584afa163ec2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如果我们想要实现一个神经风格迁移的AI画家，我们该如何设计这个网络？你可能会说，我们可以设计一个类似U-Net的网络，输入一张图片，输出一张图片。这种方法也许可行，但是实际上神经风格迁移使用的另一种很巧妙的办法——我们输入一张图片，并修改这个输入。如何修改输入图片？很简单，我们只要对输入<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">X</span>使用梯度下降优化它即可<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">X</span> := <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">X</span> − ∇<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">f</span>(<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">X</span>)。这是我们之前没有设想过的情况，在过去我们只对网络参数使用梯度下降。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="0845467f-184a-482b-8eed-b797ea202230" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="6b2bcebaf0a6e5cbac2eeed9161ff01b0054ae06.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="55dcf9bf-9f32-4442-88db-f2740b5f8a8f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们给神经风格迁移需要融合的两张图片取个不一样的名字：我们需要绘制的图片的主体内容来自图片<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">C</span>，而图片的风格来自<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">S</span>，最终我们记生成的图片为<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">G</span>。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="c005265d-34a8-4019-8d2c-3219d5b60617" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们希望图片<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">G</span>在风格上近似于<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">S</span>，在内容上近似于<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">C</span>，我们因此设置两个代价函数——内容代价函数和风格代价函数： <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">J</span>(<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">G</span>) = <span class="notion-enable-hover" data-token-index="11" style="font-style:italic">α</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="15" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">t</span>(<span class="notion-enable-hover" data-token-index="21" style="font-style:italic">C</span>, <span class="notion-enable-hover" data-token-index="23" style="font-style:italic">G</span>) + <span class="notion-enable-hover" data-token-index="25" style="font-style:italic">β</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">s</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="29" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="30" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="31" style="font-style:italic">e</span>(<span class="notion-enable-hover" data-token-index="33" style="font-style:italic">S</span>, <span class="notion-enable-hover" data-token-index="35" style="font-style:italic">G</span>) 其中：</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="a4d7ecf7-a546-4cb9-8c87-1b3a9f137c06" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">J</span>(<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">C</span>, <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">G</span>) 代表生成图片<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">G</span>的内容和内容图片<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">C</span>的内容的相似度；</div></div><div class="notion-selectable notion-text-block" data-block-id="34a20f4a-f824-4617-a9aa-e8d6a5ee48b6" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="1" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">t</span></div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="2c7f2828-7d59-49fb-a956-1eab6df2a626" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">J</span>(<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">S</span>, <span class="notion-enable-hover" data-token-index="4" style="font-style:italic">G</span>) 代表生成图片<span class="notion-enable-hover" data-token-index="6" style="font-style:italic">G</span>的内容和风格图片<span class="notion-enable-hover" data-token-index="8" style="font-style:italic">S</span>的内容的相似度；</div></div><div class="notion-selectable notion-text-block" data-block-id="65428e2e-6a22-4408-9827-2d91f82c5db6" style="width: 100%; max-width: 100%; margin-top: 2px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">s</span><span class="notion-enable-hover" data-token-index="1" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">e</span></div></div></div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="50c6620d-82db-4c04-b44e-83e62209df7c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">α</span>、<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">β</span> 两个超参数用来表示以上两者之间的权重，它们共同决定了最终图片向哪一方倾斜。</div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6f129b6a-9ac8-4049-9c3d-0650520e5ae2" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">因此我们的神经风格迁移的基本算法流程是：首先令<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">G</span>为随机像素点，然后使用梯度下降算法，不断修正<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">G</span>的所有像素点，使得 <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">J</span>(<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">G</span>) 不断减小，从而使<span class="notion-enable-hover" data-token-index="9" style="font-style:italic">G</span>逐渐有<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">C</span>的内容和<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">G</span>的风格，如下图所示。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="b983f412-ab90-4723-a682-0ff04fcd39c8" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="ef8f9c86a9c7c57cba7fb1ff24f55f68260fc315.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="bba7e162-69a1-4ac4-bbbe-77a03871dbb6" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>内容代价函数</div></div></div><div class="notion-selectable notion-text-block" data-block-id="e45fccd0-1de2-4e80-a824-dc3d80617cf5" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们先来看 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">J</span>(<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">G</span>) 的第一部分 <span class="notion-enable-hover" data-token-index="5" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="6" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="7" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="11" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">t</span>(<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">C</span>, <span class="notion-enable-hover" data-token-index="16" style="font-style:italic">G</span>) ，它表示内容图片<span class="notion-enable-hover" data-token-index="18" style="font-style:italic">C</span>与生成图片<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">G</span>之间的相似度。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="509ff7c3-cf48-45c9-a2a6-cb04b1ceb42a" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">我们首先要拿来一个已经训练好的CNN网络（基于什么任务没有太大关系），例如Alex-Net。接着我们把<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">C</span>，<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">S</span>，<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">G</span>都带入到这个网络中（使用同一套网络权重）。我们希望<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">C</span>, <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">G</span>在内容上尽可能相似，基于我们之前了解到的卷积神经网络中的卷积层提取特征的能力，我们可以通过让两个图片<span class="notion-enable-hover" data-token-index="11" style="font-weight:600">在网络的某一层的隐藏层的激活值尽可能的相近</span>，是的它们有一样的图片内容的特征。那么我们首先需要选择合适的层数<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">l</span>来计算隐藏层之间的差异 <span class="notion-enable-hover" data-token-index="15" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="16" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="20" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">t</span>(<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">C</span>, <span class="notion-enable-hover" data-token-index="26" style="font-style:italic">G</span>) 。</div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="35f27ab4-f340-4e1c-93d2-4b1e881b4bfa" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">如果 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">l</span> 太小，则<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">G</span>与<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">C</span>在像素上会非常接近，没有迁移效果；</div></div></div></div></div><div class="notion-selectable notion-bulleted_list-block" data-block-id="783273c7-85cf-4e52-88ea-90d7df4f7914" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="display: flex; align-items: flex-start; width: 100%; padding-left: 2px; color: inherit; fill: inherit;"><div class="pseudoSelection" contenteditable="false" data-content-editable-void="true" data-text-edit-side="start" style="user-select: none; --pseudoSelection--background:transparent; margin-right: 2px; width: 24px; display: flex; align-items: center; justify-content: center; flex-grow: 0; flex-shrink: 0; min-height: calc(1.5em + 3px + 3px);"><div class="pseudoBefore" style='font-size: 1.5em; line-height: 1; margin-bottom: 0px; --pseudoBefore--fontFamily:Arial; --pseudoBefore--content:"•";'></div></div><div style="flex: 1 1 0px; min-width: 1px; display: flex; flex-direction: column;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="List" spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; text-align: left;">如果 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">l</span> 太深，则<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">G</span>上某个区域将直接会出现<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">C</span>中的物体。</div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="76c6d71c-a985-44f1-93e7-5665fb49e01f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">因此， <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">l</span> 既不能太浅也不能太深，我们一般选择网络中间层。我们令<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">a</span>[<span class="notion-enable-hover" data-token-index="5" style="font-style:italic">l</span>](<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">C</span>)这个和<span class="notion-enable-hover" data-token-index="10" style="font-style:italic">a</span>[<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">l</span>](<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">G</span>)代表这两个图片<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">C</span>和<span class="notion-enable-hover" data-token-index="19" style="font-style:italic">G</span>的层的激活函数值。如果这两个激活值相似，那么就意味着两个图片的内容相似。相应的 <span class="notion-enable-hover" data-token-index="21" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="22" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="25" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">t</span>(<span class="notion-enable-hover" data-token-index="30" style="font-style:italic">C</span>, <span class="notion-enable-hover" data-token-index="32" style="font-style:italic">G</span>) 的表达式为：</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d44ce115-86b9-4d97-832e-01b0aad7ee75" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">$$J_{content}(C,G)=\frac12||a^{[l] (C)}-a^{[l] (G)}||^2$$</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="89675ce0-2a52-4c21-aa8e-ead09f87f3f3" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">a</span>[<span class="notion-enable-hover" data-token-index="2" style="font-style:italic">l</span>](<span class="notion-enable-hover" data-token-index="4" style="font-style:italic">C</span>) 与$ a^{[l] (G)} $越相似，则 <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="10" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="11" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="13" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="14" style="font-style:italic">t</span>(<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">C</span>, <span class="notion-enable-hover" data-token-index="18" style="font-style:italic">G</span>) 越小。我们接着就可以使用梯度下降算法，不断迭代修正<span class="notion-enable-hover" data-token-index="20" style="font-style:italic">G</span>的像素值，使 <span class="notion-enable-hover" data-token-index="22" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="23" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">o</span><span class="notion-enable-hover" data-token-index="25" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="26" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="27" style="font-style:italic">e</span><span class="notion-enable-hover" data-token-index="28" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="29" style="font-style:italic">t</span>(<span class="notion-enable-hover" data-token-index="31" style="font-style:italic">C</span>, <span class="notion-enable-hover" data-token-index="33" style="font-style:italic">G</span>) 不断减小。</div></div></div></div><div class="notion-selectable notion-sub_sub_header-block" data-block-id="03c841bb-1898-4b5f-af58-19eca18e0538" style="width: 100%; max-width: 1718px; margin-top: 1em; margin-bottom: 1px;"><div style="display: flex; width: 100%; color: inherit; fill: inherit;"><div contenteditable="false" data-content-editable-leaf="true" placeholder="Heading 3" spellcheck="true" style='max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; font-weight: 600; font-size: 1.25em; line-height: 1.3;'>风格代价函数</div></div></div><div class="notion-selectable notion-text-block" data-block-id="d097eb5e-e5f1-4558-ad89-d84bb35e10bb" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">如何定义风格代价函数？这个问题的答案不像上面的内容代价函数一样显而易见。这里的难点主要体现在我们如何表示图像的风格。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="b579cbaf-769c-422d-8220-e1e63111fc22" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">图像在某个位置体现了某种风格，在一定程度上可以理解为几个特别的特点或者纹理在这里同时出现了，即风格就是不同层面（颜色，纹理，结构）的特点特异性组合的结果。按照这个思路，我们可以把风格定义为不同特征强度的乘积（我们使用乘积来代表关联性），而在卷积神经网络中的卷积层中，特征的大小是由卷积核的激活强度决定的，而同一层之间的不同特征分别又不同的卷积核接管，于是我们定义图片的由第<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">k</span>和第<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">k</span>′个卷积核特征构成的风格矩阵为： $$
G_{kk'}^{[l]}=\sum_{i=1}^{n_H^{[l]}}\sum_{j=1}^{n_W^{[l]}}a_{ijk}^{[l]}a_{ijk'}^{[l]}
$$ [<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">l</span>] 表示第 <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">l</span> 层隐藏层，<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">i</span>、<span class="notion-enable-hover" data-token-index="13" style="font-style:italic">j</span>、<span class="notion-enable-hover" data-token-index="15" style="font-style:italic">k</span>分别代表激活值的高、宽、通道，<span class="notion-enable-hover" data-token-index="17" style="font-style:italic">k</span>，<span class="notion-enable-hover" data-token-index="19" style="font-style:italic">k</span>′分别表示不同通道（也就是不同的卷积核），所以<span class="notion-enable-hover" data-token-index="21" style="font-style:italic">l</span>层的高度和宽度分别为：<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="24" style="font-style:italic">H</span>[<span class="notion-enable-hover" data-token-index="26" style="font-style:italic">l</span>]，<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="30" style="font-style:italic">W</span>[<span class="notion-enable-hover" data-token-index="32" style="font-style:italic">l</span>]，通道数为 <span class="notion-enable-hover" data-token-index="35" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="36" style="font-style:italic">C</span>[<span class="notion-enable-hover" data-token-index="38" style="font-style:italic">l</span>]。我们令 <span class="notion-enable-hover" data-token-index="41" style="font-style:italic">a</span><span class="notion-enable-hover" data-token-index="42" style="font-style:italic">i</span>, <span class="notion-enable-hover" data-token-index="44" style="font-style:italic">j</span>, <span class="notion-enable-hover" data-token-index="46" style="font-style:italic">k</span>[<span class="notion-enable-hover" data-token-index="48" style="font-style:italic">l</span>] 表示在(<span class="notion-enable-hover" data-token-index="51" style="font-style:italic">i</span>, <span class="notion-enable-hover" data-token-index="53" style="font-style:italic">j</span>, <span class="notion-enable-hover" data-token-index="55" style="font-style:italic">k</span>)位置的激活值，而<span class="notion-enable-hover" data-token-index="57" style="font-style:italic">G</span>[<span class="notion-enable-hover" data-token-index="59" style="font-style:italic">l</span>] 是一个 <span class="notion-enable-hover" data-token-index="62" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="63" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="64" style="font-style:italic">l</span> × <span class="notion-enable-hover" data-token-index="66" style="font-style:italic">n</span><span class="notion-enable-hover" data-token-index="67" style="font-style:italic">c</span><span class="notion-enable-hover" data-token-index="68" style="font-style:italic">l</span> 大小的矩阵，计算的是第 <span class="notion-enable-hover" data-token-index="70" style="font-style:italic">l</span> 层隐藏层不同通道对应的所有激活函数输出和：若两个通道之间相似性高，则对应的 <span class="notion-enable-hover" data-token-index="72" style="font-style:italic">G</span><span class="notion-enable-hover" data-token-index="73" style="font-style:italic">k</span><span class="notion-enable-hover" data-token-index="74" style="font-style:italic">k</span>′[<span class="notion-enable-hover" data-token-index="77" style="font-style:italic">l</span>] 较大；若两个通道之间相似性低，则对应的 <span class="notion-enable-hover" data-token-index="80" style="font-style:italic">G</span><span class="notion-enable-hover" data-token-index="81" style="font-style:italic">k</span><span class="notion-enable-hover" data-token-index="82" style="font-style:italic">k</span>′[<span class="notion-enable-hover" data-token-index="85" style="font-style:italic">l</span>] 较小。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="062a8233-7ac4-4946-bf11-007d7d998f2f" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">因此我们可以分别列出代表对风格图<span class="notion-enable-hover" data-token-index="1" style="font-style:italic">S</span>和生成图像<span class="notion-enable-hover" data-token-index="3" style="font-style:italic">G</span>的风格矩阵： $$
\begin{align}
G_{kk'}^{[l] (S)} &amp;= \sum\limits_{i=1}^{n_{h}^{[l]}}\sum\limits_{j=1}^{n_{w}^{[l]}}a_{i,j,k}^{[l] (S)}a_{i,j,k'}^{[l] (S)}\\
G_{kk'}^{[l] (G)} &amp;= \sum\limits_{i=1}^{n_{h}^{[l]}}\sum\limits_{j=1}^{n_{w}^{[l]}}a_{i,j,k}^{[l] (G)}a_{i,j,k'}^{[l] (G)}
\end{align}
$$ <span class="notion-enable-hover" data-token-index="7" style="font-style:italic">G</span><span class="notion-enable-hover" data-token-index="8" style="font-style:italic">k</span><span class="notion-enable-hover" data-token-index="9" style="font-style:italic">k</span>′[<span class="notion-enable-hover" data-token-index="12" style="font-style:italic">l</span>](<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">S</span>) 与 <span class="notion-enable-hover" data-token-index="17" style="font-style:italic">G</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">k</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">k</span>′[<span class="notion-enable-hover" data-token-index="22" style="font-style:italic">l</span>](<span class="notion-enable-hover" data-token-index="24" style="font-style:italic">G</span>) 越相近，则表示<span class="notion-enable-hover" data-token-index="27" style="font-style:italic">G</span>的风格越接近<span class="notion-enable-hover" data-token-index="29" style="font-style:italic">S</span>。所以风格矩阵的代价函数就是： $$
J_{style}^{[l]}(S, G) = \dfrac{1}{2n_{h}^{[l]}n_{w}^{[l]}n_{c}^{[l]}}\sum_{k}\sum_{k'}(G_{kk'}^{[l] (S)} - G_{kk'}^{[l] (G)})^{2}
$$ 同样的，定义完 <span class="notion-enable-hover" data-token-index="33" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="34" style="font-style:italic">s</span><span class="notion-enable-hover" data-token-index="35" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="36" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="37" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="38" style="font-style:italic">e</span>(<span class="notion-enable-hover" data-token-index="40" style="font-style:italic">S</span>, <span class="notion-enable-hover" data-token-index="42" style="font-style:italic">G</span>)[<span class="notion-enable-hover" data-token-index="45" style="font-style:italic">l</span>] 之后，我们的目标就是使用梯度下降算法，不断迭代修正<span class="notion-enable-hover" data-token-index="48" style="font-style:italic">G</span>的像素值，使 <span class="notion-enable-hover" data-token-index="50" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="51" style="font-style:italic">s</span><span class="notion-enable-hover" data-token-index="52" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="53" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="54" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="55" style="font-style:italic">e</span>(<span class="notion-enable-hover" data-token-index="57" style="font-style:italic">S</span>, <span class="notion-enable-hover" data-token-index="59" style="font-style:italic">G</span>)[<span class="notion-enable-hover" data-token-index="62" style="font-style:italic">l</span>] 不断减小。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="d3f1f670-4b70-42d0-ae30-7923a418d36c" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">值得一提的是，以上我们只比较计算了一层隐藏层 <span class="notion-enable-hover" data-token-index="1" style="font-style:italic">l</span> 。为了提取的“风格”更多，也可以计算多层隐藏层的风格代价函数，然后相加，表达式为：</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="87dd8e15-63e6-4226-b3b2-f45a92df9865" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="1" style="font-style:italic">s</span><span class="notion-enable-hover" data-token-index="2" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="3" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="4" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="5" style="font-style:italic">e</span>(<span class="notion-enable-hover" data-token-index="7" style="font-style:italic">S</span>, <span class="notion-enable-hover" data-token-index="9" style="font-style:italic">G</span>) = ∑<span class="notion-enable-hover" data-token-index="11" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="12" style="font-style:italic">λ</span>[<span class="notion-enable-hover" data-token-index="14" style="font-style:italic">l</span>]<span class="notion-enable-hover" data-token-index="16" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="17" style="font-style:italic">s</span><span class="notion-enable-hover" data-token-index="18" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="19" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="20" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="21" style="font-style:italic">e</span>[<span class="notion-enable-hover" data-token-index="23" style="font-style:italic">l</span>](<span class="notion-enable-hover" data-token-index="26" style="font-style:italic">S</span>, <span class="notion-enable-hover" data-token-index="28" style="font-style:italic">G</span>) 其中， <span class="notion-enable-hover" data-token-index="31" style="font-style:italic">λ</span>[<span class="notion-enable-hover" data-token-index="33" style="font-style:italic">l</span>] 表示累加过程中各层 <span class="notion-enable-hover" data-token-index="36" style="font-style:italic">J</span><span class="notion-enable-hover" data-token-index="37" style="font-style:italic">s</span><span class="notion-enable-hover" data-token-index="38" style="font-style:italic">t</span><span class="notion-enable-hover" data-token-index="39" style="font-style:italic">y</span><span class="notion-enable-hover" data-token-index="40" style="font-style:italic">l</span><span class="notion-enable-hover" data-token-index="41" style="font-style:italic">e</span>[<span class="notion-enable-hover" data-token-index="43" style="font-style:italic">l</span>](<span class="notion-enable-hover" data-token-index="46" style="font-style:italic">S</span>, <span class="notion-enable-hover" data-token-index="48" style="font-style:italic">G</span>) 的权重系数，为超参数。</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="204c5ad8-f8b2-4631-abab-4d408c452a55" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">定义好了两个代价函数，我们就可以构建这个神经风格迁移网络并进行优化，得到我们的<span class="notion-enable-hover" data-token-index="1" style="font-weight:600">“AI绘画”</span>作品了。最后让我们再欣赏几幅奇妙的神经风格迁移绘画吧。</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="184601cc-786e-49e3-8747-3e4f54b4a71a" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="6fa2128d2045dd0268a0ed5de402394b74bad0f1.jpg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="263b9d23-1c07-4131-b1b5-dbcdb82f61cb" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">styletransfer</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="54f1b74d-4c04-47b1-adda-572d5ff5f221" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">图源：http://bethgelab.org/research/machine_learning/style_transfer/</div></div></div></div><div class="notion-selectable notion-image-block" data-block-id="b7bcea1b-55d5-49ba-b964-deed52422529" style="width: 100%; max-width: 1910px; align-self: center; margin-top: 4px; margin-bottom: 4px;"><div contenteditable="false" data-content-editable-void="true"><div style="display: flex;"><div class="notion-cursor-default" style="position: relative; overflow: hidden; flex-grow: 1;"><div style="position: relative;"><div><div style="width: 100%; height: 100%;"><img referrerpolicy="same-origin" src="82fd4638b16e38274e74854a1a09f104a45fb64b.jpeg" style="display: block; object-fit: cover; border-radius: 1px; pointer-events: auto; width: 100%;"/></div></div></div></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="6bd5d556-fe58-442a-b6eb-5e6696076b92" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">1*8bbp3loQjkLXaIm_QBfD8w</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e969d607-1236-428d-b01f-e88249247c48" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">图源：https://towardsdatascience.com/light-on-math-machine-learning-intuitive-guide-to-neural-style-transfer-ef88e46697ee</div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="e8acbe53-35f4-4e44-98aa-43877da3c886" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 1px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;"><span class="notion-enable-hover" data-token-index="0" style="font-weight:600">参考资料：</span></div></div></div></div><div class="notion-selectable notion-text-block" data-block-id="ce6e0b11-443b-4f9e-849c-abf32f81a646" style="width: 100%; max-width: 1718px; margin-top: 1px; margin-bottom: 0px;"><div style="color: inherit; fill: inherit;"><div style="display: flex;"><div contenteditable="false" data-content-editable-leaf="true" placeholder=" " spellcheck="true" style="max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;">[1] Coursera Deeplearning.AI深度学习教程：https://www.coursera.org/specializations/deep-learning</div></div></div></div></div></div><div contenteditable="false" data-content-editable-void="true" style="width: 0px;"><div style="display: none; flex-shrink: 0; pointer-events: none; width: 0px; position: absolute; right: 192px; opacity: 0;"><div style="display: flex; flex-direction: column; padding: 5px 16px; width: 340px; flex-shrink: 0; height: 100%; position: relative; pointer-events: none; z-index: 1;"><div style="position: absolute; pointer-events: none; width: 100%; height: 100%; top: -5px; background: linear-gradient(white 0px, rgba(255, 255, 255, 0) 15px);"></div></div></div></div></main><span style="height: 1px; width: 1px;"></span></div><div class="notion-presence-container" style="position: absolute; top: 0px; left: 0px; z-index: 89;"><div></div></div></div></div></div><div class="notion-peek-renderer" style="position: fixed; top: 0px; right: 0px; bottom: 0px; width: 960px; z-index: 109; transform: translateX(960px) translateZ(0px);"></div></div></div></div></div><textarea aria-hidden="true" style="opacity: 0; pointer-events: none; position: fixed; left: 0px; top: 0px;" tabindex="-1"></textarea><textarea aria-hidden="true" style="opacity: 0; pointer-events: none; position: fixed; left: 0px; top: 0px;" tabindex="-1"></textarea><script src="1172e9111a5fb396bcb8a05870b5eabf8abf221c.js" type="text/javascript"></script><div style="width: env(safe-area-inset-bottom);"></div></body></html>